<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="منصة احترافية للاستيراد المجمع والنشر على المنصات الاجتماعية">
    <meta name="keywords" content="استيراد, نشر, منصات اجتماعية, فيسبوك, انستغرام, تويتر">
    <meta name="author" content="SocialHub Pro Team">
    <meta name="robots" content="index, follow">

    <!-- التوافقية مع المتصفحات -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="theme-color" content="#1a365d">

    <!-- أيقونات التطبيق -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE2IDJMMjggMTZMMTYgMzBMNCAxNkwxNiAyWiIgZmlsbD0iIzFhMzY1ZCIvPgo8cGF0aCBkPSJNMTYgOEwyNCAxNkwxNiAyNEw4IDE2TDE2IDhaIiBmaWxsPSIjM2Y4MmNlIi8+Cjwvc3ZnPgo=">

    <!-- تحميل خطوط Google بشكل محسّن -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- أيقونات Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous">

    <!-- Firebase SDK -->
    <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics-compat.js"></script>

    <title>SocialHub Pro - منصة الاستيراد المجمع الاحترافية</title>

    <style>
        /* تطبيق CSS المحسن مع معالجة الأخطاء */
           /* المتغيرات الأساسية */
        :root {
            /* الألوان الأساسية */
            --primary-color: #1a365d;
            --primary-dark: #0f2040;
            --primary-light: #2a4a7a;
            --secondary-color: #2d3748;
            --accent-color: #3182ce;
            --accent-light: #4299e1;
            --success-color: #38a169;
            --warning-color: #d69e2e;
            --error-color: #e53e3e;
            --info-color: #3182ce;
            
            /* ألوان الخلفية والنص */
            --background-color: #f7fafc;
            --surface-color: #ffffff;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --border-color: #e2e8f0;
            --border-hover: #cbd5e0;
            
            /* الظلال */
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            
            /* الخطوط */
            --font-family: 'Noto Sans Arabic', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-size-4xl: 2.25rem;
            
            /* المسافات */
            --spacing-1: 0.25rem;
            --spacing-2: 0.5rem;
            --spacing-3: 0.75rem;
            --spacing-4: 1rem;
            --spacing-5: 1.25rem;
            --spacing-6: 1.5rem;
            --spacing-8: 2rem;
            --spacing-10: 2.5rem;
            --spacing-12: 3rem;
            --spacing-16: 4rem;
            
            /* الزوايا */
            --radius-sm: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;
            
            /* التحويلات والحركات */
            --transition-fast: 150ms ease;
            --transition-normal: 200ms ease;
            --transition-slow: 300ms ease;
        }

        /* إعادة تعيين العناصر الأساسية */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-primary);
            direction: rtl;
            text-align: right;
            overflow-x: hidden;
        }

        /* الروابط */
        a {
            color: var(--accent-color);
            text-decoration: none;
            transition: color var(--transition-normal);
        }

        a:hover {
            color: var(--accent-light);
        }

        /* العناوين */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            line-height: 1.25;
            margin-bottom: var(--spacing-4);
        }

        h1 { font-size: var(--font-size-4xl); }
        h2 { font-size: var(--font-size-3xl); }
        h3 { font-size: var(--font-size-2xl); }
        h4 { font-size: var(--font-size-xl); }
        h5 { font-size: var(--font-size-lg); }
        h6 { font-size: var(--font-size-base); }

        /* النصوص */
        p {
            margin-bottom: var(--spacing-4);
        }

        /* الأزرار */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-2);
            padding: var(--spacing-3) var(--spacing-5);
            border: 1px solid transparent;
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-normal);
            line-height: 1.5;
        }

        .btn:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.5);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background-color: #2d3748;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background-color: #2f855a;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-danger {
            background-color: var(--error-color);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background-color: #c53030;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-outline {
            background-color: transparent;
            border-color: var(--border-color);
            color: var(--text-primary);
        }

        .btn-outline:hover:not(:disabled) {
            background-color: var(--background-color);
            border-color: var(--border-hover);
        }

        .btn-text {
            background-color: transparent;
            color: var(--accent-color);
            padding: var(--spacing-2) var(--spacing-3);
        }

        .btn-text:hover:not(:disabled) {
            background-color: rgba(66, 153, 225, 0.1);
        }

        /* شاشة التحميل */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity var(--transition-slow);
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-logo {
            width: 120px;
            height: 120px;
            margin-bottom: var(--spacing-6);
            animation: pulse 2s infinite;
        }

        .loading-text {
            color: white;
            font-size: var(--font-size-lg);
            font-weight: 600;
            margin-bottom: var(--spacing-4);
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: white;
            border-radius: var(--radius-sm);
            animation: loading 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        @keyframes loading {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        /* شاشة المصادقة */
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--background-color);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9998;
        }

        .auth-screen.active {
            display: flex;
        }

        .auth-container {
            background: var(--surface-color);
            padding: var(--spacing-12);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .auth-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--spacing-6);
        }

        .auth-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            margin-bottom: var(--spacing-2);
        }

        .auth-subtitle {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-8);
        }

        .auth-button {
            width: 100%;
            padding: var(--spacing-4);
            border: none;
            border-radius: var(--radius-lg);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            margin-bottom: var(--spacing-3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-3);
        }

        .auth-button:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .auth-button.google {
            background: #4285f4;
            color: white;
        }

        .auth-button.facebook {
            background: #1877f2;
            color: white;
        }

        .auth-button.twitter {
            background: #1da1f2;
            color: white;
        }

        /* التطبيق الرئيسي */
        .main-app {
            display: flex;
            min-height: 100vh;
        }

        .main-app.hidden {
            display: none;
        }

        /* الشريط الجانبي */
        .sidebar {
            width: 280px;
            background: var(--surface-color);
            border-left: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: fixed;
            top: 0;
            right: 0;
            z-index: 100;
            transition: transform var(--transition-normal);
        }

        .sidebar-header {
            padding: var(--spacing-4);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
        }

        .sidebar-toggle {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            padding: var(--spacing-2);
            border-radius: var(--radius-md);
        }

        .sidebar-toggle:hover {
            background-color: var(--background-color);
            color: var(--text-primary);
        }

        .sidebar-brand {
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
        }

        .brand-logo {
            color: var(--primary-color);
        }

        .brand-text {
            font-weight: 700;
            font-size: var(--font-size-lg);
            color: var(--text-primary);
        }

        .sidebar-user {
            padding: var(--spacing-6) var(--spacing-4);
            display: flex;
            align-items: center;
            gap: var(--spacing-4);
            border-bottom: 1px solid var(--border-color);
        }

        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .user-email {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }

        .sidebar-stats {
            padding: var(--spacing-4);
            border-bottom: 1px solid var(--border-color);
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-4);
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .stat-label {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-1);
        }

        .stat-value {
            font-weight: 700;
            font-size: var(--font-size-lg);
            color: var(--text-primary);
        }

        .sidebar-nav {
            flex: 1;
            padding: var(--spacing-4) 0;
            overflow-y: auto;
        }

        .nav-item {
            margin-bottom: var(--spacing-1);
        }

        .nav-link {
            width: 100%;
            background: none;
            border: none;
            padding: var(--spacing-3) var(--spacing-4);
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
            cursor: pointer;
            color: var(--text-secondary);
            transition: all var(--transition-normal);
            border-radius: 0 var(--radius-md) var(--radius-md) 0;
            text-align: right;
        }

        .nav-link:hover {
            background-color: var(--background-color);
            color: var(--text-primary);
        }

        .nav-link.active {
            background-color: var(--primary-color);
            color: white;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .nav-text {
            flex: 1;
        }

        .nav-badge {
            background-color: var(--accent-color);
            color: white;
            font-size: var(--font-size-xs);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
        }

        .sidebar-footer {
            padding: var(--spacing-4);
            border-top: 1px solid var(--border-color);
        }

        .sidebar-actions {
            display: flex;
            justify-content: space-around;
            margin-bottom: var(--spacing-4);
        }

        .sidebar-action {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            padding: var(--spacing-2);
            border-radius: var(--radius-md);
        }

        .sidebar-action:hover {
            background-color: var(--background-color);
            color: var(--text-primary);
        }

        .sidebar-storage {
            background-color: var(--background-color);
            padding: var(--spacing-3);
            border-radius: var(--radius-md);
        }

        .storage-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-2);
        }

        .storage-label {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        .storage-value {
            font-size: var(--font-size-xs);
            font-weight: 600;
            color: var(--text-primary);
        }

        .storage-bar {
            height: 4px;
            background-color: var(--border-color);
            border-radius: var(--radius-sm);
            overflow: hidden;
        }

        .storage-progress {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: var(--radius-sm);
            transition: width var(--transition-slow);
        }

        /* المحتوى الرئيسي */
        .main-content {
            flex: 1;
            margin-right: 280px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* رأس الموبايل */
        .mobile-header {
            display: none;
            padding: var(--spacing-4);
            background-color: var(--surface-color);
            border-bottom: 1px solid var(--border-color);
            align-items: center;
            justify-content: space-between;
        }

        .mobile-menu-toggle {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            padding: var(--spacing-2);
            border-radius: var(--radius-md);
        }

        .mobile-menu-toggle:hover {
            background-color: var(--background-color);
            color: var(--text-primary);
        }

        .mobile-title h1 {
            margin-bottom: 0;
            font-size: var(--font-size-xl);
        }

        .mobile-actions {
            display: flex;
            gap: var(--spacing-2);
        }

        .mobile-action {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            padding: var(--spacing-2);
            border-radius: var(--radius-md);
            position: relative;
        }

        .mobile-action:hover {
            background-color: var(--background-color);
            color: var(--text-primary);
        }

        .notification-badge {
            position: absolute;
            top: 0;
            left: 0;
            background-color: var(--error-color);
            color: white;
            font-size: var(--font-size-xs);
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notification-badge.hidden {
            display: none;
        }

        /* حاوية الصفحة */
        .page-container {
            flex: 1;
            padding: var(--spacing-6);
        }

        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* رأس الصفحة */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-8);
        }

        .page-title-section h1 {
            margin-bottom: var(--spacing-2);
        }

        .page-subtitle {
            color: var(--text-secondary);
        }

        .page-actions {
            display: flex;
            gap: var(--spacing-3);
        }

        /* شبكة الإحصائيات */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-6);
            margin-bottom: var(--spacing-8);
        }

        .stat-card {
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-6);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .stat-card.primary {
            border-top: 4px solid var(--primary-color);
        }

        .stat-card.success {
            border-top: 4px solid var(--success-color);
        }

        .stat-card.warning {
            border-top: 4px solid var(--warning-color);
        }

        .stat-card.info {
            border-top: 4px solid var(--info-color);
        }

        .stat-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-4);
        }

        .stat-info h3 {
            font-size: var(--font-size-sm);
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-2);
        }

        .stat-number {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            color: var(--text-primary);
        }

        .stat-icon {
            color: var(--text-muted);
            background-color: var(--background-color);
            padding: var(--spacing-2);
            border-radius: var(--radius-md);
        }

        .stat-footer {
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
        }

        .stat-change {
            font-size: var(--font-size-sm);
            font-weight: 600;
        }

        .stat-change.positive {
            color: var(--success-color);
        }

        .stat-change.negative {
            color: var(--error-color);
        }

        .stat-period {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
        }

        /* أقسام لوحة التحكم */
        .dashboard-section {
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-6);
            margin-bottom: var(--spacing-6);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-6);
        }

        .section-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0;
        }

        .section-subtitle {
            color: var(--text-secondary);
            margin-top: var(--spacing-2);
        }

        .section-actions {
            display: flex;
            gap: var(--spacing-3);
        }

        /* قائمة النشاط */
        .activity-container {
            max-height: 400px;
            overflow-y: auto;
        }

        .activity-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-4);
        }

        .activity-item {
            display: flex;
            gap: var(--spacing-4);
            padding: var(--spacing-4);
            border-radius: var(--radius-md);
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            margin-bottom: var(--spacing-1);
        }

        .activity-description {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            margin-bottom: var(--spacing-2);
        }

        .activity-time {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
        }

        /* المنشورات القادمة */
        .upcoming-container {
            max-height: 300px;
            overflow-y: auto;
        }

        .upcoming-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-3);
        }

        .upcoming-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-3);
            border-radius: var(--radius-md);
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
        }

        .upcoming-content {
            flex: 1;
        }

        .upcoming-title {
            font-weight: 600;
            margin-bottom: var(--spacing-1);
        }

        .upcoming-platform {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-1);
        }

        .upcoming-time {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
        }

        .upcoming-actions {
            display: flex;
            gap: var(--spacing-2);
        }

        /* منصات التواصل */
        .platforms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-6);
        }

        .platform-card {
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-5);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
        }

        .platform-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .platform-card.facebook {
            border-top: 4px solid #1877f2;
        }

        .platform-card.instagram {
            border-top: 4px solid #e4405f;
        }

        .platform-card.twitter {
            border-top: 4px solid #1da1f2;
        }

        .platform-card.linkedin {
            border-top: 4px solid #0077b5;
        }

        .platform-card.tiktok {
            border-top: 4px solid #000000;
        }

        .platform-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
            margin-bottom: var(--spacing-4);
        }

        .platform-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
            flex-shrink: 0;
        }

        .platform-card.facebook .platform-icon {
            background-color: rgba(24, 119, 242, 0.1);
            color: #1877f2;
        }

        .platform-card.instagram .platform-icon {
            background-color: rgba(228, 64, 95, 0.1);
            color: #e4405f;
        }

        .platform-card.twitter .platform-icon {
            background-color: rgba(29, 161, 242, 0.1);
            color: #1da1f2;
        }

        .platform-card.linkedin .platform-icon {
            background-color: rgba(0, 119, 181, 0.1);
            color: #0077b5;
        }

        .platform-card.tiktok .platform-icon {
            background-color: rgba(0, 0, 0, 0.1);
            color: #000000;
        }

        .platform-info {
            flex: 1;
        }

        .platform-name {
            font-weight: 600;
            margin-bottom: var(--spacing-1);
        }

        .platform-status {
            font-size: var(--font-size-xs);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            display: inline-block;
        }

        .platform-status.online {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--success-color);
        }

        .platform-status.offline {
            background-color: rgba(229, 62, 62, 0.1);
            color: var(--error-color);
        }

        .platform-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-3);
        }

        .platform-stat {
            text-align: center;
        }

        .stat-label {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-1);
        }

        .stat-value {
            font-weight: 700;
            font-size: var(--font-size-lg);
        }

        /* قسم الاستيراد المجمع */
        .import-stats-bar {
            display: flex;
            gap: var(--spacing-8);
            padding: var(--spacing-4);
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            margin-bottom: var(--spacing-6);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .import-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .import-stat-label {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-1);
        }

        .import-stat-value {
            font-weight: 700;
            font-size: var(--font-size-lg);
            color: var(--text-primary);
        }

        /* رفع الملفات */
        .upload-section {
            margin-bottom: var(--spacing-8);
        }

        .upload-container {
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-6);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .file-drop-zone {
            border: 2px dashed var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-10) var(--spacing-6);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-normal);
            margin-bottom: var(--spacing-4);
        }

        .file-drop-zone:hover {
            border-color: var(--accent-color);
            background-color: rgba(66, 153, 225, 0.05);
        }

        .file-drop-zone.drag-over {
            border-color: var(--accent-color);
            background-color: rgba(66, 153, 225, 0.1);
        }

        .drop-zone-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-4);
        }

        .upload-icon {
            color: var(--accent-color);
        }

        .upload-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            color: var(--text-primary);
        }

        .upload-subtitle {
            color: var(--text-secondary);
        }

        .upload-instructions {
            background-color: var(--background-color);
            padding: var(--spacing-4);
            border-radius: var(--radius-md);
            margin-top: var(--spacing-4);
            text-align: right;
        }

        .upload-instructions p {
            margin-bottom: var(--spacing-2);
            font-size: var(--font-size-sm);
        }

        .upload-instructions strong {
            color: var(--text-primary);
        }

        .file-info {
            margin-bottom: var(--spacing-4);
        }

        .file-info-card {
            display: flex;
            align-items: center;
            gap: var(--spacing-4);
            padding: var(--spacing-4);
            background-color: var(--background-color);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }

        .file-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .file-icon.csv {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--success-color);
        }

        .file-icon.json {
            background-color: rgba(66, 153, 225, 0.1);
            color: var(--accent-color);
        }

        .file-details {
            flex: 1;
        }

        .file-name {
            font-weight: 600;
            margin-bottom: var(--spacing-1);
        }

        .file-meta {
            display: flex;
            gap: var(--spacing-3);
        }

        .file-size, .file-type {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        .file-actions {
            flex-shrink: 0;
        }

        .clear-file-btn {
            background: none;
            border: none;
            color: var(--error-color);
            cursor: pointer;
            font-size: var(--font-size-sm);
            padding: var(--spacing-1) var(--spacing-2);
        }

        .clear-file-btn:hover {
            background-color: rgba(229, 62, 62, 0.1);
            border-radius: var(--radius-sm);
        }

        .upload-actions {
            display: flex;
            gap: var(--spacing-3);
            justify-content: center;
        }

        /* متطلبات الملف */
        .requirements-section {
            margin-bottom: var(--spacing-8);
        }

        .requirements-content {
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-6);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .requirements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-6);
        }

        .requirement-item {
            padding: var(--spacing-4);
            background-color: var(--background-color);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }

        .requirement-title {
            font-weight: 600;
            margin-bottom: var(--spacing-2);
            color: var(--text-primary);
        }

        .requirement-desc {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-3);
            font-size: var(--font-size-sm);
        }

        .requirement-example {
            background-color: var(--surface-color);
            padding: var(--spacing-3);
            border-radius: var(--radius-sm);
            font-family: monospace;
            font-size: var(--font-size-sm);
            color: var(--text-primary);
            display: block;
            overflow-x: auto;
        }

        /* نماذج الملفات */
        .templates-section {
            margin-bottom: var(--spacing-8);
        }

        .templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-6);
        }

        .template-card {
            display: flex;
            flex-direction: column;
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-6);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
        }

        .template-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .template-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--spacing-4);
        }

        .template-icon.csv {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--success-color);
        }

        .template-icon.json {
            background-color: rgba(66, 153, 225, 0.1);
            color: var(--accent-color);
        }

        .template-info {
            flex: 1;
            margin-bottom: var(--spacing-4);
        }

        .template-title {
            font-weight: 600;
            margin-bottom: var(--spacing-2);
            color: var(--text-primary);
        }

        .template-desc {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        /* تقدم الاستيراد */
        .progress-section {
            margin-bottom: var(--spacing-8);
        }

        .progress-container {
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-6);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .progress-bar-container {
            margin-bottom: var(--spacing-6);
        }

        .progress-bar {
            height: 8px;
            background-color: var(--border-color);
            border-radius: var(--radius-sm);
            overflow: hidden;
            margin-bottom: var(--spacing-3);
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: var(--radius-sm);
            transition: width var(--transition-slow);
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-text {
            font-weight: 600;
            color: var(--text-primary);
        }

        .progress-percent {
            font-weight: 700;
            color: var(--primary-color);
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-6);
            position: relative;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 16px;
            right: 0;
            left: 0;
            height: 2px;
            background-color: var(--border-color);
            z-index: 1;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .step-indicator {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--spacing-2);
            transition: all var(--transition-normal);
        }

        .progress-step.active .step-indicator {
            background-color: var(--primary-color);
            color: white;
        }

        .progress-step.completed .step-indicator {
            background-color: var(--success-color);
            color: white;
        }

        .step-label {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            text-align: center;
        }

        .progress-step.active .step-label {
            color: var(--text-primary);
            font-weight: 600;
        }

        .progress-status {
            text-align: center;
        }

        .status-indicator {
            display: inline-block;
            padding: var(--spacing-2) var(--spacing-4);
            border-radius: var(--radius-md);
            font-weight: 600;
        }

        .status-indicator.processing {
            background-color: rgba(66, 153, 225, 0.1);
            color: var(--accent-color);
        }

        .status-indicator.completed {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--success-color);
        }

        .status-indicator.failed {
            background-color: rgba(229, 62, 62, 0.1);
            color: var(--error-color);
        }

        /* نتائج الاستيراد */
        .results-section {
            margin-bottom: var(--spacing-8);
        }

        .import-success, .import-error {
            display: flex;
            align-items: center;
            gap: var(--spacing-4);
            padding: var(--spacing-6);
            border-radius: var(--radius-lg);
        }

        .import-success {
            background-color: rgba(56, 161, 105, 0.1);
            border: 1px solid rgba(56, 161, 105, 0.2);
        }

        .import-error {
            background-color: rgba(229, 62, 62, 0.1);
            border: 1px solid rgba(229, 62, 62, 0.2);
        }

        .success-icon, .error-icon {
            font-size: var(--font-size-3xl);
            flex-shrink: 0;
        }

        .success-message h3, .error-message h3 {
            margin-bottom: var(--spacing-3);
        }

        .import-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-4);
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            display: block;
            font-size: var(--font-size-2xl);
            font-weight: 700;
            margin-bottom: var(--spacing-1);
        }

        .import-success .stat-number {
            color: var(--success-color);
        }

        .import-error .stat-number {
            color: var(--error-color);
        }

        .stat-label {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        .error-details {
            margin-top: var(--spacing-3);
        }

        .error-item {
            padding: var(--spacing-2);
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: var(--radius-sm);
            margin-bottom: var(--spacing-2);
            font-size: var(--font-size-sm);
        }

        /* تاريخ الاستيراد */
        .history-section {
            margin-bottom: var(--spacing-8);
        }

        .history-container {
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .history-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-4);
            border-bottom: 1px solid var(--border-color);
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-info {
            flex: 1;
        }

        .history-filename {
            font-weight: 600;
            margin-bottom: var(--spacing-1);
        }

        .history-date {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        .history-stats {
            display: flex;
            gap: var(--spacing-4);
            margin: 0 var(--spacing-4);
        }

        .history-status {
            padding: var(--spacing-1) var(--spacing-3);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
            font-weight: 600;
        }

        .status-completed {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--success-color);
        }

        .status-processing {
            background-color: rgba(66, 153, 225, 0.1);
            color: var(--accent-color);
        }

        .status-failed {
            background-color: rgba(229, 62, 62, 0.1);
            color: var(--error-color);
        }

        /* حالات التحميل */
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-12);
            color: var(--text-secondary);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: var(--spacing-4);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* الحالات الفارغة */
        .empty-state {
            text-align: center;
            padding: var(--spacing-8);
            color: var(--text-secondary);
        }

        /* مؤشر عدم الاتصال */
        .offline-indicator {
            position: fixed;
            bottom: var(--spacing-4);
            left: var(--spacing-4);
            background-color: var(--error-color);
            color: white;
            padding: var(--spacing-3) var(--spacing-4);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
        }

        /* النوافذ المنبثقة */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-container {
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            z-index: 2001;
            transform: scale(0.9);
            transition: transform var(--transition-normal);
        }

        .modal.active .modal-container {
            transform: scale(1);
        }

        .modal-container.small {
            max-width: 400px;
        }

        .modal-container.large {
            max-width: 800px;
        }

        .modal-header {
            padding: var(--spacing-5) var(--spacing-6);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            margin-bottom: 0;
        }

        .modal-close {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            padding: var(--spacing-1);
            border-radius: var(--radius-md);
        }

        .modal-close:hover {
            background-color: var(--background-color);
            color: var(--text-primary);
        }

        .modal-content {
            padding: var(--spacing-6);
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: var(--spacing-5) var(--spacing-6);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-3);
        }

        /* الإشعارات */
        .toast-container {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            align-items: center;
            pointer-events: none;
        }

        .toast {
            background: var(--surface-color);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-4);
            margin-bottom: var(--spacing-3);
            display: flex;
            align-items: center;
            min-width: 300px;
            max-width: 500px;
            opacity: 0;
            transform: translateY(-20px);
            transition: all var(--transition-normal);
            pointer-events: auto;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.hide {
            opacity: 0;
            transform: translateY(-20px);
        }

        .toast-content {
            display: flex;
            align-items: center;
            width: 100%;
        }

        .toast-icon {
            margin-left: var(--spacing-3);
            font-size: var(--font-size-xl);
        }

        .toast-message {
            flex: 1;
            font-size: var(--font-size-sm);
            color: var(--text-primary);
        }

        .toast-close {
            background: none;
            border: none;
            font-size: var(--font-size-lg);
            cursor: pointer;
            color: var(--text-muted);
            padding: 0;
            margin-right: var(--spacing-2);
        }

        .toast-success {
            border-right: 4px solid var(--success-color);
        }

        .toast-error {
            border-right: 4px solid var(--error-color);
        }

        .toast-warning {
            border-right: 4px solid var(--warning-color);
        }

        .toast-info {
            border-right: 4px solid var(--info-color);
        }

        /* التجاوب مع الشاشات المختلفة */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(100%);
                box-shadow: var(--shadow-xl);
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-right: 0;
            }
            
            .mobile-header {
                display: flex;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .platforms-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                gap: var(--spacing-4);
            }
            
            .page-actions {
                width: 100%;
                justify-content: flex-end;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .platforms-grid {
                grid-template-columns: 1fr;
            }
            
            .requirements-grid {
                grid-template-columns: 1fr;
            }
            
            .templates-grid {
                grid-template-columns: 1fr;
            }
            
            .import-stats-bar {
                flex-direction: column;
                gap: var(--spacing-4);
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-4);
            }
            
            .section-actions {
                width: 100%;
                justify-content: flex-end;
            }
            
            .upload-actions {
                flex-direction: column;
            }
            
            .history-item {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-3);
            }
            
            .history-stats {
                margin: var(--spacing-2) 0;
            }
            
            .auth-container {
                padding: var(--spacing-8);
            }
            
            .modal-container {
                margin: var(--spacing-4);
                width: calc(100% - var(--spacing-8));
            }
        }

        @media (max-width: 480px) {
            :root {
                --spacing-6: 1rem;
            }
            
            .page-container {
                padding: var(--spacing-4);
            }
            
            .dashboard-section {
                padding: var(--spacing-4);
            }
            
            .stat-card {
                padding: var(--spacing-4);
            }
            
            .upload-container {
                padding: var(--spacing-4);
            }
            
            .file-drop-zone {
                padding: var(--spacing-6) var(--spacing-4);
            }
            
            .requirements-content {
                padding: var(--spacing-4);
            }
            
            .progress-container {
                padding: var(--spacing-4);
            }
            
            .progress-steps {
                flex-direction: column;
                gap: var(--spacing-4);
            }
            
            .progress-steps::before {
                display: none;
            }
            
            .progress-step {
                flex-direction: row;
                gap: var(--spacing-3);
            }
            
            .step-label {
                text-align: right;
            }
            
            .modal-container {
                margin: var(--spacing-2);
                width: calc(100% - var(--spacing-4));
            }
            
            .modal-header,
            .modal-content,
            .modal-footer {
                padding: var(--spacing-4);
            }
        }

        /* حالة التركيز لإمكانية الوصول */
        button:focus-visible,
        input:focus-visible,
        select:focus-visible,
        textarea:focus-visible,
        a:focus-visible {
            outline: 2px solid var(--accent-color);
            outline-offset: 2px;
        }

        /* الطباعة */
        @media print {
            .sidebar,
            .mobile-header,
            .page-actions,
            .section-actions,
            .btn {
                display: none !important;
            }
            
            .main-content {
                margin-right: 0;
            }
            
            .page-container {
                padding: 0;
            }
            
            .dashboard-section {
                box-shadow: none;
                border: none;
                break-inside: avoid;
            }
            
            body {
                background-color: white;
                color: black;
            }
        }

        /* فئات المساعدة */
        .hidden {
            display: none !important;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .text-center {
            text-align: center;
        }

        .text-left {
            text-align: left;
        }

        .text-right {
            text-align: right;
        }

        .mt-4 { margin-top: var(--spacing-4); }
        .mb-4 { margin-bottom: var(--spacing-4); }
        .ml-4 { margin-left: var(--spacing-4); }
        .mr-4 { margin-right: var(--spacing-4); }
        .mx-4 { margin-left: var(--spacing-4); margin-right: var(--spacing-4); }
        .my-4 { margin-top: var(--spacing-4); margin-bottom: var(--spacing-4); }

        .pt-4 { padding-top: var(--spacing-4); }
        .pb-4 { padding-bottom: var(--spacing-4); }
        .pl-4 { padding-left: var(--spacing-4); }
        .pr-4 { padding-right: var(--spacing-4); }
        .px-4 { padding-left: var(--spacing-4); padding-right: var(--spacing-4); }
        .py-4 { padding-top: var(--spacing-4); padding-bottom: var(--spacing-4); }

        /* إضافات CSS جديدة للتحسينات الاحترافية */
        .console-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 200px;
            background: #1a1a1a;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 10px;
            overflow-y: auto;
            z-index: 9999;
            border-top: 2px solid #333;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            display: none;
        }

        .console-panel.active {
            transform: translateY(0);
            display: block;
        }

        .console-log {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 3px;
        }

        .console-log.error {
            background-color: rgba(255, 0, 0, 0.1);
            border-left: 3px solid #ff0000;
            color: #ff6b6b;
        }

        .console-log.warn {
            background-color: rgba(255, 165, 0, 0.1);
            border-left: 3px solid #ffa500;
            color: #ffb74d;
        }

        .console-log.info {
            background-color: rgba(0, 123, 255, 0.1);
            border-left: 3px solid #007bff;
            color: #4fc3f7;
        }

        .console-log.debug {
            background-color: rgba(0, 255, 0, 0.1);
            border-left: 3px solid #00ff00;
            color: #81c784;
        }

        .console-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #333;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 10000;
            font-size: 12px;
        }

        .error-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 99999;
        }

        .error-dialog {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            text-align: center;
        }

        .performance-stats {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 10000;
            display: none;
        }

        .performance-stats.show {
            display: block;
        }
    </style>
</head>
<body>
    <!-- مؤشر الأداء -->
    <div class="performance-stats" id="performanceStats">
        <div>Memory: <span id="memoryUsage">0</span>MB</div>
        <div>Load Time: <span id="loadTime">0</span>ms</div>
        <div>Errors: <span id="errorCount">0</span></div>
    </div>

    <!-- وحدة تحكم الأخطاء -->
    <div class="console-panel" id="consolePanel">
        <div id="consoleContent"></div>
    </div>
    <button class="console-toggle" onclick="toggleConsole()">🔧 وحدة التحكم</button>

    <!-- رسالة خطأ عامة -->
    <div class="error-overlay" id="errorOverlay">
        <div class="error-dialog">
            <h3>حدث خطأ غير متوقع</h3>
            <p id="errorMessage">يرجى إعادة تحميل الصفحة والمحاولة مرة أخرى</p>
            <button onclick="location.reload()">إعادة تحميل</button>
            <button onclick="hideErrorOverlay()">إخفاء</button>
        </div>
    </div>

    <!-- محتوى HTML الأساسي -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <!-- =================================================================
         SOCIALHUB PRO v11.0 - BULK IMPORT FOCUSED SYSTEM
         Production-Grade HTML - Real Implementation Only
         Focus: Bulk Import with JSON/CSV Support + Auto File Cleanup
         ================================================================= -->
    
    <!-- Basic Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- SEO Meta Tags -->
    <title>SocialHub Pro - نظام الاستيراد المجمع للمنصات الاجتماعية</title>
    <meta name="description" content="نظام متطور لاستيراد ونشر المحتوى على منصات التواصل الاجتماعي بشكل مجمع. يدعم ملفات JSON و CSV مع جدولة تلقائية وإدارة ذكية للملفات.">
    <meta name="keywords" content="استيراد مجمع, منصات اجتماعية, فيسبوك, إنستغرام, تويتر, لينكد إن, تيك توك, جدولة منشورات, إدارة محتوى, تسويق رقمي">
    <meta name="author" content="SocialHub Pro Team">
    <meta name="robots" content="index, follow">
    <meta name="language" content="Arabic">
    <meta name="revisit-after" content="7 days">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="SocialHub Pro - نظام الاستيراد المجمع">
    <meta property="og:description" content="أتمت عملية نشر المحتوى على جميع منصات التواصل الاجتماعي">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://socialhub-pro.com">
    <meta property="og:image" content="https://socialhub-pro.com/assets/og-image.jpg">
    <meta property="og:site_name" content="SocialHub Pro">
    <meta property="og:locale" content="ar_AE">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="SocialHub Pro - نظام الاستيراد المجمع">
    <meta name="twitter:description" content="أتمت عملية نشر المحتوى على جميع منصات التواصل الاجتماعي">
    <meta name="twitter:image" content="https://socialhub-pro.com/assets/twitter-image.jpg">
    <meta name="twitter:creator" content="@SocialHubPro">
    
    <!-- Progressive Web App -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#1a365d">
    <meta name="background-color" content="#ffffff">
    <meta name="display" content="standalone">
    <meta name="orientation" content="portrait">
    
    <!-- Apple Specific Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SocialHub Pro">
    <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
    
    <!-- Microsoft Specific Meta Tags -->
    <meta name="msapplication-TileColor" content="#1a365d">
    <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
    <meta name="msapplication-config" content="/browserconfig.xml">
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
    
    <!-- Performance Hints -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link rel="dns-prefetch" href="//www.googleapis.com">
    <link rel="dns-prefetch" href="//firebaseapp.com">
    <link rel="dns-prefetch" href="//firestore.googleapis.com">
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://socialhub-pro.firebaseapp.com">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self' https:;
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.gstatic.com https://www.googleapis.com https://apis.google.com;
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
        font-src 'self' https://fonts.gstatic.com;
        img-src 'self' data: https: blob:;
        connect-src 'self' https://identitytoolkit.googleapis.com https://firestore.googleapis.com https://securetoken.googleapis.com;
        media-src 'self' https:;
        object-src 'none';
        base-uri 'self';
        form-action 'self';
        frame-ancestors 'none';
        upgrade-insecure-requests;
    ">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=()">
    
    <!-- Fonts -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700;800&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700;800&display=swap">
    </noscript>
    
    <!-- Stylesheets -->
    <style>
        /* Critical CSS - Above the Fold */
        :root {
            --primary-color: #1a365d;
            --secondary-color: #2d3748;
            --accent-color: #3182ce;
            --success-color: #38a169;
            --warning-color: #d69e2e;
            --error-color: #e53e3e;
            --info-color: #3182ce;
            --background-color: #f7fafc;
            --surface-color: #ffffff;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --border-color: #e2e8f0;
            --border-hover: #cbd5e0;
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --font-family: 'Noto Sans Arabic', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-size-4xl: 2.25rem;
            --spacing-1: 0.25rem;
            --spacing-2: 0.5rem;
            --spacing-3: 0.75rem;
            --spacing-4: 1rem;
            --spacing-5: 1.25rem;
            --spacing-6: 1.5rem;
            --spacing-8: 2rem;
            --spacing-10: 2.5rem;
            --spacing-12: 3rem;
            --spacing-16: 4rem;
            --radius-sm: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;
            --transition-fast: 150ms ease;
            --transition-normal: 200ms ease;
            --transition-slow: 300ms ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            font-size: 16px;
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-primary);
            direction: rtl;
            text-align: right;
            overflow-x: hidden;
        }
        
        /* Loading Screen Styles */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity var(--transition-slow);
        }
        
        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-logo {
            width: 120px;
            height: 120px;
            margin-bottom: var(--spacing-6);
            animation: pulse 2s infinite;
        }
        
        .loading-text {
            color: white;
            font-size: var(--font-size-lg);
            font-weight: 600;
            margin-bottom: var(--spacing-4);
        }
        
        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            overflow: hidden;
        }
        
        .loading-progress-bar {
            height: 100%;
            background: white;
            border-radius: var(--radius-sm);
            animation: loading 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        
        @keyframes loading {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        
        /* Authentication Screen Styles */
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--background-color);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9998;
        }
        
        .auth-screen.active {
            display: flex;
        }
        
        .auth-container {
            background: var(--surface-color);
            padding: var(--spacing-12);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .auth-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--spacing-6);
        }
        
        .auth-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            margin-bottom: var(--spacing-2);
        }
        
        .auth-subtitle {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-8);
        }
        
        .auth-button {
            width: 100%;
            padding: var(--spacing-4);
            border: none;
            border-radius: var(--radius-lg);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            margin-bottom: var(--spacing-3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-3);
        }
        
        .auth-button:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .auth-button.google {
            background: #4285f4;
            color: white;
        }
        
        /* Hidden class */
        .hidden {
            display: none !important;
        }
        
        /* Skip to content link */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--primary-color);
            color: white;
            padding: 8px;
            text-decoration: none;
            border-radius: var(--radius-md);
            z-index: 10000;
        }
        
        .skip-link:focus {
            top: 6px;
        }

        /* Toast Container Styles */
        .toast-container {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            align-items: center;
            pointer-events: none;
        }
        
        .toast {
            background: var(--surface-color);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-4);
            margin-bottom: var(--spacing-3);
            display: flex;
            align-items: center;
            min-width: 300px;
            max-width: 500px;
            opacity: 0;
            transform: translateY(-20px);
            transition: all var(--transition-normal);
            pointer-events: auto;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .toast.hide {
            opacity: 0;
            transform: translateY(-20px);
        }
        
        .toast-content {
            display: flex;
            align-items: center;
            width: 100%;
        }
        
        .toast-icon {
            margin-left: var(--spacing-3);
            font-size: var(--font-size-xl);
        }
        
        .toast-message {
            flex: 1;
            font-size: var(--font-size-sm);
            color: var(--text-primary);
        }
        
        .toast-close {
            background: none;
            border: none;
            font-size: var(--font-size-lg);
            cursor: pointer;
            color: var(--text-muted);
            padding: 0;
            margin-right: var(--spacing-2);
        }
        
        .toast-success {
            border-right: 4px solid var(--success-color);
        }
        
        .toast-error {
            border-right: 4px solid var(--error-color);
        }
        
        .toast-warning {
            border-right: 4px solid var(--warning-color);
        }
        
        .toast-info {
            border-right: 4px solid var(--info-color);
        }

        /* Screen reader only */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
    
    <link rel="stylesheet" href="style.css">
    
    <!-- Schema.org JSON-LD -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "SocialHub Pro",
        "description": "نظام متطور لاستيراد ونشر المحتوى على منصات التواصل الاجتماعي",
        "url": "https://socialhub-pro.com",
        "author": {
            "@type": "Organization",
            "name": "SocialHub Pro Team"
        },
        "operatingSystem": "Web",
        "applicationCategory": "BusinessApplication",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        }
    }
    </script>
</head>

<body>
    <!-- Skip to content link for accessibility -->
    <a href="#main-content" class="skip-link">الانتقال إلى المحتوى الرئيسي</a>

    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen" role="status" aria-label="جاري تحميل التطبيق">
        <svg class="loading-logo" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <circle cx="60" cy="60" r="50" stroke="white" stroke-width="2" fill="none" opacity="0.3"/>
            <path d="M60 10 C88.7 10 110 31.3 110 60" stroke="white" stroke-width="4" fill="none" stroke-linecap="round">
                <animateTransform attributeName="transform" type="rotate" values="0 60 60;360 60 60" dur="1s" repeatCount="indefinite"/>
            </path>
        </svg>
        <h1 class="loading-text">SocialHub Pro</h1>
        <div class="loading-progress">
            <div class="loading-progress-bar"></div>
        </div>
        <p class="sr-only">جاري تحميل نظام الاستيراد المجمع...</p>
    </div>

    <!-- Authentication Screen -->
    <div id="authScreen" class="auth-screen" role="dialog" aria-labelledby="auth-title" aria-describedby="auth-subtitle">
        <div class="auth-container">
            <svg class="auth-logo" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <rect width="80" height="80" rx="16" fill="var(--primary-color)"/>
                <path d="M25 35h30v10H25V35z" fill="white"/>
                <path d="M25 50h20v10H25V50z" fill="white"/>
                <path d="M50 50h5v10h-5V50z" fill="white"/>
            </svg>
            
            <h2 id="auth-title" class="auth-title">أهلاً بك في SocialHub Pro</h2>
            <p id="auth-subtitle" class="auth-subtitle">قم بتسجيل الدخول للوصول إلى نظام الاستيراد المجمع</p>
            
            <button id="signInGoogle" class="auth-button google" aria-describedby="google-desc">
                <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
                    <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="currentColor" d="M12 5.38c1.62 极 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                الدخول باستخدام Google
            </button>
            <div id="google-desc" class="sr-only">تسجيل الدخول باستخدام حساب Google الخاص بك</div>
            
            <div id="authError" class="auth-error" style="display: none; color: var(--error-color); padding: var(--spacing-3); background-color: rgba(229, 62, 62, 0.1); border-radius: var(--radius-md); margin-top: var(--spacing-4);" role="alert" aria-live="polite"></div>
            <div class="auth-footer">
                <p><small>بالمتابعة، أنت توافق على <a href="/terms">الشروط والأحكام</a> و <a href="/privacy">سياسة الخصوصية</a></small></p>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container" aria-live="polite" aria-label="الإشعارات"></div>

    <!-- Main Application -->
    <div id="mainApp" class="main-app hidden">
        <!-- Sidebar Overlay for Mobile -->
        <div id="sidebarOverlay" class="sidebar-overlay"></div>
        
        <!-- Sidebar Navigation -->
        <nav id="sidebar" class="sidebar" role="navigation" aria-label="التنقل الرئيسي">
            <div class="sidebar-header">
                <button id="sidebarToggle" class="sidebar-toggle" aria-label="إغلاق القائمة الجانبية" aria-expanded="true">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="18"极="21" y2="18"></line>
                    </svg>
                </button>
                
                <div class="sidebar-brand">
                    <svg class="brand-logo" width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <rect width="32" height="极" rx="8" fill="var(--primary-color)"/>
                        <rect x="6" y="10" width="20" height="3" fill="white"/>
                        <rect x="6" y="15" width="14" height="3" fill="white"/>
                        <rect x="22" y="15" width="4" height="3" fill="white"/>
                        <rect x="6" y="20" width="10" height="3" fill="white"/>
                    </svg>
                    <span class="brand-text">SocialHub Pro</span>
                </div>
            </div>
            
            <!-- User Profile Section -->
            <div class="sidebar-user">
                <img id="userAvatar" class="user-avatar" src="" alt="صورة المستخدم" loading="lazy">
                <div class="user-info">
                    <div id="userName" class="user-name">المستخدم</div>
                    <div id="userEmail" class="user-email">user@example.com</div>
                </div>
            </div>
            
            <!-- Quick Stats -->
            <div class="sidebar-stats">
                <div class="stat-item">
                    <span class="stat-label">عمليات الاستيراد</span>
                    <span id="sidebarImports" class="stat-value">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">مجدولة اليوم</span>
                    <span id="sidebarScheduled" class="stat-value">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">حسابات متصلة</span>
                    <span id="sidebarAccounts" class="stat-value">0</span>
                </div>
            </div>
            
            <!-- Navigation Menu -->
            <ul class="sidebar-nav" role="list">
                <li class="nav-item">
                    <button id="navDashboard" class="nav-link active" aria-current="page" data-page="dashboard">
                        <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                        <span class="nav-text">لوحة التحكم</span>
                    </button>
                </li>
                
                <li class="nav-item">
                    <button id="navBulkImport" class="nav-link" data-page="bulk-import">
                        <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="极" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 极 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14,2 14,8 20,8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10,9 9,9 8,9"></polyline>
                        </svg>
                        <span class="nav-text">الاستيراد المجمع</span>
                        <span class="nav-badge">جديد</span>
                    </button>
                </li>
                
                <li class="nav-item">
                    <button id="navAnalytics" class="nav-link" data-page="analytics">
                        <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"></polyline>
                        </svg>
                        <span class="nav-text">التحليلات</span>
                    </button>
                </li>
                
                <li class="nav-item">
                    <button id="navAccounts" class="nav-link" data极="accounts">
                        <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path d="M极 21v-2a4 4 0 0 0-4-4H5a4 4 极 0 0-4 4v2"></path>
                            <circle cx="8.5" cy="7" r="4"></circle>
                            <line x1="20" y1="8" x2="20" y2="14"></line>
                            <line x1="23" y1="11" x2="17" y2="11"></极>
                        </svg>
                        <span class="nav-text">إدارة الحسابات</span>
                    </button>
                </li>
                
                <li class="nav-item">
                    <button id="navSettings" class="nav-link" data-page="settings">
                        <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1m10-7a4 4 0 0 1 0 8 4 4 0 0 1 0-8zM1 12a4 4 0 0 1 8 0 4 4 0 0 1-8 0zm18 0a4 4 0 0 1-8 0 4 4 0 0 1 8 0z"></path>
                        </svg>
                        <span class="nav-text">الإعدادات</span>
                    </button>
                </li>
            </ul>
            
            <!-- Sidebar Footer -->
            <div class="sidebar-footer">
                <div class="sidebar-actions">
                    <button id="themeToggle" class="sidebar-action" aria-label="تغيير المظهر" title="تغيير المظهر">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </button>
                    
                    <button id="helpCenter" class="sidebar-action" aria-label="مركز المساعدة" title="مركز المساعدة">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c极 2-3 3-3 3"></path>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                    </button>
                    
                    <button id="signOut" class="sidebar-action" aria-label="تسجيل الخروج" title="تسجيل الخروج">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16,17 21,12 16,7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                    </button>
                </div>
                
                <div class="sidebar-storage">
                    <div class="storage-info">
                        <span class="storage-label">المساحة المستخدمة</span>
                        <span id="storageUsage" class="storage-value">0 MB</span>
                    </div>
                    <div class="storage-bar">
                        <div id="storageBar" class="storage-progress" style="width: 0%"></极>
                    </div>
                </div>
            </div>
        </nav>
        
        <!-- Main Content Area -->
        <main id="main-content" class="main-content" role="main">
            <!-- Mobile Header -->
            <header class="mobile-header">
                <button id="mobileSidebarToggle" class="mobile-menu-toggle" aria-label="فتح القائمة" aria-expanded="false">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                
                <div class="mobile-title">
                    <h1 id="mobilePageTitle">لوحة التحكم</h1>
                </div>
                
                <div class="mobile-actions">
                    <button id="mobileNotifications" class="mobile-action" aria-label="الإشعارات" title="الإشعارات">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        <span id="notificationBadge" class="notification-badge hidden">0</span>
                    </button>
                </div>
            </header>
            
            <!-- Page Content Container -->
            <div class="page-container">
                <!-- Dashboard Page -->
                <section id="page-dashboard" class="page-content active" role="tabpanel" aria-labelledby="navDashboard">
                    <div class="page-header">
                        <div class="page-title-section">
                            <h1 class="page-title">لوحة التحكم</h1>
                            <p class="page-subtitle">نظرة شاملة على أداء نظام الاستيراد المجمع</p>
                        </div>
                        
                        <div class="page-actions">
                            <button id="refreshDashboard" class="btn btn-secondary" aria-label="تحديث البيانات">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                    <polyline points="23,4 23,10 17,10"></polyline>
                                    <polyline points="1,20 1,14 7,14"></polyline>
                                    <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                                </svg>
                                تحديث
                            </button>
                            
                            <button id="bulkImportQuick" class="btn btn-primary">
                                <svg width="16" height="16" viewBox="0 极 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14,2 14,8 20,8"></polyline>
                                    <line x1="12" y1="18" x2="12" y2="12"></line>
                                    <line x1="9" y1="15" x2="15" y2="15"></line>
                                </svg>
                                استيراد جديد
                            </button>
                        </div>
                    </div>
                    
                    <!-- Statistics Grid -->
                    <div class="stats-grid">
                        <div class="stat-card primary">
                            <div class="stat-content">
                                <div class="stat-info">
                                    <h3 class="stat-title">إجمالي عمليات الاستيراد</h3>
                                    <div id="totalImports" class="stat-number">0</div>
                                </div>
                                <div class="stat-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                        <path d="M14 2H6a2 2 0 0 0-2 2极16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14,2 14,8 20,8"></polyline>
                                    </svg>
                                </div>
                            </div>
                            <div class="stat-footer">
                                <span class="stat-change positive" id="importsChange">+0%</span>
                                <span class="stat-period">مقارنة بالشهر الماضي</span>
                            </div>
                        </div>
                        
                        <div class="stat-card success">
                            <div class="stat-content">
                                <div class="stat-info">
                                    <h3 class="stat-title">المنشورات المجدولة</h3>
                                    <div id="scheduledPosts" class="stat-number">0</div>
                                </div>
                                <div class="stat极con">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <polyline points="12,极 12,12 16,14"></polyline>
                                    </极>
                                </div>
                            </div>
                            <div class="stat-footer">
                                <span class="stat-change" id="scheduledChange">0</span>
                                <span class="stat-period">في آخر 24 ساعة</span>
                            </div>
                        </div>
                        
                        <div class="stat-card warning">
                            <div class="stat-content">
                                <div class="stat-info">
                                    <h3 class="stat-title">معدل النجاح</h3>
                                    <div id="successRate" class="stat-number">0%</div>
                                </div>
                                <div class="stat-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                        <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"></polyline>
                                    </svg>
                                </div>
                            </div>
                            <div class="stat-footer">
                                <span class="stat-change" id="successChange">0%</span>
                                <span class="stat-period">معدل النشر الناجح</span>
                            </div>
                        </div>
                        
                        <div class="stat-card info">
                            <div class="stat-content">
                                <div class="stat-info">
                                    <h3 class="stat-title">المساحة المستخدمة</h3>
                                    <div id="storageUsed" class="stat-number">0 MB</div>
                                </div>
                                <div class="stat-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73极7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="stat-footer">
                                <span class="stat-change" id="storageChange">0</span>
                                <span class="stat-period">ملفات نشطة</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Activity Section -->
                    <div class="dashboard-section">
                        <div class="section-header">
                            <h2 class="section-title">النشاط الأخير</h2>
                            <div class="section-actions">
                                <button id="viewAllImports" class="btn btn-text">عرض الكل</button>
                            </div>
                        </div>
                        
                        <div class="activity-container">
                            <div id="recentImports" class="activity-list" role="list">
                                <!-- Will be populated dynamically -->
                                <div class="loading-state">
                                    <div class="loading-spinner" aria-hidden="true"></div>
                                    <p>جاري تحميل النشاط الأخير...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Upcoming Posts Section -->
                    <div class="dashboard-section">
                        <div class="section-header">
                            <h2 class="section-title">المنشورات القادمة (24 ساعة)</h2>
                            <div class="section-actions">
                                <button id="viewScheduled" class="btn btn-text">عرض الجدولة</button>
                            </极>
                        </div>
                        
                        <div class="upcoming-container">
                            <div id="upcomingPosts" class="upcoming-list" role="list">
                                <!-- Will be populated dynamically -->
                                <div class="loading-state">
                                    <div class="loading-spinner" aria-hidden="true"></div>
                                    <p>جاري تحميل المنشورات القادمة...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Platform Performance Section -->
                    <div class="dashboard-section">
                        <div class="section-header">
                            <h2 class="section-title">أداء المنصات</h2>
                        </div>
                        
                        <div class="platforms-grid">
                            <div class="platform-card facebook">
                                <div class="platform-header">
                                    <div class="platform-icon">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078极-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                                        </svg>
                                    </div>
                                    <div class="platform-info">
                                        <h3 class="platform-name">Facebook</h3>
                                        <span id="facebookStatus" class="platform-status online">متصل</span>
                                    </div>
                                </div>
                                <div class="platform-stats">
                                    <div class="platform-stat">
                                        <span class="stat-label">نُشر اليوم</span>
                                        <span id="facebookToday" class="stat-value">0</span>
                                    </div>
                                    <div class="platform-stat">
                                        <span class="stat-label">معدل النجاح</span>
                                        <span id="facebookSuccess" class="stat-value">0%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="platform-card instagram">
                                <div class="platform-header">
                                    <div class="platform-icon">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                            <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                                            <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                                            <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                                        </svg>
                                    </div>
                                    <div class="platform-info">
                                        <h3极="platform-name">Instagram</h3>
                                        <span id="instagramStatus" class="platform-status online">متصل</span>
                                    </div>
                                </div>
                                <div class="platform-stats">
                                    <div class="platform-stat">
                                        <span class="stat-label">نُشر اليوم</span>
                                        <span id="instagramToday" class="stat-value">0</span>
                                    </div>
                                    <div class="platform-stat">
                                        <span class="stat-label">معدل النجاح</span>
                                        <span id="instagramSuccess" class="stat-value">0%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="platform-card twitter">
                                <div class="platform-header">
                                    <div class="platform-icon">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden极"true">
                                            <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                                        </svg>
                                    </div>
                                    <div class="platform-info">
                                        <h3 class="platform-name">Twitter</h3>
                                        <span id="twitterStatus" class="platform-status online">متصل</span>
                                    </div>
                                </div>
                                <div class="platform-stats">
                                    <div class="platform-stat">
                                        <span class="stat-label">نُشر اليوم</span>
                                        <span id="twitterToday" class="stat-value">0</span>
                                    </div>
                                    <div class="platform-stat">
                                        <span class="stat-label">معدل النجاح</span>
                                        <span id="twitterSuccess" class="stat-value">0%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="platform-card linkedin">
                                <div class="极latform-header">
                                    <div class="platform-icon">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.极6 1.445-2.136 2.939极5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.极0-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                                        </svg>
                                    </div>
                                    <div class="platform-info">
                                        <h3 class="platform-name">LinkedIn</h3>
                                        <span id="linkedinStatus" class="platform-status online">متصل</span>
                                    </div>
                                </div>
                                <div class="platform-stats">
                                    <div class="platform-stat">
                                        <span class="stat-label">نُشر اليوم</span>
                                        <span id="linkedinToday" class="stat-value">0</span>
                                    </极>
                                    <div class="platform-stat">
                                        <span class="stat-label">معدل النجاح</span>
                                        <span id="linkedinSuccess" class="stat-value">0%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="platform-card tiktok">
                                <div class="platform-header">
                                    <div class="platform-icon">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                            <path d="M12.53.02C13.84 0 15.14.01 16.44 0c.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 极.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/>
                                        </svg>
                                    </div>
                                    <div class="platform-info">
                                        <h3 class="platform-name">TikTok</h3>
                                        <span id="tiktokStatus" class="platform-status online">متصل</span>
                                    </div>
                                </div>
                                <div class="platform-stats">
                                    <div class="platform-stat">
                                        <span class="stat-label">نُشر اليوم</span>
                                        <span id="tiktokToday" class="stat-value">0</span>
                                    </div>
                                    <div class="platform-stat">
                                        <span class="stat-label">معدل النجاح</span>
                                        <span id="tiktokSuccess" class="stat-value">0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Bulk Import Page -->
                <section id="page-bulk-import" class="page-content" role="tabpanel" aria-labelledby="navBulkImport">
                    <div class="page-header">
                        <div class="page-title-section">
                            <h1 class="page-title">الاستيراد المجمع</h1>
                            <p class="page-subtitle">استيراد ونشر المحتوى على جميع المنصات الاجتماعية</p>
                        </div>
                        
                        <div class="page-actions">
                            <button id="viewImportGuide" class="btn btn-text" aria-describedby="guide-tooltip">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                </svg>
                                دليل الاستخدام
                            </button>
                            <div id="guide-tooltip" class="sr-only">فتح دليل شامل لكيفية استخدام نظام الاستيراد المجمع</div>
                        </div>
                    </div>
                    
                    <!-- Quick Stats -->
                    <div class="import-stats-bar">
                        <div class="import-stat">
                            <span class="import-stat-label">آخر استيراد</span>
                            <span id="lastImportTime" class="import-stat-value">--</span>
                        </div>
                        <div class="import-stat">
                            <span class="import-stat-label">معدل النجاح</span>
                            <span id="importSuccessRate" class="import-stat-value">--</span>
                        </div>
                        <div class="import-stat">
                            <span class="import-stat-label">إجمالي الملفات</span>
                            <span id="totalFiles" class="import-stat-value">0</span>
                        </div>
                    </div>
                    
                    <!-- File Upload Section -->
                    <div class="upload-section">
                        <div class="section-header">
                            <h2 class="section-title">رفع ملف الاستيراد</h2>
                        </div>
                        
                        <div class="upload-container">
                            <div id="fileDropZone" class="file-drop-zone" 
                                 role="button" 
                                 tabindex="0"
                                 aria-label="منطقة رفع الملفات - اسحب وأفلت الملف هنا أو انقر لاختيار ملف"
                                 aria-describedby="upload-instructions">
                                
                                <div class="drop-zone-content">
                                    <div class="upload-icon">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2极8z"></path>
                                            <polyline points="14,2 14,8 20,8"></polyline>
                                            <line x1="12" y1="18" x2="12" y2="12"></line>
                                            <line x1="9" y1="15" x2="15" y2="15"></line>
                                        </svg>
                                    </div>
                                    
                                    <h3 class="upload-title">اسحب وأفلت ملف CSV أو JSON</h3>
                                    <p class="upload-subtitle">أو انقر لاختيار ملف من جهازك</p>
                                    
                                    <button id="fileSelectBtn" class="btn btn-primary" type="button">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                            <polyline points="7,10 12,15 17,10"></polyline>
                                            <line x1="12" y1="15" x2="12" y2="3"></line>
                                        </svg>
                                        اختيار ملف
                                    </button>
                                    
                                    <input type="file" 
                                           id="bulkImportFile" 
                                           accept=".csv,.json,text/csv,application/json" 
                                           style="display: none;"
                                           aria-describedby="file-requirements">
                                </div>
                                
                                <div id="upload-instructions" class="upload-instructions">
                                    <p><strong>الصيغ المدعومة:</strong> CSV, JSON</p>
                                    <p><strong>الحد الأقصى للحجم:</strong> 50 ميجابايت</p>
                                    <p><strong>التشفير:</strong> UTF-8</p>
                                </div>
                            </div>
                            
                            <!-- File Info Display -->
                            <div id="fileInfo" class="file-info" style="display: none;" role="status" aria-live="polite">
                                <!-- Will be populated dynamically -->
                            </div>
                            
                            <!-- Upload Actions -->
                            <div id="uploadActions" class="upload-actions" style="display: none;">
                                <button id="uploadBulkFile" class="btn btn-primary" disabled>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="17,8 12,3 7,8"></polyline>
                                        <line x1="12" y1极"3" x2="12" y2="15"></line>
                                    </svg>
                                    رفع وبدء المعالجة
                                </button>
                                
                                <button id="clearFile" class="btn btn-secondary">إزالة الملف</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- File Requirements -->
                    <div class="requirements-section">
                        <div class="section-header">
                            <h2 class="section-title">متطلبات الملف والأعمدة</h2>
                            <button id="toggleRequirements" class="btn btn-text" aria-expanded="true" aria-controls="requirements-content">
                                إخفاء التفاصيل
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                    <polyline points="6,9 12,15 18,9"></polyline>
                                </svg>
                            </button>
                        </div>
                        
                        <div id="requirements-content" class="requirements-content">
                            <div class="requirements-grid">
                                <div class="requirement-item">
                                    <h3 class="requirement-title">socialTitle</h3>
                                    <p class="requirement-desc">عنوان المنشور (1-280 حرف)</p>
                                    <code class="requirement-example">"عرض خاص لفترة محدودة!"</code>
                                </div>
                                
                                <div class="requirement-item">
                                    <h3 class="requirement-title">socialDescription</h3>
                                    <p class="requirement-desc">وصف المنشور (1-2000 حرف)</p>
                                    <code class="requirement-example">"اكتشف منتجاتنا الجديدة..."</code>
                                </div>
                                
                                <div class="requirement-item">
                                    <h3 class="requirement-title">shortUrl</h3>
                                    <p class="requirement-desc">رابط صحيح يبدأ بـ https://</p>
                                    <code class="requirement-example">"https://example.com/offer"</code>
                                </div>
                                
                                <div class="requirement-item">
                                    <h3 class="requirement-title">linkType</h3>
                                    <p class="requirement-desc">نوع الرابط</极>
                                    <code class="requirement-example">article, video, image, link, event</code>
                                </div>
                                
                                <div class="requirement-item">
                                    <h3 class="requirement-title">socialImageurl</h3>
                                    <p class="requirement-desc">رابط الصورة المرفقة</p>
                                    <code class="requirement-example">"https://example.com/image.jpg"</code>
                                </div>
                                
                                <div class="requirement-item">
                                    <h3 class="requirement-title">socialhachtags</h3>
                                    <p class="requirement-desc">الهاشتاجات مفصولة بفواصل</p>
                                    <code class="requirement-example">"#عرض,#خصم,#تسوق"</code>
                                </div>
                                
                                <div class="requirement-item">
                                    <h3 class="requirement-title">day</h3>
                                    <p class="requirement-desc">تاريخ النشر (YYYY-MM-DD)</p>
                                    <code class="requirement-example">"2024-12-25"</code>
                                </div>
                                
                                <div class="requirement-item">
                                    <h3 class="requirement-title">hour</h3>
                                    <p class="requirement-desc">وقت النشر (HH:MM)</p>
                                    <code class="requirement-example">"14:30"</code>
                                </div>
                                
                                <div class="requirement-item">
                                    <h3 class="requirement-title">platform</h3>
                                    <p class="requirement-desc">المنصات مفصولة بفواصل</p>
                                    <code class="requirement-example">"facebook,instagram,twitter"</code>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Templates Section -->
                    <div class="templates-section">
                        <极 class="section-header">
                            <h2 class="section-title">نماذج الملفات</h2>
                            <p class="section-subtitle">حمّل نموذج جاهز لتبدأ بسرعة</p>
                        </div>
                        
                        <div class="templates-grid">
                            <div class="template-card">
                                <div class="template-icon csv">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14,2 14,8 20,8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                    </svg>
                                </div>
                                <div class="template-info">
                                    <h3 class="template-title">نموذج CSV</h3>
                                    <p class="template-desc">ملف CSV مع جميع الأعمدة المطلوبة وبيانات نموذجية</p>
                                </div>
                                <button id="downloadCsvTemplate" class="btn btn-outline">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                        <path d="M21 15极4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-15"></path>
                                        <polyline points="7,10 12,15 17,10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                    تحميل CSV
                                </button>
                            </div>
                            
                            <div class="template-card">
                                <div class="template-icon json">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8极"></path>
                                        <polyline points="14,2 14,8 20,8"></polyline>
                                        <path d="M10 12h4v4h-4z"></path>
                                    </svg>
                                </div>
                                <div class="template-info">
                                    <h3 class="template-title">نموذج JSON</h3>
                                    <p class="template-desc">ملف JSON منسق مع هيكل البيانات الصحيح</p>
                                </div>
                                <button id="downloadJsonTemplate" class="btn btn-outline">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-15"></path>
                                        <polyline points="7,10 12极15 17,10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></极>
                                    </svg>
                                    تحميل JSON
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Import Progress Section -->
                    <div id="importProgressContainer" class="progress-section" style="display: none;" role="region" aria-labelledby="progress-title">
                        <div class="section-header">
                            <h2 id="progress-title" class="section-title">جاري المعالجة</h2>
                            <div class="section-actions">
                                <button id="cancelImport" class="btn btn-danger-outline">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                    إلغاء
                                </button>
                            </div>
                        </div>
                        
                        <div class="progress-container">
                            <!-- Progress Bar -->
                            <div class="极rogress-bar-container">
                                <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                    <div id="importProgressBar" class="progress-fill"></div>
                                </div>
                                <div class="progress-info">
                                    <span id="importProgressText" class="progress-text">جاري التحضير...</span>
                                    <span id="importProgressPercent" class="progress-percent">0%</span>
                                </div>
                            </div>
                            
                            <!-- Progress Steps -->
                            <div class="progress-steps">
                                <div class="progress-step active" id="step-upload">
                                    <div class="step-indicator">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                            <polyline points="17,8 12,3 7,8"></polyline>
                                            <line x1="12" y1="3" x2="12" y2="15"></line>
                                        </svg>
                                    </div>
                                    <span class="step-label">رفع الملف</span>
                                </div>
                                
                                <div class="progress-step" id="step-parse">
                                    <div class="step-indicator">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                            <polyline points="14,2 14,8 20,8"></polyline>
                                        </svg>
                                    </div>
                                    <span class="step-label">تحليل البيانات</span>
                                </div>
                                
                                <div class="progress-step" id="step-validate">
                                    <div class="step-indicator">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                            <polyline points="20,6 9,17 4,12"></polyline>
                                        </svg>
                                    </div>
                                    <span class="step-label">التحقق من الصحة</span>
                                </div>
                                
                                <div class="progress-step" id="step-schedule">
                                    <div class="step-indicator">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                            <circle cx="12" cy="12" r="极"></circle>
                                            <polyline points="12,6 12,12 16,14"></polyline>
                                        </svg>
                                    </div>
                                    <span class="step-label">الجدولة</span>
                                </极>
                                
                                <div class="progress-step" id="step-complete">
                                    <div class="step-indicator">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                            <polyline points="22,4 12,14.01 9,11.01"></polyline>
                                        </svg>
                                    </div>
                                    <span class="step-label">اكتمل</span>
                                </div>
                            </div>
                            
                            <!-- Current Status -->
                            <div class="progress-status">
                                <div id="importStatus" class="status-indicator processing">
                                    جاري المعالجة...
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Import Results Section -->
                    <div id="importResults" class="results-section" style="display: none;" role="region" aria-labelledby="results-title">
                        <!-- Will be populated dynamically -->
                    </div>
                    
                    <!-- Import History Section -->
                    <div class="history-section">
                        <div class="section-header">
                            <h2 class="section-title">تاريخ الاستيراد</h2>
                            <div class="section-actions">
                                <button id="refreshHistory" class="btn btn-text">
                                    <svg width="16" height="16" view极="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                        <polyline points="23,4 23,10 17,10"></polyline>
                                        <polyline points="1,20 1,14 7,14"></polyline>
                                        <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                                    </svg>
                                    تحديث
                                </button>
                                
                                <button id="clearHistory" class="btn btn-text text-danger">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                        <polyline points="3,6 5,6 21,6"></polyline>
                                        <path d="M19,6v14a2,2 0,0,1-2,2极7a2,2 0,0,1-2-2V6m3,0V4a2,2 0,0,1,2-2h4a2,2 0,0,1,2,2v2"></path>
                                    </svg>
                                    مسح التاريخ
                                </button>
                            </div>
                        </div>
                        
                        <div class="history-container">
                            <div id="importHistory" class="history-list" role="list">
                                <!-- Will be populated dynamically -->
                                <div class="loading-state">
                                    <div class="loading-spinner" aria-hidden="true"></div>
                                    <p>جاري تحميل تاريخ الاستيراد...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Analytics Page -->
                <section id="page-analytics" class="page-content" role="tabpanel" aria-labelledby="navAnalytics">
                    <div class="page-header">
                        <div class="page-title-section">
                            <h1 class="page-title">التحليلات</h1>
                            <p class="page-subtitle">تحليل شامل لأداء النشر والاستيراد</p>
                        </div>
                        
                        <div class="page-actions">
                            <select id="analyticsTimeframe" class="form-select" aria-label="اختيار فترة التحليل">
                                <option value="7">آخر 7 أيام</option>
                                <option value="30" selected>آخر 30 يوم</option>
                                <option value="90">آخر 3 أشهر</option>
                                <option value="365">آخر سنة</option>
                            </select>
                            
                            <button id="exportAnalytics" class="btn btn-outline">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-15"></path>
                                    <polyline points="7,10 12,15 17,极"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                تصدير التقرير
                            </button>
                        </div>
                    </div>
                    
                    <!-- Analytics Content -->
                    <div class="analytics-container">
                        <div class="loading-state">
                            <div class="loading-spinner" aria-hidden="true"></div>
                            <p>جاري تحميل بيانات التحليل...</p>
                        </div>
                    </div>
                </section>

                <!-- Accounts Page -->
                <section id="page-accounts" class="page-content" role="tabpanel" aria-labelledby="navAccounts">
                    <div class="page-header">
                        <div class="page-title-section">
                            <h1 class="page-title">إدارة الحسابات</h1>
                            <p class="page-subtitle">ربط وإدارة حساباتك على المنصات الاجتماعية</p>
                        </div>
                        
                        <div class="page-actions">
                            <button id="addNewAccount" class="btn btn-primary">
                                <svg width="16" height="16" viewBox="0 0 24 极4" fill="none" stroke="current极olor" stroke-width="2" aria-hidden="true">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                ربط حساب جديد
                            </button>
                        </div>
                    </div>
                    
                    <!-- Accounts Content -->
                    <div class="accounts-container">
                        <div class="loading-state">
                            <div class="loading-spinner" aria-hidden="true"></div>
                            <p>جاري تحميل الحسابات المربوطة...</p>
                        </div>
                    </div>
                </section>

                <!-- Settings Page -->
                <section id="page-settings" class="page-content" role="tabpanel" aria-labelledby="navSettings">
                    <div class="page-header">
                        <div class="page-title-section">
                            <h1 class="page-title">الإعدادات</h1>
                            <p class="page-subtitle">إعدادات النظام والتخصيص</p>
                        </div>
                    </div>
                    
                    <!-- Settings Content -->
                    <div class="settings-container">
                        <div class="loading-state">
                            <div class="极ading-spinner" aria-hidden="true"></div>
                            <p>جاري تحميل الإعدادات...</p>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Offline Indicator -->
    <div id="offlineIndicator" class="offline-indicator" style="display: none;" role="status" aria-live="polite">
        <div class="offline-content">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <line x1="1" y1="1" x2="23" y2="23"></line>
                <path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"></path>
                <path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"></path>
                <path d="M10.71 5.05A16 16 0 0 1 22.58 9"></path>
                <path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88"></极>
                <path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path>
                <line x1="12" y1="20" x2="12.01" y2="20"></line>
            </svg>
            <span>لا يوجد اتصال بالإنترنت</span>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal" role="dialog" aria-labelledby="help-modal-title" aria-describedby="help-modal-content" aria-hidden="true">
        <div class="modal-overlay" role="presentation"></div>
        <div class="modal-container">
            <div class="modal-header">
                <h2 id="help-modal-title" class="modal-title">مركز المساعدة</h2>
                <button id="closeHelpModal" class="modal-close" aria-label="إغلاق مركز المساعدة">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <div id="help-modal-content" class="modal-content">
                <div class="help-content">
                    <!-- Help content will be loaded dynamically -->
                    <div class="loading-state">
                        <div class="loading-spinner" aria-hidden="true"></div>
                        <p>جاري تحميل المساعدة...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal" role="dialog" aria-labelledby="confirm-modal-title" aria-describedby="confirm-modal-content" aria-hidden="true">
        <div class="modal-overlay" role="presentation"></div>
        <div class="modal-container small">
            <div class="modal-header">
                <h2 id="confirm-modal-title" class="modal-title">تأكيد العملية</h2>
            </div>
            
            <div id="confirm-modal-content" class="modal-content">
                <p id="confirmMessage">هل أنت متأكد من هذا الإجراء؟</p>
            </div>
            
            <div class="modal-footer">
                <button id="confirmCancel" class="btn btn-secondary">إلغاء</button>
                <button id="confirmAction" class="btn btn-danger">تأكيد</button>
            </div>
        </div>
    </div>

    <!-- Screen reader announcements -->
    <div id="sr-announcements" class="sr-only" aria-live="polite" aria-atomic="true"></div>

    <!-- Critical Scripts -->
    <script>
        // Prevent FOUC (Flash of Unstyled Content)
        document.documentElement.className = document.documentElement.className.replace('no-js', 'js');
        
        // Critical error handling
        window.addEventListener('error', function(e) {
            console.error('Critical Error:', e.error);
            if (typeof window.SocialHubPro !== 'undefined' && window.SocialHubPro.ErrorHandler) {
                window.SocialHubPro.ErrorHandler.handle(e.error);
            }
        });
        
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled Promise Rejection:', e.reason);
            if (typeof window.SocialHubPro !== 'undefined' && window.SocialHubPro.ErrorHandler) {
                window.SocialHubPro.ErrorHandler.handle(e.reason);
            }
        });
        
        // Performance monitoring
        window.addEventListener('load', function() {
            if (typeof PerformanceObserver !== 'undefined') {
                try {
                    const observer = new PerformanceObserver((list) => {
                        for (const entry of list.getEntries()) {
                            if (entry.name === 'first-contentful-paint') {
                                console.log('FCP:', entry.startTime);
                            }
                            if (entry.name === 'largest-contentful-paint') {
                                console.log('LCP:', entry.startTime);
                            }
                        }
                    });
                    observer.observe({entryTypes: ['paint', 'largest-contentful-paint']});
                } catch (e) {
                    console.warn('Performance Observer not supported');
                }
            }
        });
    </script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="app.js"></script>
</body>
</html>

    <script>
        /*
        ================================================================
        SOCIALHUB PRO v12.0 - ENHANCED PROFESSIONAL VERSION
        ================================================================
        التحسينات الجديدة:
        - نظام تسجيل احترافي مع وحدة تحكم مرئية
        - معالجة شاملة للأخطاء مع تتبع المصدر
        - مراقبة الأداء في الوقت الفعلي
        - تشخيص ذكي للمشاكل
        - نظام استرداد تلقائي من الأخطاء
        ================================================================
        */

        // نظام التسجيل المحسن
        class EnhancedLogger {
            constructor() {
                this.logs = [];
                this.maxLogs = 1000;
                this.consoleElement = document.getElementById('consoleContent');
                this.performanceStart = performance.now();
                this.errorCount = 0;

                // ربط الأحداث العامة
                this.bindGlobalErrorHandlers();

                // بدء مراقبة الأداء
                this.startPerformanceMonitoring();

                console.log('📊 Enhanced Logger initialized successfully');
            }

            bindGlobalErrorHandlers() {
                // معالج الأخطاء العامة
                window.addEventListener('error', (event) => {
                    this.handleError({
                        type: 'JavaScript Error',
                        message: event.message,
                        filename: event.filename,
                        lineno: event.lineno,
                        colno: event.colno,
                        stack: event.error?.stack,
                        timestamp: new Date().toISOString()
                    });
                });

                // معالج الوعود المرفوضة
                window.addEventListener('unhandledrejection', (event) => {
                    this.handleError({
                        type: 'Unhandled Promise Rejection',
                        message: event.reason?.message || event.reason,
                        stack: event.reason?.stack,
                        timestamp: new Date().toISOString()
                    });
                });

                // معالج أخطاء الموارد
                window.addEventListener('error', (event) => {
                    if (event.target !== window) {
                        this.handleError({
                            type: 'Resource Error',
                            message: `فشل تحميل المورد: ${event.target.src || event.target.href}`,
                            element: event.target.tagName,
                            timestamp: new Date().toISOString()
                        });
                    }
                }, true);
            }

            startPerformanceMonitoring() {
                // مراقبة استخدام الذاكرة
                setInterval(() => {
                    if (performance.memory) {
                        const memoryMB = (performance.memory.usedJSHeapSize / 1048576).toFixed(2);
                        document.getElementById('memoryUsage').textContent = memoryMB;
                    }

                    const loadTime = (performance.now() - this.performanceStart).toFixed(0);
                    document.getElementById('loadTime').textContent = loadTime;
                    document.getElementById('errorCount').textContent = this.errorCount;
                }, 2000);
            }

            handleError(errorInfo) {
                this.errorCount++;

                // تسجيل مفصل للخطأ
                const enhancedError = {
                    ...errorInfo,
                    id: this.generateErrorId(),
                    severity: this.categorizeError(errorInfo),
                    context: this.gatherContext(),
                    solution: this.suggestSolution(errorInfo)
                };

                // عرض في وحدة التحكم
                this.logToConsole('error', this.formatErrorMessage(enhancedError));

                // إرسال إلى نظام المراقبة
                this.reportError(enhancedError);

                // محاولة الاستردادة التلقائي
                this.attemptAutoRecovery(enhancedError);

                console.error('🚨 Enhanced Error Detected:', enhancedError);
            }

            categorizeError(errorInfo) {
                if (errorInfo.message?.includes('firebase') || errorInfo.message?.includes('Firebase')) {
                    return 'firebase';
                } else if (errorInfo.message?.includes('network') || errorInfo.message?.includes('fetch')) {
                    return 'network';
                } else if (errorInfo.type === 'Resource Error') {
                    return 'resource';
                } else {
                    return 'javascript';
                }
            }

            gatherContext() {
                return {
                    url: window.location.href,
                    userAgent: navigator.userAgent,
                    timestamp: new Date().toISOString(),
                    viewport: `${window.innerWidth}x${window.innerHeight}`,
                    connection: navigator.connection?.effectiveType || 'unknown',
                    memory: performance.memory ? `${(performance.memory.usedJSHeapSize / 1048576).toFixed(2)}MB` : 'unknown'
                };
            }

            suggestSolution(errorInfo) {
                const solutions = {
                    firebase: 'تحقق من إعدادات Firebase وحالة الاتصال بالإنترنت',
                    network: 'تحقق من اتصال الإنترنت وحالة الخادم',
                    resource: 'تحقق من وجود الملف وصحة المسار',
                    javascript: 'راجع الكود وتحقق من المتغيرات المطلوبة'
                };

                return solutions[this.categorizeError(errorInfo)] || 'راجع التفاصيل وتحقق من السجلات';
            }

            attemptAutoRecovery(errorInfo) {
                const severity = this.categorizeError(errorInfo);

                switch(severity) {
                    case 'firebase':
                        // محاولة إعادة تهيئة Firebase
                        setTimeout(() => {
                            if (typeof initializeFirebase === 'function') {
                                this.log('info', '🔄 محاولة إعادة تهيئة Firebase...');
                                initializeFirebase();
                            }
                        }, 2000);
                        break;

                    case 'network':
                        // محاولة إعادة الاتصال
                        setTimeout(() => {
                            this.log('info', '🌐 محاولة إعادة الاتصال...');
                            if (navigator.onLine) {
                                location.reload();
                            }
                        }, 5000);
                        break;

                    case 'resource':
                        // إعادة تحميل الموارد المفقودة
                        setTimeout(() => {
                            this.log('info', '📦 محاولة إعادة تحميل الموارد...');
                            this.reloadCriticalResources();
                        }, 1000);
                        break;
                }
            }

            reloadCriticalResources() {
                // إعادة تحميل CSS إذا لم يتم تحميله
                if (!document.querySelector('style')) {
                    const style = document.createElement('style');
                    style.textContent = `   /* المتغيرات الأساسية */
        :root {
            /* الألوان الأساسية */
            --primary-color: #1a365d;
            --primary-dark: #0f2040;
            --primary-light: #2a4a7a;
            --secondary-color: #2d3748;
            --accent-color: #3182ce;
            --accent-light: #4299e1;
            --success-color: #38a169;
            --warning-color: #d69e2e;
            --error-color: #e53e3e;
            --info-color: #3182ce;
            
            /* ألوان الخلفية والنص */
            --background-color: #f7fafc;
            --surface-color: #ffffff;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --border-color: #e2e8f0;
            --border-hover: #cbd5e0;
            
            /* الظلال */
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            
            /* الخطوط */
            --font-family: 'Noto Sans Arabic', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-size-4xl: 2.25rem;
            
            /* المسافات */
            --spacing-1: 0.25rem;
            --spacing-2: 0.5rem;
            --spacing-3: 0.75rem;
            --spacing-4: 1rem;
            --spacing-5: 1.25rem;
            --spacing-6: 1.5rem;
            --spacing-8: 2rem;
            --spacing-10: 2.5rem;
            --spacing-12: 3rem;
            --spacing-16: 4rem;
            
            /* الزوايا */
            --radius-sm: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;
            
            /* التحويلات والحركات */
            --transition-fast: 150ms ease;
            --transition-normal: 200ms ease;
            --transition-slow: 300ms ease;
        }

        /* إعادة تعيين العناصر الأساسية */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-primary);
            direction: rtl;
            text-align: right;
            overflow-x: hidden;
        }

        /* الروابط */
        a {
            color: var(--accent-color);
            text-decoration: none;
            transition: color var(--transition-normal);
        }

        a:hover {
            color: var(--accent-light);
        }

        /* العناوين */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            line-height: 1.25;
            margin-bottom: var(--spacing-4);
        }

        h1 { font-size: var(--font-size-4xl); }
        h2 { font-size: var(--font-size-3xl); }
        h3 { font-size: var(--font-size-2xl); }
        h4 { font-size: var(--font-size-xl); }
        h5 { font-size: var(--font-size-lg); }
        h6 { font-size: var(--font-size-base); }

        /* النصوص */
        p {
            margin-bottom: var(--spacing-4);
        }

        /* الأزرار */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-2);
            padding: var(--spacing-3) var(--spacing-5);
            border: 1px solid transparent;
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-normal);
            line-height: 1.5;
        }

        .btn:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.5);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background-color: #2d3748;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background-color: #2f855a;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-danger {
            background-color: var(--error-color);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background-color: #c53030;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-outline {
            background-color: transparent;
            border-color: var(--border-color);
            color: var(--text-primary);
        }

        .btn-outline:hover:not(:disabled) {
            background-color: var(--background-color);
            border-color: var(--border-hover);
        }

        .btn-text {
            background-color: transparent;
            color: var(--accent-color);
            padding: var(--spacing-2) var(--spacing-3);
        }

        .btn-text:hover:not(:disabled) {
            background-color: rgba(66, 153, 225, 0.1);
        }

        /* شاشة التحميل */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity var(--transition-slow);
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-logo {
            width: 120px;
            height: 120px;
            margin-bottom: var(--spacing-6);
            animation: pulse 2s infinite;
        }

        .loading-text {
            color: white;
            font-size: var(--font-size-lg);
            font-weight: 600;
            margin-bottom: var(--spacing-4);
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: white;
            border-radius: var(--radius-sm);
            animation: loading 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        @keyframes loading {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        /* شاشة المصادقة */
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--background-color);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9998;
        }

        .auth-screen.active {
            display: flex;
        }

        .auth-container {
            background: var(--surface-color);
            padding: var(--spacing-12);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .auth-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--spacing-6);
        }

        .auth-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            margin-bottom: var(--spacing-2);
        }

        .auth-subtitle {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-8);
        }

        .auth-button {
            width: 100%;
            padding: var(--spacing-4);
            border: none;
            border-radius: var(--radius-lg);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            margin-bottom: var(--spacing-3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-3);
        }

        .auth-button:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .auth-button.google {
            background: #4285f4;
            color: white;
        }

        .auth-button.facebook {
            background: #1877f2;
            color: white;
        }

        .auth-button.twitter {
            background: #1da1f2;
            color: white;
        }

        /* التطبيق الرئيسي */
        .main-app {
            display: flex;
            min-height: 100vh;
        }

        .main-app.hidden {
            display: none;
        }

        /* الشريط الجانبي */
        .sidebar {
            width: 280px;
            background: var(--surface-color);
            border-left: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: fixed;
            top: 0;
            right: 0;
            z-index: 100;
            transition: transform var(--transition-normal);
        }

        .sidebar-header {
            padding: var(--spacing-4);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
        }

        .sidebar-toggle {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            padding: var(--spacing-2);
            border-radius: var(--radius-md);
        }

        .sidebar-toggle:hover {
            background-color: var(--background-color);
            color: var(--text-primary);
        }

        .sidebar-brand {
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
        }

        .brand-logo {
            color: var(--primary-color);
        }

        .brand-text {
            font-weight: 700;
            font-size: var(--font-size-lg);
            color: var(--text-primary);
        }

        .sidebar-user {
            padding: var(--spacing-6) var(--spacing-4);
            display: flex;
            align-items: center;
            gap: var(--spacing-4);
            border-bottom: 1px solid var(--border-color);
        }

        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .user-email {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }

        .sidebar-stats {
            padding: var(--spacing-4);
            border-bottom: 1px solid var(--border-color);
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-4);
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .stat-label {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-1);
        }

        .stat-value {
            font-weight: 700;
            font-size: var(--font-size-lg);
            color: var(--text-primary);
        }

        .sidebar-nav {
            flex: 1;
            padding: var(--spacing-4) 0;
            overflow-y: auto;
        }

        .nav-item {
            margin-bottom: var(--spacing-1);
        }

        .nav-link {
            width: 100%;
            background: none;
            border: none;
            padding: var(--spacing-3) var(--spacing-4);
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
            cursor: pointer;
            color: var(--text-secondary);
            transition: all var(--transition-normal);
            border-radius: 0 var(--radius-md) var(--radius-md) 0;
            text-align: right;
        }

        .nav-link:hover {
            background-color: var(--background-color);
            color: var(--text-primary);
        }

        .nav-link.active {
            background-color: var(--primary-color);
            color: white;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .nav-text {
            flex: 1;
        }

        .nav-badge {
            background-color: var(--accent-color);
            color: white;
            font-size: var(--font-size-xs);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
        }

        .sidebar-footer {
            padding: var(--spacing-4);
            border-top: 1px solid var(--border-color);
        }

        .sidebar-actions {
            display: flex;
            justify-content: space-around;
            margin-bottom: var(--spacing-4);
        }

        .sidebar-action {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            padding: var(--spacing-2);
            border-radius: var(--radius-md);
        }

        .sidebar-action:hover {
            background-color: var(--background-color);
            color: var(--text-primary);
        }

        .sidebar-storage {
            background-color: var(--background-color);
            padding: var(--spacing-3);
            border-radius: var(--radius-md);
        }

        .storage-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-2);
        }

        .storage-label {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        .storage-value {
            font-size: var(--font-size-xs);
            font-weight: 600;
            color: var(--text-primary);
        }

        .storage-bar {
            height: 4px;
            background-color: var(--border-color);
            border-radius: var(--radius-sm);
            overflow: hidden;
        }

        .storage-progress {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: var(--radius-sm);
            transition: width var(--transition-slow);
        }

        /* المحتوى الرئيسي */
        .main-content {
            flex: 1;
            margin-right: 280px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* رأس الموبايل */
        .mobile-header {
            display: none;
            padding: var(--spacing-4);
            background-color: var(--surface-color);
            border-bottom: 1px solid var(--border-color);
            align-items: center;
            justify-content: space-between;
        }

        .mobile-menu-toggle {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            padding: var(--spacing-2);
            border-radius: var(--radius-md);
        }

        .mobile-menu-toggle:hover {
            background-color: var(--background-color);
            color: var(--text-primary);
        }

        .mobile-title h1 {
            margin-bottom: 0;
            font-size: var(--font-size-xl);
        }

        .mobile-actions {
            display: flex;
            gap: var(--spacing-2);
        }

        .mobile-action {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            padding: var(--spacing-2);
            border-radius: var(--radius-md);
            position: relative;
        }

        .mobile-action:hover {
            background-color: var(--background-color);
            color: var(--text-primary);
        }

        .notification-badge {
            position: absolute;
            top: 0;
            left: 0;
            background-color: var(--error-color);
            color: white;
            font-size: var(--font-size-xs);
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notification-badge.hidden {
            display: none;
        }

        /* حاوية الصفحة */
        .page-container {
            flex: 1;
            padding: var(--spacing-6);
        }

        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* رأس الصفحة */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-8);
        }

        .page-title-section h1 {
            margin-bottom: var(--spacing-2);
        }

        .page-subtitle {
            color: var(--text-secondary);
        }

        .page-actions {
            display: flex;
            gap: var(--spacing-3);
        }

        /* شبكة الإحصائيات */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-6);
            margin-bottom: var(--spacing-8);
        }

        .stat-card {
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-6);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .stat-card.primary {
            border-top: 4px solid var(--primary-color);
        }

        .stat-card.success {
            border-top: 4px solid var(--success-color);
        }

        .stat-card.warning {
            border-top: 4px solid var(--warning-color);
        }

        .stat-card.info {
            border-top: 4px solid var(--info-color);
        }

        .stat-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-4);
        }

        .stat-info h3 {
            font-size: var(--font-size-sm);
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-2);
        }

        .stat-number {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            color: var(--text-primary);
        }

        .stat-icon {
            color: var(--text-muted);
            background-color: var(--background-color);
            padding: var(--spacing-2);
            border-radius: var(--radius-md);
        }

        .stat-footer {
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
        }

        .stat-change {
            font-size: var(--font-size-sm);
            font-weight: 600;
        }

        .stat-change.positive {
            color: var(--success-color);
        }

        .stat-change.negative {
            color: var(--error-color);
        }

        .stat-period {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
        }

        /* أقسام لوحة التحكم */
        .dashboard-section {
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-6);
            margin-bottom: var(--spacing-6);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-6);
        }

        .section-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0;
        }

        .section-subtitle {
            color: var(--text-secondary);
            margin-top: var(--spacing-2);
        }

        .section-actions {
            display: flex;
            gap: var(--spacing-3);
        }

        /* قائمة النشاط */
        .activity-container {
            max-height: 400px;
            overflow-y: auto;
        }

        .activity-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-4);
        }

        .activity-item {
            display: flex;
            gap: var(--spacing-4);
            padding: var(--spacing-4);
            border-radius: var(--radius-md);
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            margin-bottom: var(--spacing-1);
        }

        .activity-description {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            margin-bottom: var(--spacing-2);
        }

        .activity-time {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
        }

        /* المنشورات القادمة */
        .upcoming-container {
            max-height: 300px;
            overflow-y: auto;
        }

        .upcoming-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-3);
        }

        .upcoming-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-3);
            border-radius: var(--radius-md);
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
        }

        .upcoming-content {
            flex: 1;
        }

        .upcoming-title {
            font-weight: 600;
            margin-bottom: var(--spacing-1);
        }

        .upcoming-platform {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-1);
        }

        .upcoming-time {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
        }

        .upcoming-actions {
            display: flex;
            gap: var(--spacing-2);
        }

        /* منصات التواصل */
        .platforms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-6);
        }

        .platform-card {
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-5);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
        }

        .platform-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .platform-card.facebook {
            border-top: 4px solid #1877f2;
        }

        .platform-card.instagram {
            border-top: 4px solid #e4405f;
        }

        .platform-card.twitter {
            border-top: 4px solid #1da1f2;
        }

        .platform-card.linkedin {
            border-top: 4px solid #0077b5;
        }

        .platform-card.tiktok {
            border-top: 4px solid #000000;
        }

        .platform-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
            margin-bottom: var(--spacing-4);
        }

        .platform-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
            flex-shrink: 0;
        }

        .platform-card.facebook .platform-icon {
            background-color: rgba(24, 119, 242, 0.1);
            color: #1877f2;
        }

        .platform-card.instagram .platform-icon {
            background-color: rgba(228, 64, 95, 0.1);
            color: #e4405f;
        }

        .platform-card.twitter .platform-icon {
            background-color: rgba(29, 161, 242, 0.1);
            color: #1da1f2;
        }

        .platform-card.linkedin .platform-icon {
            background-color: rgba(0, 119, 181, 0.1);
            color: #0077b5;
        }

        .platform-card.tiktok .platform-icon {
            background-color: rgba(0, 0, 0, 0.1);
            color: #000000;
        }

        .platform-info {
            flex: 1;
        }

        .platform-name {
            font-weight: 600;
            margin-bottom: var(--spacing-1);
        }

        .platform-status {
            font-size: var(--font-size-xs);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            display: inline-block;
        }

        .platform-status.online {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--success-color);
        }

        .platform-status.offline {
            background-color: rgba(229, 62, 62, 0.1);
            color: var(--error-color);
        }

        .platform-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-3);
        }

        .platform-stat {
            text-align: center;
        }

        .stat-label {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-1);
        }

        .stat-value {
            font-weight: 700;
            font-size: var(--font-size-lg);
        }

        /* قسم الاستيراد المجمع */
        .import-stats-bar {
            display: flex;
            gap: var(--spacing-8);
            padding: var(--spacing-4);
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            margin-bottom: var(--spacing-6);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .import-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .import-stat-label {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-1);
        }

        .import-stat-value {
            font-weight: 700;
            font-size: var(--font-size-lg);
            color: var(--text-primary);
        }

        /* رفع الملفات */
        .upload-section {
            margin-bottom: var(--spacing-8);
        }

        .upload-container {
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-6);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .file-drop-zone {
            border: 2px dashed var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-10) var(--spacing-6);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-normal);
            margin-bottom: var(--spacing-4);
        }

        .file-drop-zone:hover {
            border-color: var(--accent-color);
            background-color: rgba(66, 153, 225, 0.05);
        }

        .file-drop-zone.drag-over {
            border-color: var(--accent-color);
            background-color: rgba(66, 153, 225, 0.1);
        }

        .drop-zone-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-4);
        }

        .upload-icon {
            color: var(--accent-color);
        }

        .upload-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            color: var(--text-primary);
        }

        .upload-subtitle {
            color: var(--text-secondary);
        }

        .upload-instructions {
            background-color: var(--background-color);
            padding: var(--spacing-4);
            border-radius: var(--radius-md);
            margin-top: var(--spacing-4);
            text-align: right;
        }

        .upload-instructions p {
            margin-bottom: var(--spacing-2);
            font-size: var(--font-size-sm);
        }

        .upload-instructions strong {
            color: var(--text-primary);
        }

        .file-info {
            margin-bottom: var(--spacing-4);
        }

        .file-info-card {
            display: flex;
            align-items: center;
            gap: var(--spacing-4);
            padding: var(--spacing-4);
            background-color: var(--background-color);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }

        .file-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .file-icon.csv {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--success-color);
        }

        .file-icon.json {
            background-color: rgba(66, 153, 225, 0.1);
            color: var(--accent-color);
        }

        .file-details {
            flex: 1;
        }

        .file-name {
            font-weight: 600;
            margin-bottom: var(--spacing-1);
        }

        .file-meta {
            display: flex;
            gap: var(--spacing-3);
        }

        .file-size, .file-type {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        .file-actions {
            flex-shrink: 0;
        }

        .clear-file-btn {
            background: none;
            border: none;
            color: var(--error-color);
            cursor: pointer;
            font-size: var(--font-size-sm);
            padding: var(--spacing-1) var(--spacing-2);
        }

        .clear-file-btn:hover {
            background-color: rgba(229, 62, 62, 0.1);
            border-radius: var(--radius-sm);
        }

        .upload-actions {
            display: flex;
            gap: var(--spacing-3);
            justify-content: center;
        }

        /* متطلبات الملف */
        .requirements-section {
            margin-bottom: var(--spacing-8);
        }

        .requirements-content {
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-6);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .requirements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-6);
        }

        .requirement-item {
            padding: var(--spacing-4);
            background-color: var(--background-color);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }

        .requirement-title {
            font-weight: 600;
            margin-bottom: var(--spacing-2);
            color: var(--text-primary);
        }

        .requirement-desc {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-3);
            font-size: var(--font-size-sm);
        }

        .requirement-example {
            background-color: var(--surface-color);
            padding: var(--spacing-3);
            border-radius: var(--radius-sm);
            font-family: monospace;
            font-size: var(--font-size-sm);
            color: var(--text-primary);
            display: block;
            overflow-x: auto;
        }

        /* نماذج الملفات */
        .templates-section {
            margin-bottom: var(--spacing-8);
        }

        .templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-6);
        }

        .template-card {
            display: flex;
            flex-direction: column;
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-6);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
        }

        .template-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .template-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--spacing-4);
        }

        .template-icon.csv {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--success-color);
        }

        .template-icon.json {
            background-color: rgba(66, 153, 225, 0.1);
            color: var(--accent-color);
        }

        .template-info {
            flex: 1;
            margin-bottom: var(--spacing-4);
        }

        .template-title {
            font-weight: 600;
            margin-bottom: var(--spacing-2);
            color: var(--text-primary);
        }

        .template-desc {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        /* تقدم الاستيراد */
        .progress-section {
            margin-bottom: var(--spacing-8);
        }

        .progress-container {
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-6);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .progress-bar-container {
            margin-bottom: var(--spacing-6);
        }

        .progress-bar {
            height: 8px;
            background-color: var(--border-color);
            border-radius: var(--radius-sm);
            overflow: hidden;
            margin-bottom: var(--spacing-3);
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: var(--radius-sm);
            transition: width var(--transition-slow);
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-text {
            font-weight: 600;
            color: var(--text-primary);
        }

        .progress-percent {
            font-weight: 700;
            color: var(--primary-color);
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-6);
            position: relative;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 16px;
            right: 0;
            left: 0;
            height: 2px;
            background-color: var(--border-color);
            z-index: 1;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .step-indicator {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--spacing-2);
            transition: all var(--transition-normal);
        }

        .progress-step.active .step-indicator {
            background-color: var(--primary-color);
            color: white;
        }

        .progress-step.completed .step-indicator {
            background-color: var(--success-color);
            color: white;
        }

        .step-label {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            text-align: center;
        }

        .progress-step.active .step-label {
            color: var(--text-primary);
            font-weight: 600;
        }

        .progress-status {
            text-align: center;
        }

        .status-indicator {
            display: inline-block;
            padding: var(--spacing-2) var(--spacing-4);
            border-radius: var(--radius-md);
            font-weight: 600;
        }

        .status-indicator.processing {
            background-color: rgba(66, 153, 225, 0.1);
            color: var(--accent-color);
        }

        .status-indicator.completed {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--success-color);
        }

        .status-indicator.failed {
            background-color: rgba(229, 62, 62, 0.1);
            color: var(--error-color);
        }

        /* نتائج الاستيراد */
        .results-section {
            margin-bottom: var(--spacing-8);
        }

        .import-success, .import-error {
            display: flex;
            align-items: center;
            gap: var(--spacing-4);
            padding: var(--spacing-6);
            border-radius: var(--radius-lg);
        }

        .import-success {
            background-color: rgba(56, 161, 105, 0.1);
            border: 1px solid rgba(56, 161, 105, 0.2);
        }

        .import-error {
            background-color: rgba(229, 62, 62, 0.1);
            border: 1px solid rgba(229, 62, 62, 0.2);
        }

        .success-icon, .error-icon {
            font-size: var(--font-size-3xl);
            flex-shrink: 0;
        }

        .success-message h3, .error-message h3 {
            margin-bottom: var(--spacing-3);
        }

        .import-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-4);
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            display: block;
            font-size: var(--font-size-2xl);
            font-weight: 700;
            margin-bottom: var(--spacing-1);
        }

        .import-success .stat-number {
            color: var(--success-color);
        }

        .import-error .stat-number {
            color: var(--error-color);
        }

        .stat-label {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        .error-details {
            margin-top: var(--spacing-3);
        }

        .error-item {
            padding: var(--spacing-2);
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: var(--radius-sm);
            margin-bottom: var(--spacing-2);
            font-size: var(--font-size-sm);
        }

        /* تاريخ الاستيراد */
        .history-section {
            margin-bottom: var(--spacing-8);
        }

        .history-container {
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .history-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-4);
            border-bottom: 1px solid var(--border-color);
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-info {
            flex: 1;
        }

        .history-filename {
            font-weight: 600;
            margin-bottom: var(--spacing-1);
        }

        .history-date {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        .history-stats {
            display: flex;
            gap: var(--spacing-4);
            margin: 0 var(--spacing-4);
        }

        .history-status {
            padding: var(--spacing-1) var(--spacing-3);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
            font-weight: 600;
        }

        .status-completed {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--success-color);
        }

        .status-processing {
            background-color: rgba(66, 153, 225, 0.1);
            color: var(--accent-color);
        }

        .status-failed {
            background-color: rgba(229, 62, 62, 0.1);
            color: var(--error-color);
        }

        /* حالات التحميل */
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-12);
            color: var(--text-secondary);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: var(--spacing-4);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* الحالات الفارغة */
        .empty-state {
            text-align: center;
            padding: var(--spacing-8);
            color: var(--text-secondary);
        }

        /* مؤشر عدم الاتصال */
        .offline-indicator {
            position: fixed;
            bottom: var(--spacing-4);
            left: var(--spacing-4);
            background-color: var(--error-color);
            color: white;
            padding: var(--spacing-3) var(--spacing-4);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
        }

        /* النوافذ المنبثقة */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-container {
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            z-index: 2001;
            transform: scale(0.9);
            transition: transform var(--transition-normal);
        }

        .modal.active .modal-container {
            transform: scale(1);
        }

        .modal-container.small {
            max-width: 400px;
        }

        .modal-container.large {
            max-width: 800px;
        }

        .modal-header {
            padding: var(--spacing-5) var(--spacing-6);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            margin-bottom: 0;
        }

        .modal-close {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            padding: var(--spacing-1);
            border-radius: var(--radius-md);
        }

        .modal-close:hover {
            background-color: var(--background-color);
            color: var(--text-primary);
        }

        .modal-content {
            padding: var(--spacing-6);
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: var(--spacing-5) var(--spacing-6);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-3);
        }

        /* الإشعارات */
        .toast-container {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            align-items: center;
            pointer-events: none;
        }

        .toast {
            background: var(--surface-color);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-4);
            margin-bottom: var(--spacing-3);
            display: flex;
            align-items: center;
            min-width: 300px;
            max-width: 500px;
            opacity: 0;
            transform: translateY(-20px);
            transition: all var(--transition-normal);
            pointer-events: auto;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.hide {
            opacity: 0;
            transform: translateY(-20px);
        }

        .toast-content {
            display: flex;
            align-items: center;
            width: 100%;
        }

        .toast-icon {
            margin-left: var(--spacing-3);
            font-size: var(--font-size-xl);
        }

        .toast-message {
            flex: 1;
            font-size: var(--font-size-sm);
            color: var(--text-primary);
        }

        .toast-close {
            background: none;
            border: none;
            font-size: var(--font-size-lg);
            cursor: pointer;
            color: var(--text-muted);
            padding: 0;
            margin-right: var(--spacing-2);
        }

        .toast-success {
            border-right: 4px solid var(--success-color);
        }

        .toast-error {
            border-right: 4px solid var(--error-color);
        }

        .toast-warning {
            border-right: 4px solid var(--warning-color);
        }

        .toast-info {
            border-right: 4px solid var(--info-color);
        }

        /* التجاوب مع الشاشات المختلفة */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(100%);
                box-shadow: var(--shadow-xl);
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-right: 0;
            }
            
            .mobile-header {
                display: flex;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .platforms-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                gap: var(--spacing-4);
            }
            
            .page-actions {
                width: 100%;
                justify-content: flex-end;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .platforms-grid {
                grid-template-columns: 1fr;
            }
            
            .requirements-grid {
                grid-template-columns: 1fr;
            }
            
            .templates-grid {
                grid-template-columns: 1fr;
            }
            
            .import-stats-bar {
                flex-direction: column;
                gap: var(--spacing-4);
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-4);
            }
            
            .section-actions {
                width: 100%;
                justify-content: flex-end;
            }
            
            .upload-actions {
                flex-direction: column;
            }
            
            .history-item {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-3);
            }
            
            .history-stats {
                margin: var(--spacing-2) 0;
            }
            
            .auth-container {
                padding: var(--spacing-8);
            }
            
            .modal-container {
                margin: var(--spacing-4);
                width: calc(100% - var(--spacing-8));
            }
        }

        @media (max-width: 480px) {
            :root {
                --spacing-6: 1rem;
            }
            
            .page-container {
                padding: var(--spacing-4);
            }
            
            .dashboard-section {
                padding: var(--spacing-4);
            }
            
            .stat-card {
                padding: var(--spacing-4);
            }
            
            .upload-container {
                padding: var(--spacing-4);
            }
            
            .file-drop-zone {
                padding: var(--spacing-6) var(--spacing-4);
            }
            
            .requirements-content {
                padding: var(--spacing-4);
            }
            
            .progress-container {
                padding: var(--spacing-4);
            }
            
            .progress-steps {
                flex-direction: column;
                gap: var(--spacing-4);
            }
            
            .progress-steps::before {
                display: none;
            }
            
            .progress-step {
                flex-direction: row;
                gap: var(--spacing-3);
            }
            
            .step-label {
                text-align: right;
            }
            
            .modal-container {
                margin: var(--spacing-2);
                width: calc(100% - var(--spacing-4));
            }
            
            .modal-header,
            .modal-content,
            .modal-footer {
                padding: var(--spacing-4);
            }
        }

        /* حالة التركيز لإمكانية الوصول */
        button:focus-visible,
        input:focus-visible,
        select:focus-visible,
        textarea:focus-visible,
        a:focus-visible {
            outline: 2px solid var(--accent-color);
            outline-offset: 2px;
        }

        /* الطباعة */
        @media print {
            .sidebar,
            .mobile-header,
            .page-actions,
            .section-actions,
            .btn {
                display: none !important;
            }
            
            .main-content {
                margin-right: 0;
            }
            
            .page-container {
                padding: 0;
            }
            
            .dashboard-section {
                box-shadow: none;
                border: none;
                break-inside: avoid;
            }
            
            body {
                background-color: white;
                color: black;
            }
        }

        /* فئات المساعدة */
        .hidden {
            display: none !important;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .text-center {
            text-align: center;
        }

        .text-left {
            text-align: left;
        }

        .text-right {
            text-align: right;
        }

        .mt-4 { margin-top: var(--spacing-4); }
        .mb-4 { margin-bottom: var(--spacing-4); }
        .ml-4 { margin-left: var(--spacing-4); }
        .mr-4 { margin-right: var(--spacing-4); }
        .mx-4 { margin-left: var(--spacing-4); margin-right: var(--spacing-4); }
        .my-4 { margin-top: var(--spacing-4); margin-bottom: var(--spacing-4); }

        .pt-4 { padding-top: var(--spacing-4); }
        .pb-4 { padding-bottom: var(--spacing-4); }
        .pl-4 { padding-left: var(--spacing-4); }
        .pr-4 { padding-right: var(--spacing-4); }
        .px-4 { padding-left: var(--spacing-4); padding-right: var(--spacing-4); }
        .py-4 { padding-top: var(--spacing-4); padding-bottom: var(--spacing-4); }`;
                    document.head.appendChild(style);
                }

                // إعادة تحميل Font Awesome إذا لم يتم تحميله
                if (!document.querySelector('link[href*="font-awesome"]')) {
                    const link = document.createElement('link');
                    link.rel = 'stylesheet';
                    link.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css';
                    document.head.appendChild(link);
                }
            }

            formatErrorMessage(errorInfo) {
                return `
🚨 خطأ ${errorInfo.severity.toUpperCase()}: ${errorInfo.type}
📝 الرسالة: ${errorInfo.message}
📍 الموقع: ${errorInfo.filename || 'غير محدد'}:${errorInfo.lineno || '?'}:${errorInfo.colno || '?'}
🕒 الوقت: ${new Date(errorInfo.timestamp).toLocaleString('ar-AE')}
💡 الحل المقترح: ${errorInfo.solution}
🆔 معرف الخطأ: ${errorInfo.id}
                `.trim();
            }

            generateErrorId() {
                return 'ERR_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6).toUpperCase();
            }

            log(level, message, data = null) {
                const logEntry = {
                    level,
                    message,
                    data,
                    timestamp: new Date().toISOString(),
                    id: this.generateErrorId()
                };

                this.logs.push(logEntry);

                if (this.logs.length > this.maxLogs) {
                    this.logs.shift();
                }

                this.logToConsole(level, message, data);

                // تسجيل في console المتصفح مع تنسيق جميل
                const styles = {
                    error: 'color: #ff6b6b; font-weight: bold;',
                    warn: 'color: #ffb74d; font-weight: bold;',
                    info: 'color: #4fc3f7;',
                    debug: 'color: #81c784;'
                };

                console.log(`%c[SocialHub Pro] ${level.toUpperCase()}: ${message}`, styles[level] || '');
                if (data) console.log(data);
            }

            logToConsole(level, message, data = null) {
                if (!this.consoleElement) return;

                const logDiv = document.createElement('div');
                logDiv.className = `console-log ${level}`;

                const timestamp = new Date().toLocaleTimeString('ar-AE');
                logDiv.innerHTML = `
                    <strong>[${timestamp}] ${level.toUpperCase()}:</strong> ${message}
                    ${data ? `<br><small>${JSON.stringify(data, null, 2)}</small>` : ''}
                `;

                this.consoleElement.appendChild(logDiv);
                this.consoleElement.scrollTop = this.consoleElement.scrollHeight;
            }

            reportError(errorInfo) {
                // إرسال إلى خدمة المراقبة (Firebase أو خدمة أخرى)
                if (typeof firebase !== 'undefined' && firebase.firestore) {
                    try {
                        firebase.firestore().collection('error_reports').add({
                            ...errorInfo,
                            reported_at: firebase.firestore.FieldValue.serverTimestamp()
                        }).catch(err => {
                            console.warn('فشل في إرسال تقرير الخطأ:', err);
                        });
                    } catch (e) {
                        console.warn('Firebase غير متاح لإرسال التقارير');
                    }
                }
            }

            // دوال مساعدة عامة
            debug(message, data) { this.log('debug', message, data); }
            info(message, data) { this.log('info', message, data); }
            warn(message, data) { this.log('warn', message, data); }
            error(message, data) { this.log('error', message, data); }
        }

        // إنشاء مثيل عام للمسجل المحسن
        const enhancedLogger = new EnhancedLogger();

        // دوال التحكم في وحدة التحكم
        function toggleConsole() {
            const panel = document.getElementById('consolePanel');
            panel.classList.toggle('active');
        }

        function hideErrorOverlay() {
            document.getElementById('errorOverlay').style.display = 'none';
        }

        // عرض إحصائيات الأداء
        function togglePerformanceStats() {
            const stats = document.getElementById('performanceStats');
            stats.classList.toggle('show');
        }

        // إضافة اختصارات لوحة المفاتيح للمطورين
        document.addEventListener('keydown', (e) => {
            // Ctrl + Shift + D لعرض وحدة التحكم
            if (e.ctrlKey && e.shiftKey && e.code === 'KeyD') {
                e.preventDefault();
                toggleConsole();
            }

            // Ctrl + Shift + P لعرض إحصائيات الأداء
            if (e.ctrlKey && e.shiftKey && e.code === 'KeyP') {
                e.preventDefault();
                togglePerformanceStats();
            }
        });

        // تسجيل بدء التطبيق
        enhancedLogger.info('🚀 SocialHub Pro v12.0 - Enhanced Version Loaded Successfully');
        enhancedLogger.info('⌨️ اختصارات المطور: Ctrl+Shift+D (وحدة التحكم), Ctrl+Shift+P (إحصائيات الأداء)');

        // JavaScript الأساسي مع التحسينات
        /*=================================================================
 * SOCIALHUB PRO v11.0 - BULK IMPORT FOCUSED SYSTEM
 * Production-Grade Application - Real Implementation Only
 * Focus: Bulk Import with JSON/CSV Support + Auto File Cleanup
 * 
 * Author: SocialHub Pro Development Team
 * Version: 11.0.0
 * Last Updated: September 2025
 * Environment: Production Ready
 * 
 * Key Features:
 * - Bulk Import System (JSON/CSV)
 * - Automatic File Cleanup After Publishing
 * - Advanced Scheduling System
 * - Multi-Platform Publishing
 * - Real-time Progress Tracking
 * 
 * Removed Features:
 * - Single Post Creation (Composer)
 * - Individual Post Publishing
 * - Manual Post Scheduling UI
 *================================================================*/

/* ------------------------------------------------------------------ 
 * 1. CORE CONFIGURATION & CONSTANTS
 * ------------------------------------------------------------------*/

// Production Environment Configuration
const SOCIALHUB_CONFIG = {
    version: '11.0.0',
    environment: 'production',
    
    // Firebase Configuration
    firebase: {
        apiKey: "AIzaSyBKD3QIxJdHw__UG2TEqf0TqyYCnw8wJf8",
        authDomain: "socialhub-1370d.firebaseapp.com",
        databaseURL: "https://socialhub-1370d-default-rtdb.firebaseio.com",
        projectId: "socialhub-1370d",
        storageBucket: "socialhub-1370d.firebasestorage.app",
        messagingSenderId: "84815590328",
        appId: "1:84815590328:web:2f12340380b37c2562d54d"
    },
    
    // Bulk Import Specifications
    bulkImport: {
        maxFileSize: 50 * 1024 * 1024, // 50MB
        supportedFormats: ['json', 'csv'],
        maxPostsPerImport: 10000,
        batchSize: 100, // Process 100 posts at a time
        
        // Required Columns
        requiredColumns: [
            'socialTitle',
            'socialDescription', 
            'shortUrl',
            'linkType',
            'socialImageurl',
            'socialhachtags',
            'day',
            'hour',
            'platform'
        ],
        
        // Column Validation Rules
        validation: {
            socialTitle: { minLength: 1, maxLength: 280 },
            socialDescription: { minLength: 1, maxLength: 2000 },
            shortUrl: { pattern: /^https:\/\//, required: true },
            linkType: { 
                enum: ['article', 'video', 'image', 'link', 'event'],
                required: true 
            },
            socialImageurl: { pattern: /^https:\/\/.*\.(jpg|jpeg|png|gif|webp)$/i },
            socialhachtags: { pattern: /^#\w+(,#\w+)*$/ },
            day: { pattern: /^\d{4}-\d{2}-\d{2}$/, required: true },
            hour: { pattern: /^([01]\d|2[0-3]):[0-5]\d$/, required: true },
            platform: { 
                pattern: /^(facebook|instagram|twitter|linkedin|tiktok)(,(facebook|instagram|twitter|linkedin|tiktok))*$/,
                required: true 
            }
        }
    },
    
    // Platform API Configuration
    platforms: {
        facebook: {
            apiVersion: 'v19.0',
            baseUrl: 'https://graph.facebook.com',
            rateLimit: 200, // requests per hour
            contentLimit: 63206
        },
        instagram: {
            apiVersion: 'v19.0',
            baseUrl: 'https://graph.facebook.com',
            rateLimit: 200,
            contentLimit: 2200,
            requiresImage: true
        },
        twitter: {
            apiVersion: '2',
            baseUrl: 'https://api.twitter.com',
            rateLimit: 300, // requests per 15 minutes
            contentLimit: 280
        },
        linkedin: {
            apiVersion: 'v2',
            baseUrl: 'https://api.linkedin.com',
            rateLimit: 100,
            contentLimit: 1300
        },
        tiktok: {
            apiVersion: 'v1',
            baseUrl: 'https://business-api.tiktok.com',
            rateLimit: 100,
            contentLimit: 2200
        }
    },
    
    // System Settings
    system: {
        timezone: 'Asia/Dubai',
        language: 'ar-AE',
        retryAttempts: 3,
        retryDelay: 1000,
        cleanupDelay: 24 * 60 * 60 * 1000, // 24 hours
        sessionTimeout: 30 * 60 * 1000 // 30 minutes
    }
};

/* ------------------------------------------------------------------ 
 * 2. CORE SYSTEMS
 * ------------------------------------------------------------------*/

// Configuration Manager
class ConfigManager {
    static config = SOCIALHUB_CONFIG;
    static userPreferences = {};
    
    static get(path, defaultValue = null) {
        try {
            const keys = path.split('.');
            let value = this.config;
            
            for (const key of keys) {
                if (value && typeof value === 'object' && key in value) {
                    value = value[key];
                } else {
                    return defaultValue;
                }
            }
            
            return value;
        } catch (error) {
            Logger.error('ConfigManager.get failed', { path, error });
            return defaultValue;
        }
    }
    
    static set(path, value) {
        try {
            const keys = path.split('.');
            const lastKey = keys.pop();
            let target = this.config;
            
            for (const key of keys) {
                if (!target[key] || typeof target[key] !== 'object') {
                    target[key] = {};
                }
                target = target[key];
            }
            
            target[lastKey] = value;
            return true;
        } catch (error) {
            Logger.error('ConfigManager.set failed', { path, value, error });
            return false;
        }
    }
    
    static isProduction() {
        return this.get('environment') === 'production';
    }
    
    static validate() {
        const required = [
            'firebase.projectId',
            'firebase.apiKey', 
            'bulkImport.requiredColumns',
            'platforms'
        ];
        
        for (const path of required) {
            if (!this.get(path)) {
                throw new Error(`Missing required configuration: ${path}`);
            }
        }
        
        Logger.info('Configuration validation passed');
        return true;
    }
}

// Advanced Logger System
class Logger {
    static logLevel = ConfigManager.isProduction() ? 'info' : 'debug';
    static outputs = [];
    static buffer = [];
    static maxBufferSize = 1000;
    
    static levels = {
        debug: 0,
        info: 1,
        warn: 2,
        error: 3
    };
    
    static log(level, message, data = {}) {
        const timestamp = new Date().toISOString();
        const logEntry = {
            timestamp,
            level,
            message,
            data: this.sanitizeLogData(data),
            sessionId: this.getSessionId(),
            userId: AuthService.getCurrentUser()?.uid || 'anonymous'
        };
        
        // Check log level
        if (this.levels[level] < this.levels[this.logLevel]) {
            return;
        }
        
        // Console output (always in development)
        if (!ConfigManager.isProduction() || level === 'error') {
            const consoleMethod = level === 'error' ? 'error' : 
                                  level === 'warn' ? 'warn' : 'log';
            console[consoleMethod](`[${level.toUpperCase()}] ${message}`, data);
        }
        
        // Add to buffer
        this.addToBuffer(logEntry);
        
        // Send to outputs
        this.outputs.forEach(output => {
            try {
                output.write(logEntry);
            } catch (error) {
                console.error('Logger output failed:', error);
            }
        });
    }
    
    static sanitizeLogData(data) {
        // Convert any non-serializable data to string representation
        if (typeof data !== 'object' || data === null) {
            return data;
        }
        
        const sanitized = {};
        for (const [key, value] of Object.entries(data)) {
            if (value instanceof Error) {
                sanitized[key] = {
                    message: value.message,
                    stack: value.stack,
                    name: value.name
                };
            } else if (typeof value === 'object' && value !== null) {
                sanitized[key] = this.sanitizeLogData(value);
            } else {
                sanitized[key] = value;
            }
        }
        
        return sanitized;
    }
    
    static debug(message, data) { this.log('debug', message, data); }
    static info(message, data) { this.log('info', message, data); }
    static warn(message, data) { this.log('warn', message, data); }
    static error(message, data) { this.log('error', message, data); }
    
    static addToBuffer(entry) {
        this.buffer.push(entry);
        if (this.buffer.length > this.maxBufferSize) {
            this.buffer.shift();
        }
    }
    
    static getSessionId() {
        if (!this.sessionId) {
            this.sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        return this.sessionId;
    }
    
    static addOutput(output) {
        this.outputs.push(output);
    }
    
    static async flush() {
        const promises = this.outputs.map(output => {
            if (output.flush) {
                return output.flush();
            }
            return Promise.resolve();
        });
        
        await Promise.all(promises);
    }
    
    static getLogs(options = {}) {
        const { level, since, userId } = options;
        
        return this.buffer.filter(entry => {
            if (level && this.levels[entry.level] < this.levels[level]) {
                return false;
            }
            
            if (since && new Date(entry.timestamp) < since) {
                return false;
            }
            
            if (userId && entry.userId !== userId) {
                return false;
            }
            
            return true;
        });
    }
}

// Firebase Logger Output
class FirebaseLoggerOutput {
    constructor() {
        this.batchSize = 50;
        this.batch = [];
        this.flushInterval = 30000; // 30 seconds
        this.startBatchFlush();
    }
    
    write(logEntry) {
        if (ConfigManager.isProduction()) {
            this.batch.push(logEntry);
            if (this.batch.length >= this.batchSize) {
                this.flush();
            }
        }
    }
    
    async flush() {
        if (this.batch.length === 0) return;
        
        try {
            const db = firebase.firestore();
            const batch = db.batch();
            const logsRef = db.collection('logs');
            
            this.batch.forEach(entry => {
                const docRef = logsRef.doc();
                batch.set(docRef, entry);
            });
            
            await batch.commit();
            Logger.debug(`Flushed ${this.batch.length} log entries to Firebase`);
            this.batch = [];
        } catch (error) {
            console.error('Failed to flush logs to Firebase:', error);
        }
    }
    
    startBatchFlush() {
        setInterval(() => {
            this.flush();
        }, this.flushInterval);
    }
}

// Comprehensive Error Handler
class ErrorHandler {
    static errors = [];
    static maxErrors = 100;
    static reportingEnabled = ConfigManager.isProduction();
    
    static init() {
        // Global error handlers
        window.addEventListener('error', (event) => {
            this.handle(event.error, {
                type: 'javascript_error',
                filename: event.filename,
                lineno: event.lineno,
                colno: event.colno
            });
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            this.handle(event.reason, {
                type: 'unhandled_promise_rejection'
            });
        });
        
        Logger.info('ErrorHandler initialized');
    }
    
    static async handle(error, context = {}) {
        const errorInfo = {
            id: this.generateErrorId(),
            timestamp: new Date().toISOString(),
            message: error?.message || String(error),
            stack: error?.stack,
            context,
            userId: AuthService.getCurrentUser()?.uid,
            sessionId: Logger.getSessionId(),
            userAgent: navigator.userAgent,
            url: window.location.href
        };
        
        // Log the error
        Logger.error('Application Error', errorInfo);
        
        // Add to errors collection
        this.addError(errorInfo);
        
        // Report to monitoring service
        if (this.reportingEnabled) {
            await this.reportError(errorInfo);
        }
        
        // Show user-friendly message
        this.showUserError(error, context);
        
        return errorInfo.id;
    }
    
    static addError(errorInfo) {
        this.errors.unshift(errorInfo);
        if (this.errors.length > this.maxErrors) {
            this.errors.pop();
        }
    }
    
    static async reportError(errorInfo) {
        try {
            if (typeof firebase !== 'undefined' && firebase.firestore) {
                await firebase.firestore()
                    .collection('errors')
                    .add(errorInfo);
            }
        } catch (reportingError) {
            console.error('Failed to report error:', reportingError);
        }
    }
    
    static showUserError(error, context) {
        let userMessage = 'حدث خطأ غير متوقع. يرجى المحاولة مرة أخرى.';
        
        // Specific error messages in Arabic
        if (error?.code) {
            const errorMessages = {
                'auth/user-not-found': 'المستخدم غير موجود',
                'auth/wrong-password': 'كلمة المرور غير صحيحة',
                'storage/unauthorized': 'غير مصرح لك بتحميل الملفات',
                'firestore/permission-denied': 'غير مصرح لك بهذا الإجراء',
                'bulk-import/file-too-large': 'حجم الملف كبير جداً',
                'bulk-import/invalid-format': 'صيغة الملف غير مدعومة',
                'bulk-import/missing-columns': 'الملف لا يحتوي على الأعمدة المطلوبة'
            };
            
            userMessage = errorMessages[error.code] || userMessage;
        }
        
        // Show toast notification
        if (typeof showToast === 'function') {
            showToast(userMessage, 'error');
        } else {
            alert(userMessage);
        }
    }
    
    static generateErrorId() {
        return 'err_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }
    
    static getErrors(options = {}) {
        const { userId, since, type } = options;
        
        return this.errors.filter(error => {
            if (userId && error.userId !== userId) return false;
            if (since && new Date(error.timestamp) < since) return false;
            if (type && error.context.type !== type) return false;
            return true;
        });
    }
}

// Security Manager
class SecurityManager {
    static csrfToken = null;
    static rateLimiter = new Map();
    
    static init() {
        this.generateCSRFToken();
        this.setupRateLimiting();
        Logger.info('SecurityManager initialized');
    }
    
    static generateCSRFToken() {
        this.csrfToken = 'csrf_' + Date.now() + '_' + Math.random().toString(36).substr(2, 16);
        return this.csrfToken;
    }
    
    static validateCSRFToken(token) {
        return token === this.csrfToken;
    }
    
    static sanitizeInput(input) {
        if (typeof input !== 'string') return input;
        
        // Remove potentially dangerous characters
        return input
            .replace(/<script[^>]*>.*?<\/script>/gi, '')
            .replace(/<iframe[^>]*>.*?<\/iframe>/gi, '')
            .replace(/javascript:/gi, '')
            .replace(/on\w+\s*=/gi, '')
            .trim();
    }
    
    static sanitizeObject(obj) {
        if (typeof obj !== 'object' || obj === null) {
            return this.sanitizeInput(obj);
        }
        
        const sanitized = {};
        for (const [key, value] of Object.entries(obj)) {
            if (typeof value === 'object' && value !== null) {
                sanitized[key] = this.sanitizeObject(value);
            } else {
                sanitized[key] = this.sanitizeInput(value);
            }
        }
        
        return sanitized;
    }
    
    static setupRateLimiting() {
        this.rateLimits = {
            'bulk-import': { max: 5, window: 60000 }, // 5 imports per minute
            'file-upload': { max: 10, window: 60000 }, // 10 uploads per minute
            'api-call': { max: 100, window: 60000 } // 100 API calls per minute
        };
    }
    
    static checkRateLimit(userId, action) {
        const key = `${userId}:${action}`;
        const now = Date.now();
        const limit = this.rateLimits[action];
        
        if (!limit) return true;
        
        if (!this.rateLimiter.has(key)) {
            this.rateLimiter.set(key, []);
        }
        
        const attempts = this.rateLimiter.get(key);
        
        // Remove old attempts
        const validAttempts = attempts.filter(time => now - time < limit.window);
        
        if (validAttempts.length >= limit.max) {
            return false;
        }
        
        validAttempts.push(now);
        this.rateLimiter.set(key, validAttempts);
        
        return true;
    }
    
    static validateFileUpload(file) {
        const maxSize = ConfigManager.get('bulkImport.maxFileSize');
        const supportedFormats = ConfigManager.get('bulkImport.supportedFormats');
        
        // Check file size
        if (file.size > maxSize) {
            throw new Error('File size exceeds maximum allowed size');
        }
        
        // Check file type
        const extension = file.name.split('.').pop().toLowerCase();
        if (!supportedFormats.includes(extension)) {
            throw new Error(`Unsupported file format. Allowed: ${supportedFormats.join(', ')}`);
        }
        
        // Check file name for security
        if (file.name.includes('..') || file.name.includes('/') || file.name.includes('\\')) {
            throw new Error('Invalid file name');
        }
        
        return true;
    }
}

// Advanced Validation Engine
class ValidationEngine {
    static rules = {
        required: (value) => value !== null && value !== undefined && String(value).trim() !== '',
        
        minLength: (value, length) => String(value).length >= length,
        
        maxLength: (value, length) => String(value).length <= length,
        
        pattern: (value, regex) => regex.test(String(value)),
        
        url: (value) => {
            try {
                new URL(value);
                return true;
            } catch {
                return false;
            }
        },
        
        email: (value) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value),
        
        date: (value) => {
            const date = new Date(value);
            return !isNaN(date.getTime());
        },
        
        time: (value) => /^([01]\d|2[0-3]):[0-5]\d$/.test(value),
        
        enum: (value, allowedValues) => allowedValues.includes(value),
        
        platforms: (value) => {
            const platforms = value.split(',').map(p => p.trim());
            const validPlatforms = ['facebook', 'instagram', 'twitter', 'linkedin', 'tiktok'];
            return platforms.every(p => validPlatforms.includes(p));
        },
        
        hashtags: (value) => {
            if (!value) return true; // Optional field
            return /^#\w+(,#\w+)*$/.test(value);
        }
    };
    
    static validate(data, schema) {
        const errors = [];
        const warnings = [];
        
        // Check required fields
        for (const field of Object.keys(schema)) {
            const rules = schema[field];
            const value = data[field];
            
            if (rules.required && !this.rules.required(value)) {
                errors.push({
                    field,
                    rule: 'required',
                    message: `Field '${field}' is required`
                });
                continue;
            }
            
            // Skip other validations if field is empty and not required
            if (!this.rules.required(value) && !rules.required) {
                continue;
            }
            
            // Apply other rules
            for (const [ruleName, ruleValue] of Object.entries(rules)) {
                if (ruleName === 'required') continue;
                
                const ruleFunction = this.rules[ruleName];
                if (!ruleFunction) {
                    warnings.push({
                        field,
                        rule: ruleName,
                        message: `Unknown validation rule: ${ruleName}`
                    });
                    continue;
                }
                
                let isValid;
                if (ruleValue === true || ruleValue === false) {
                    isValid = ruleValue ? ruleFunction(value) : !ruleFunction(value);
                } else {
                    isValid = ruleFunction(value, ruleValue);
                }
                
                if (!isValid) {
                    errors.push({
                        field,
                        rule: ruleName,
                        message: this.getErrorMessage(field, ruleName, ruleValue, value)
                    });
                }
            }
        }
        
        return {
            valid: errors.length === 0,
            errors,
            warnings
        };
    }
    
    static getErrorMessage(field, rule, ruleValue, value) {
        const messages = {
            required: `${field} is required`,
            minLength: `${field} must be at least ${ruleValue} characters`,
            maxLength: `${field} must be no more than ${ruleValue} characters`,
            pattern: `${field} format is invalid`,
            url: `${field} must be a valid URL`,
            email: `${field} must be a valid email address`,
            date: `${field} must be a valid date`,
            time: `${field} must be a valid time (HH:MM)`,
            enum: `${field} must be one of: ${ruleValue.join(', ')}`,
            platforms: `${field} must contain valid platform names`,
            hashtags: `${field} must be in format: #hashtag1,#hashtag2`
        };
        
        return messages[rule] || `${field} is invalid`;
    }
    
    static validateBulkImportData(posts) {
        const schema = ConfigManager.get('bulkImport.validation');
        const results = {
            valid: [],
            invalid: [],
            summary: {
                total: posts.length,
                validCount: 0,
                invalidCount: 0
            }
        };
        
        for (let i = 0; i < posts.length; i++) {
            const post = posts[i];
            const validation = this.validate(post, schema);
            
            if (validation.valid) {
                results.valid.push({
                    index: i,
                    data: SecurityManager.sanitizeObject(post)
                });
                results.summary.validCount++;
            } else {
                results.invalid.push({
                    index: i,
                    data: post,
                    errors: validation.errors,
                    warnings: validation.warnings
                });
                results.summary.invalidCount++;
            }
        }
        
        return results;
    }
}

/* ------------------------------------------------------------------ 
 * 3. AUTHENTICATION SERVICE
 * ------------------------------------------------------------------*/

class AuthService {
    static currentUser = null;
    static authStateListeners = [];
    static isInitialized = false;
    
    static async init() {
        if (this.isInitialized) return;
        
        try {
            // Initialize Firebase Auth
            if (typeof firebase === 'undefined') {
                throw new Error('Firebase SDK not loaded');
            }
            
            // Listen for auth state changes
            firebase.auth().onAuthStateChanged((user) => {
                const previousUser = this.currentUser;
                this.currentUser = user;
                
                if (user) {
                    Logger.info('User authenticated', { uid: user.uid, email: user.email });
                    this.setupUserSession(user);
                } else {
                    Logger.info('User signed out');
                    this.cleanupUserSession();
                }
                
                // Notify listeners
                this.notifyAuthStateListeners(user, previousUser);
            });
            
            this.isInitialized = true;
            Logger.info('AuthService initialized');
        } catch (error) {
            Logger.error('AuthService initialization failed', error);
            throw error;
        }
    }
    
    static setupUserSession(user) {
        // Set user preferences
        this.loadUserPreferences(user.uid);
        
        // Setup session timeout
        this.setupSessionTimeout();
        
        // Initialize user-specific services
        this.initializeUserServices(user);
    }
    
    static cleanupUserSession() {
        // Clear timeouts
        if (this.sessionTimeout) {
            clearTimeout(this.sessionTimeout);
        }
        
        // Clear caches
        CacheManager.clearUserCache();
        
        // Reset services
        this.resetUserServices();
    }
    
    static setupSessionTimeout() {
        const timeout = ConfigManager.get('system.sessionTimeout');
        
        this.sessionTimeout = setTimeout(() => {
            Logger.warn('Session timeout - signing out user');
            this.signOut();
        }, timeout);
    }
    
    static async loadUserPreferences(uid) {
        try {
            const doc = await firebase.firestore()
                .collection('users')
                .doc(uid)
                .get();
                
            if (doc.exists) {
                ConfigManager.userPreferences = doc.data().preferences || {};
            }
        } catch (error) {
            Logger.error('Failed to load user preferences', error);
        }
    }
    
    static async saveUserPreferences(uid, preferences) {
        try {
            await firebase.firestore()
                .collection('users')
                .doc(uid)
                .set({
                    preferences,
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
                
            ConfigManager.userPreferences = preferences;
        } catch (error) {
            Logger.error('Failed to save user preferences', error);
        }
    }
    
    static initializeUserServices(user) {
        // Initialize bulk import service for user
        BulkImportService.initializeForUser(user.uid);
        
        // Initialize cleanup service
        FileCleanupService.initializeForUser(user.uid);
        
        // Initialize dashboard
        DashboardController.init();
        
        // Initialize bulk import UI
        BulkImportController.init();
    }
    
    static resetUserServices() {
        // Reset services
        BulkImportService.reset();
        FileCleanupService.reset();
        DashboardController.reset();
        BulkImportController.reset();
    }
    
    static getCurrentUser() {
        return this.currentUser;
    }
    
    static isAuthenticated() {
        return this.currentUser !== null;
    }
    
    static subscribe(callback) {
        this.authStateListeners.push(callback);
        
        // Call immediately with current state
        if (this.currentUser !== undefined) {
            callback(this.currentUser);
        }
        
        // Return unsubscribe function
        return () => {
            const index = this.authStateListeners.indexOf(callback);
            if (index > -1) {
                this.authStateListeners.splice(index, 1);
            }
        };
    }
    
    static notifyAuthStateListeners(user, previousUser) {
        this.authStateListeners.forEach(callback => {
            try {
                callback(user, previousUser);
            } catch (error) {
                Logger.error('Auth state listener error', error);
            }
        });
    }
    
    static async signOut() {
        try {
            await firebase.auth().signOut();
            Logger.info('User signed out successfully');
        } catch (error) {
            Logger.error('Sign out failed', error);
            throw error;
        }
    }
    
    static async getIdToken() {
        if (!this.currentUser) {
            throw new Error('User not authenticated');
        }
        
        return await this.currentUser.getIdToken();
    }
}

/* ------------------------------------------------------------------ 
 * 4. BULK IMPORT SERVICE (المحور الرئيسي)
 * ------------------------------------------------------------------*/

class BulkImportService {
    static activeImports = new Map();
    static importHistory = [];
    static userUid = null;
    
    static initializeForUser(uid) {
        this.userUid = uid;
        this.loadImportHistory();
        Logger.info('BulkImportService initialized for user', { uid });
    }
    
    static reset() {
        this.activeImports.clear();
        this.importHistory = [];
        this.userUid = null;
    }
    
    static async upload(file, options = {}) {
        try {
            const uid = AuthService.getCurrentUser()?.uid;
            if (!uid) throw new Error('User not authenticated');
            
            // Security checks
            if (!SecurityManager.checkRateLimit(uid, 'bulk-import')) {
                throw new Error('Rate limit exceeded. Please wait before uploading again.');
            }
            
            SecurityManager.validateFileUpload(file);
            
            // Generate import ID
            const importId = this.generateImportId();
            
            // Create import record
            const importRecord = {
                id: importId,
                userId: uid,
                fileName: file.name,
                fileSize: file.size,
                fileType: this.getFileType(file.name),
                status: 'uploading',
                createdAt: new Date(),
                progress: 0,
                totalPosts: 0,
                validPosts: 0,
                invalidPosts: 0,
                errors: [],
                warnings: []
            };
            
            this.activeImports.set(importId, importRecord);
            
            // Save to Firestore
            await this.saveImportRecord(importRecord);
            
            // Process file
            await this.processFile(file, importId);
            
            return importId;
            
        } catch (error) {
            Logger.error('Bulk import upload failed', error);
            await ErrorHandler.handle(error, { 
                component: 'BulkImportService',
                action: 'upload',
                fileName: file?.name 
            });
            throw error;
        }
    }
    
    static async processFile(file, importId) {
        try {
            const importRecord = this.activeImports.get(importId);
            if (!importRecord) throw new Error('Import record not found');
            
            // Update status
            importRecord.status = 'processing';
            importRecord.progress = 10;
            await this.updateImportRecord(importRecord);
            
            // Parse file content
            const posts = await this.parseFile(file);
            importRecord.totalPosts = posts.length;
            importRecord.progress = 30;
            await this.updateImportRecord(importRecord);
            
            // Validate data
            const validation = ValidationEngine.validateBulkImportData(posts);
            importRecord.validPosts = validation.summary.validCount;
            importRecord.invalidPosts = validation.summary.invalidCount;
            importRecord.progress = 60;
            await this.updateImportRecord(importRecord);
            
            if (validation.summary.validCount === 0) {
                throw new Error('No valid posts found in the file');
            }
            
            // Save posts to database
            await this.savePosts(importId, validation.valid);
            importRecord.progress = 80;
            await this.updateImportRecord(importRecord);
            
            // Schedule posts for publishing
            await this.schedulePostsForPublishing(importId, validation.valid);
            importRecord.progress = 100;
            importRecord.status = 'completed';
            await this.updateImportRecord(importRecord);
            
            Logger.info('Bulk import completed successfully', { 
                importId, 
                totalPosts: posts.length,
                validPosts: validation.summary.validCount 
            });
            
        } catch (error) {
            const importRecord = this.activeImports.get(importId);
            if (importRecord) {
                importRecord.status = 'failed';
                importRecord.errors.push(error.message);
                await this.updateImportRecord(importRecord);
            }
            throw error;
        }
    }
    
    static async parseFile(file) {
        const fileType = this.getFileType(file.name);
        const content = await FileHelper.readAsText(file);
        
        if (fileType === 'json') {
            return this.parseJSON(content);
        } else if (fileType === 'csv') {
            return this.parseCSV(content);
        } else {
            throw new Error('Unsupported file type');
        }
    }
    
    static parseJSON(content) {
        try {
            const data = JSON.parse(content);
            return Array.isArray(data) ? data : [data];
        } catch (error) {
            throw new Error('Invalid JSON format');
        }
    }
    
    static parseCSV(content) {
        try {
            const lines = content.split('\n').filter(line => line.trim());
            if (lines.length < 2) throw new Error('CSV must have at least header and one data row');
            
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const requiredColumns = ConfigManager.get('bulkImport.requiredColumns');
            
            // Check if all required columns are present
            const missingColumns = requiredColumns.filter(col => !headers.includes(col));
            if (missingColumns.length > 0) {
                throw new Error(`Missing required columns: ${missingColumns.join(', ')}`);
            }
            
            const posts = [];
            for (let i = 1; i < lines.length; i++) {
                const values = this.parseCSVLine(lines[i]);
                if (values.length !== headers.length) continue;
                
                const post = {};
                headers.forEach((header, index) => {
                    post[header] = values[index];
                });
                
                posts.push(post);
            }
            
            return posts;
        } catch (error) {
            throw new Error(`CSV parsing error: ${error.message}`);
        }
    }
    
    static parseCSVLine(line) {
        const result = [];
        let current = '';
        let inQuotes = false;
        
        for (let i = 0; i < line.length; i++) {
            const char = line[i];
            
            if (char === '"') {
                if (inQuotes && line[i + 1] === '"') {
                    current += '"';
                    i++;
                } else {
                    inQuotes = !inQuotes;
                }
            } else if (char === ',' && !inQuotes) {
                result.push(current.trim());
                current = '';
            } else {
                current += char;
            }
        }
        
        result.push(current.trim());
        return result;
    }
    
    static async savePosts(importId, validPosts) {
        const batch = firebase.firestore().batch();
        const postsRef = firebase.firestore().collection('bulk_imports').doc(importId).collection('posts');
        
        validPosts.forEach(({ index, data }) => {
            const postRef = postsRef.doc();
            batch.set(postRef, {
                ...data,
                importId,
                originalIndex: index,
                status: 'pending',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
        });
        
        await batch.commit();
    }
    
    static async schedulePostsForPublishing(importId, validPosts) {
        const scheduledPosts = validPosts.map(({ data }) => ({
            ...data,
            importId,
            scheduledAt: this.parseScheduledTime(data.day, data.hour),
            status: 'scheduled',
            createdAt: new Date(),
            userId: this.userUid
        }));
        
        await ScheduledPublishService.scheduleBatch(scheduledPosts);
    }
    
    static parseScheduledTime(day, hour) {
        try {
            const dateTime = new Date(`${day}T${hour}:00`);
            if (isNaN(dateTime.getTime())) {
                throw new Error('Invalid date/time format');
            }
            return dateTime;
        } catch (error) {
            throw new Error(`Invalid schedule time: ${day} ${hour}`);
        }
    }
    
    static async saveImportRecord(record) {
        await firebase.firestore()
            .collection('bulk_imports')
            .doc(record.id)
            .set(record, { merge: true });
    }
    
    static async updateImportRecord(record) {
        this.activeImports.set(record.id, record);
        await this.saveImportRecord({
            ...record,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        // Notify UI
        this.notifyProgressUpdate(record);
    }
    
    static notifyProgressUpdate(record) {
        // Emit custom event for UI updates
        const event = new CustomEvent('bulkImportProgress', {
            detail: record
        });
        document.dispatchEvent(event);
    }
    
    static getImportStatus(importId) {
        return this.activeImports.get(importId) || null;
    }
    
    static async getImportHistory(uid = null) {
        try {
            uid = uid || this.userUid;
            if (!uid) throw new Error('User ID required');
            
            const snapshot = await firebase.firestore()
                .collection('bulk_imports')
                .where('userId', '==', uid)
                .orderBy('createdAt', 'desc')
                .limit(50)
                .get();
                
            return snapshot.docs.map(doc => ({
                id: doc.id,
                ...doc.data()
            }));
        } catch (error) {
            Logger.error('Failed to load import history', error);
            return [];
        }
    }
    
    static async loadImportHistory() {
        this.importHistory = await this.getImportHistory();
    }
    
    static async cancelImport(importId) {
        try {
            const record = this.activeImports.get(importId);
            if (!record) throw new Error('Import not found');
            
            record.status = 'cancelled';
            record.progress = 0;
            await this.updateImportRecord(record);
            
            // Cancel any scheduled posts
            await ScheduledPublishService.cancelImportPosts(importId);
            
            Logger.info('Import cancelled', { importId });
        } catch (error) {
            Logger.error('Failed to cancel import', error);
            throw error;
        }
    }
    
    static getFileType(filename) {
        return filename.split('.').pop().toLowerCase();
    }
    
    static generateImportId() {
        return 'import_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }
}

/* ------------------------------------------------------------------ 
 * 5. SCHEDULED PUBLISH SERVICE
 * ------------------------------------------------------------------*/

class ScheduledPublishService {
    static scheduledPosts = new Map();
    static publishingQueue = [];
    static isProcessing = false;
    static checkInterval = 60000; // Check every minute
    static maxRetries = 3;
    
    static init() {
        this.startScheduleChecker();
        Logger.info('ScheduledPublishService initialized');
    }
    
    static startScheduleChecker() {
        setInterval(async () => {
            if (!this.isProcessing) {
                await this.checkAndPublishScheduledPosts();
            }
        }, this.checkInterval);
    }
    
    static async scheduleBatch(posts) {
        try {
            const batch = firebase.firestore().batch();
            const scheduledRef = firebase.firestore().collection('scheduled_posts');
            
            const scheduledPosts = posts.map(post => {
                const postId = this.generatePostId();
                const scheduledPost = {
                    id: postId,
                    ...post,
                    status: 'scheduled',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    scheduledAt: firebase.firestore.Timestamp.fromDate(post.scheduledAt),
                    retryCount: 0,
                    lastError: null
                };
                
                batch.set(scheduledRef.doc(postId), scheduledPost);
                this.scheduledPosts.set(postId, scheduledPost);
                
                return scheduledPost;
            });
            
            await batch.commit();
            
            Logger.info('Batch scheduled successfully', { 
                count: scheduledPosts.length,
                importId: posts[0]?.importId 
            });
            
            return scheduledPosts;
            
        } catch (error) {
            Logger.error('Failed to schedule batch', error);
            throw error;
        }
    }
    
    static async checkAndPublishScheduledPosts() {
        try {
            this.isProcessing = true;
            const now = new Date();
            
            // Query due posts from Firestore
            const snapshot = await firebase.firestore()
                .collection('scheduled_posts')
                .where('status', '==', 'scheduled')
                .where('scheduledAt', '<=', firebase.firestore.Timestamp.fromDate(now))
                .limit(50)
                .get();
            
            const duePosts = snapshot.docs.map(doc => ({
                id: doc.id,
                ...doc.data(),
                scheduledAt: doc.data().scheduledAt.toDate()
            }));
            
            if (duePosts.length > 0) {
                Logger.info(`Found ${duePosts.length} posts due for publishing`);
                
                for (const post of duePosts) {
                    await this.publishPost(post);
                }
            }
            
        } catch (error) {
            Logger.error('Error checking scheduled posts', error);
        } finally {
            this.isProcessing = false;
        }
    }
    
    static async publishPost(post) {
        try {
            // Update status to publishing
            await this.updatePostStatus(post.id, 'publishing');
            
            const platforms = post.platform.split(',').map(p => p.trim());
            const results = {};
            let successCount = 0;
            
            // Publish to each platform
            for (const platform of platforms) {
                try {
                    const platformService = this.getPlatformService(platform);
                    if (!platformService) {
                        throw new Error(`Platform service not available: ${platform}`);
                    }
                    
                    const result = await platformService.publish(post);
                    results[platform] = {
                        success: true,
                        platformPostId: result.platformPostId,
                        publishedAt: new Date()
                    };
                    successCount++;
                    
                } catch (platformError) {
                    Logger.error(`Failed to publish to ${platform}`, platformError);
                    results[platform] = {
                        success: false,
                        error: platformError.message,
                        attemptedAt: new Date()
                    };
                }
            }
            
            // Update final status
            const finalStatus = successCount > 0 ? 'published' : 'failed';
            await this.updatePostStatus(post.id, finalStatus, {
                results,
                successCount,
                totalPlatforms: platforms.length,
                publishedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            // If fully published, trigger file cleanup
            if (successCount === platforms.length) {
                await FileCleanupService.scheduleCleanup(post.importId);
            }
            
            Logger.info(`Post publishing completed`, { 
                postId: post.id,
                successCount,
                totalPlatforms: platforms.length,
                status: finalStatus
            });
            
        } catch (error) {
            Logger.error('Post publishing failed', error);
            await this.handlePublishingError(post, error);
        }
    }
    
    static async handlePublishingError(post, error) {
        const retryCount = (post.retryCount || 0) + 1;
        
        if (retryCount < this.maxRetries) {
            // Schedule retry
            const retryDelay = Math.min(1000 * Math.pow(2, retryCount), 300000); // Max 5 minutes
            const retryAt = new Date(Date.now() + retryDelay);
            
            await this.updatePostStatus(post.id, 'scheduled', {
                retryCount,
                lastError: error.message,
                scheduledAt: firebase.firestore.Timestamp.fromDate(retryAt)
            });
            
            Logger.info(`Post scheduled for retry`, { 
                postId: post.id, 
                retryCount, 
                retryAt 
            });
        } else {
            // Max retries reached, mark as failed
            await this.updatePostStatus(post.id, 'failed', {
                retryCount,
                lastError: error.message,
                failedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            Logger.error(`Post failed after ${this.maxRetries} retries`, { 
                postId: post.id, 
                error: error.message 
            });
        }
    }
    
    static getPlatformService(platform) {
        const services = {
            facebook: FacebookGraphService,
            instagram: InstagramGraphService,
            twitter: TwitterService,
            linkedin: LinkedInService,
            tiktok: TikTokService
        };
        
        return services[platform] || null;
    }
    
    static async updatePostStatus(postId, status, additionalData = {}) {
        const updateData = {
            status,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
            ...additionalData
        };
        
        await firebase.firestore()
            .collection('scheduled_posts')
            .doc(postId)
            .update(updateData);
        
        // Update local cache
        if (this.scheduledPosts.has(postId)) {
            const post = this.scheduledPosts.get(postId);
            Object.assign(post, updateData);
        }
    }
    
    static async cancelImportPosts(importId) {
        try {
            const snapshot = await firebase.firestore()
                .collection('scheduled_posts')
                .where('importId', '==', importId)
                .where('status', '==', 'scheduled')
                .get();
            
            const batch = firebase.firestore().batch();
            
            snapshot.docs.forEach(doc => {
                batch.update(doc.ref, {
                    status: 'cancelled',
                    cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            });
            
            await batch.commit();
            
            Logger.info(`Cancelled ${snapshot.docs.length} scheduled posts for import ${importId}`);
        } catch (error) {
            Logger.error('Failed to cancel import posts', error);
            throw error;
        }
    }
    
    static generatePostId() {
        return 'post_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }
}

/* ------------------------------------------------------------------ 
 * 6. FILE CLEANUP SERVICE
 * ------------------------------------------------------------------*/

class FileCleanupService {
    static cleanupQueue = new Map();
    static userUid = null;
    static cleanupDelay = ConfigManager.get('system.cleanupDelay');
    
    static initializeForUser(uid) {
        this.userUid = uid;
        this.startCleanupProcessor();
        Logger.info('FileCleanupService initialized for user', { uid });
    }
    
    static reset() {
        this.cleanupQueue.clear();
        this.userUid = null;
    }
    
    static startCleanupProcessor() {
        // Process cleanup queue every hour
        setInterval(async () => {
            await this.processCleanupQueue();
        }, 60 * 60 * 1000);
    }
    
    static async scheduleCleanup(importId, delay = null) {
        try {
            delay = delay || this.cleanupDelay;
            const executeAt = new Date(Date.now() + delay);
            
            const cleanupTask = {
                importId,
                scheduledAt: executeAt,
                status: 'scheduled',
                createdAt: new Date()
            };
            
            this.cleanupQueue.set(importId, cleanupTask);
            
            // Save to Firestore for persistence
            await firebase.firestore()
                .collection('cleanup_tasks')
                .doc(importId)
                .set(cleanupTask);
            
            Logger.info('Cleanup scheduled', { importId, executeAt });
            
            // If delay is short, process immediately
            if (delay < 60000) { // Less than 1 minute
                setTimeout(() => this.executeCleanup(importId), delay);
            }
            
        } catch (error) {
            Logger.error('Failed to schedule cleanup', error);
        }
    }
    
    static async processCleanupQueue() {
        try {
            const now = new Date();
            
            // Load pending cleanup tasks from Firestore
            const snapshot = await firebase.firestore()
                .collection('cleanup_tasks')
                .where('status', '==', 'scheduled')
                .where('scheduledAt', '<=', firebase.firestore.Timestamp.fromDate(now))
                .get();
            
            for (const doc of snapshot.docs) {
                const task = doc.data();
                await this.executeCleanup(task.importId);
            }
            
        } catch (error) {
            Logger.error('Cleanup queue processing failed', error);
        }
    }
    
    static async executeCleanup(importId) {
        try {
            Logger.info('Executing cleanup', { importId });
            
            // Check if all posts from this import have been published
            const hasUnpublishedPosts = await this.checkUnpublishedPosts(importId);
            
            if (hasUnpublishedPosts) {
                Logger.info('Cleanup postponed - unpublished posts exist', { importId });
                
                // Reschedule for later
                await this.scheduleCleanup(importId, 60 * 60 * 1000); // 1 hour later
                return;
            }
            
            // Delete import files and data
            await this.deleteImportData(importId);
            
            // Update cleanup task status
            await this.updateCleanupTaskStatus(importId, 'completed');
            
            Logger.info('Cleanup completed successfully', { importId });
            
        } catch (error) {
            Logger.error('Cleanup execution failed', { importId, error });
            await this.updateCleanupTaskStatus(importId, 'failed', error.message);
        }
    }
    
    static async checkUnpublishedPosts(importId) {
        try {
            const snapshot = await firebase.firestore()
                .collection('scheduled_posts')
                .where('importId', '==', importId)
                .where('status', 'in', ['scheduled', 'publishing'])
                .limit(1)
                .get();
            
            return !snapshot.empty;
        } catch (error) {
            Logger.error('Failed to check unpublished posts', error);
            return true; // Err on the side of caution
        }
    }
    
    static async deleteImportData(importId) {
        try {
            const batch = firebase.firestore().batch();
            
            // Delete import record
            const importRef = firebase.firestore().collection('bulk_imports').doc(importId);
            batch.delete(importRef);
            
            // Delete import posts subcollection
            const postsSnapshot = await importRef.collection('posts').get();
            postsSnapshot.docs.forEach(doc => {
                batch.delete(doc.ref);
            });
            
            // Delete any uploaded files from Firebase Storage
            await this.deleteImportFiles(importId);
            
            await batch.commit();
            
            Logger.info('Import data deleted', { importId });
            
        } catch (error) {
            Logger.error('Failed to delete import data', error);
            throw error;
        }
    }
    
    static async deleteImportFiles(importId) {
        try {
            const storage = firebase.storage();
            const folderRef = storage.ref().child(`bulk_imports/${importId}`);
            
            // List all files in the import folder
            const listResult = await folderRef.listAll();
            
            // Delete each file
            const deletePromises = listResult.items.map(fileRef => fileRef.delete());
            await Promise.all(deletePromises);
            
            Logger.info('Import files deleted from storage', { importId });
            
        } catch (error) {
            // Storage errors are not critical for the cleanup process
            Logger.warn('Failed to delete import files from storage', error);
        }
    }
    
    static async updateCleanupTaskStatus(importId, status, error = null) {
        try {
            const updateData = {
                status,
                completedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            if (error) {
                updateData.error = error;
            }
            
            await firebase.firestore()
                .collection('cleanup_tasks')
                .doc(importId)
                .update(updateData);
            
            // Update local queue
            if (this.cleanupQueue.has(importId)) {
                const task = this.cleanupQueue.get(importId);
                Object.assign(task, updateData);
            }
            
        } catch (error) {
            Logger.error('Failed to update cleanup task status', error);
        }
    }
    
    static async forceCleanup(importId) {
        try {
            Logger.warn('Force cleanup initiated', { importId });
            await this.deleteImportData(importId);
            await this.updateCleanupTaskStatus(importId, 'force_completed');
        } catch (error) {
            Logger.error('Force cleanup failed', error);
            throw error;
        }
    }
    
    static async getStorageUsage(uid) {
        try {
            uid = uid || this.userUid;
            
            const snapshot = await firebase.firestore()
                .collection('bulk_imports')
                .where('userId', '==', uid)
                .get();
            
            let totalSize = 0;
            let activeImports = 0;
            
            snapshot.docs.forEach(doc => {
                const data = doc.data();
                totalSize += data.fileSize || 0;
                if (data.status !== 'completed') {
                    activeImports++;
                }
            });
            
            return {
                totalSize,
                activeImports,
                formattedSize: FileHelper.formatFileSize(totalSize)
            };
            
        } catch (error) {
            Logger.error('Failed to get storage usage', error);
            return { totalSize: 0, activeImports: 0, formattedSize: '0 B' };
        }
    }
}

/* ------------------------------------------------------------------ 
 * 7. PLATFORM SERVICES
 * ------------------------------------------------------------------*/

// Facebook Graph Service
class FacebookGraphService {
    static apiVersion = ConfigManager.get('platforms.facebook.apiVersion');
    static baseUrl = ConfigManager.get('platforms.facebook.baseUrl');
    static rateLimit = ConfigManager.get('platforms.facebook.rateLimit');
    
    static async publish(post) {
        try {
            // Get Facebook access token
            const accessToken = await this.getAccessToken(post.userId);
            if (!accessToken) throw new Error('Facebook access token not available');
            
            // Format content for Facebook
            const content = this.formatContent(post);
            
            // Prepare post data
            const postData = {
                message: content.text,
                access_token: accessToken
            };
            
            // Add image if available
            if (post.socialImageurl) {
                postData.picture = post.socialImageurl;
            }
            
            // Add link if available
            if (post.shortUrl) {
                postData.link = post.shortUrl;
            }
            
            const pageId = await this.getPageId(post.userId);
            const url = `${this.baseUrl}/${this.apiVersion}/${pageId}/feed`;
            
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams(postData)
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(`Facebook API error: ${error.error?.message || response.statusText}`);
            }
            
            const result = await response.json();
            
            Logger.info('Facebook post published', { postId: result.id });
            
            return {
                success: true,
                platformPostId: result.id,
                publishedAt: new Date(),
                platform: 'facebook'
            };
            
        } catch (error) {
            Logger.error('Facebook publishing failed', error);
            throw error;
        }
    }
    
    static formatContent(post) {
        let text = `${post.socialTitle}\n\n${post.socialDescription}`;
        
        // Add hashtags
        if (post.socialhachtags) {
            text += `\n\n${post.socialhachtags}`;
        }
        
        // Check content limit
        const limit = ConfigManager.get('platforms.facebook.contentLimit');
        if (text.length > limit) {
            text = text.substring(0, limit - 3) + '...';
        }
        
        return { text };
    }
    
    static async getAccessToken(userId) {
        try {
            const doc = await firebase.firestore()
                .collection('accounts')
                .doc(`${userId}_facebook`)
                .get();
                
            return doc.exists ? doc.data().accessToken : null;
        } catch (error) {
            Logger.error('Failed to get Facebook access token', error);
            return null;
        }
    }
    
    static async getPageId(userId) {
        try {
            const doc = await firebase.firestore()
                .collection('accounts')
                .doc(`${userId}_facebook`)
                .get();
                
            return doc.exists ? doc.data().pageId : null;
        } catch (error) {
            Logger.error('Failed to get Facebook page ID', error);
            throw new Error('Facebook page not configured');
        }
    }
}

// Instagram Graph Service
class InstagramGraphService {
    static apiVersion = ConfigManager.get('platforms.instagram.apiVersion');
    static baseUrl = ConfigManager.get('platforms.instagram.baseUrl');
    
    static async publish(post) {
        try {
            // Instagram requires an image
            if (!post.socialImageurl) {
                throw new Error('Instagram posts require an image');
            }
            
            const accessToken = await this.getAccessToken(post.userId);
            if (!accessToken) throw new Error('Instagram access token not available');
            
            const content = this.formatContent(post);
            const accountId = await this.getAccountId(post.userId);
            
            // Step 1: Create media container
            const containerResponse = await this.createMediaContainer(accountId, accessToken, content, post.socialImageurl);
            const containerId = containerResponse.id;
            
            // Step 2: Publish the media
            const publishResponse = await this.publishMedia(accountId, accessToken, containerId);
            
            Logger.info('Instagram post published', { postId: publishResponse.id });
            
            return {
                success: true,
                platformPostId: publishResponse.id,
                publishedAt: new Date(),
                platform: 'instagram'
            };
            
        } catch (error) {
            Logger.error('Instagram publishing failed', error);
            throw error;
        }
    }
    
    static async createMediaContainer(accountId, accessToken, content, imageUrl) {
        const url = `${this.baseUrl}/${this.apiVersion}/${accountId}/media`;
        
        const postData = {
            image_url: imageUrl,
            caption: content.text,
            access_token: accessToken
        };
        
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams(postData)
        });
        
        if (!response.ok) {
            const error = await response.json();
            throw new Error(`Instagram media container error: ${error.error?.message || response.statusText}`);
        }
        
        return await response.json();
    }
    
    static async publishMedia(accountId, accessToken, containerId) {
        const url = `${this.baseUrl}/${this.apiVersion}/${accountId}/media_publish`;
        
        const postData = {
            creation_id: containerId,
            access_token: accessToken
        };
        
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams(postData)
        });
        
        if (!response.ok) {
            const error = await response.json();
            throw new Error(`Instagram publish error: ${error.error?.message || response.statusText}`);
        }
        
        return await response.json();
    }
    
    static formatContent(post) {
        let text = `${post.socialTitle}\n\n${post.socialDescription}`;
        
        // Add hashtags (Instagram loves hashtags)
        if (post.socialhachtags) {
            text += `\n\n${post.socialhachtags}`;
        }
        
        // Check content limit
        const limit = ConfigManager.get('platforms.instagram.contentLimit');
        if (text.length > limit) {
            text = text.substring(0, limit - 3) + '...';
        }
        
        return { text };
    }
    
    static async getAccessToken(userId) {
        try {
            const doc = await firebase.firestore()
                .collection('accounts')
                .doc(`${userId}_instagram`)
                .get();
                
            return doc.exists ? doc.data().accessToken : null;
        } catch (error) {
            Logger.error('Failed to get Instagram access token', error);
            return null;
        }
    }
    
    static async getAccountId(userId) {
        try {
            const doc = await firebase.firestore()
                .collection('accounts')
                .doc(`${userId}_instagram`)
                .get();
                
            return doc.exists ? doc.data().accountId : null;
        } catch (error) {
            Logger.error('Failed to get Instagram account ID', error);
            throw new Error('Instagram account not configured');
        }
    }
}

// Twitter Service
class TwitterService {
    static apiVersion = ConfigManager.get('platforms.twitter.apiVersion');
    static baseUrl = ConfigManager.get('platforms.twitter.baseUrl');
    
    static async publish(post) {
        try {
            const accessToken = await this.getAccessToken(post.userId);
            if (!accessToken) throw new Error('Twitter access token not available');
            
            const content = this.formatContent(post);
            
            // Check if we need to create a thread
            const tweets = this.splitIntoTweets(content.text);
            
            if (tweets.length === 1) {
                return await this.publishSingleTweet(accessToken, tweets[0], post);
            } else {
                return await this.publishThread(accessToken, tweets, post);
            }
            
        } catch (error) {
            Logger.error('Twitter publishing failed', error);
            throw error;
        }
    }
    
    static formatContent(post) {
        let text = `${post.socialTitle}\n\n${post.socialDescription}`;
        
        // Add hashtags
        if (post.socialhachtags) {
            text += `\n\n${post.socialhachtags}`;
        }
        
        return { text };
    }
    
    static splitIntoTweets(text) {
        const maxLength = ConfigManager.get('platforms.twitter.contentLimit');
        
        if (text.length <= maxLength) {
            return [text];
        }
        
        const tweets = [];
        let currentTweet = '';
        const words = text.split(' ');
        
        for (const word of words) {
            if (currentTweet.length + word.length + 1 <= maxLength - 10) { // Reserve space for "... (1/n)"
                currentTweet += (currentTweet ? ' ' : '') + word;
            } else {
                if (currentTweet) {
                    tweets.push(currentTweet);
                    currentTweet = word;
                } else {
                    // Word is too long, split it
                    tweets.push(word.substring(0, maxLength - 10));
                    currentTweet = word.substring(maxLength - 10);
                }
            }
        }
        
        if (currentTweet) {
            tweets.push(currentTweet);
        }
        
        // Add thread indicators
        return tweets.map((tweet, index) => 
            tweets.length > 1 ? `${tweet} (${index + 1}/${tweets.length})` : tweet
        );
    }
    
    static async publishSingleTweet(accessToken, tweetText, post) {
        const tweetData = { text: tweetText };
        
        // Add media if available
        if (post.socialImageurl) {
            const mediaId = await this.uploadMedia(accessToken, post.socialImageurl);
            if (mediaId) {
                tweetData.media = { media_ids: [mediaId] };
            }
        }
        
        const response = await this.makeTweetRequest(accessToken, tweetData);
        
        return {
            success: true,
            platformPostId: response.data.id,
            publishedAt: new Date(),
            platform: 'twitter'
        };
    }
    
    static async publishThread(accessToken, tweets, post) {
        const tweetIds = [];
        let replyToId = null;
        
        for (let i = 0; i < tweets.length; i++) {
            const tweetData = { text: tweets[i] };
            
            if (replyToId) {
                tweetData.reply = { in_reply_to_tweet_id: replyToId };
            }
            
            // Add media to first tweet only
            if (i === 0 && post.socialImageurl) {
                const mediaId = await this.uploadMedia(accessToken, post.socialImageurl);
                if (mediaId) {
                    tweetData.media = { media_ids: [mediaId] };
                }
            }
            
            const response = await this.makeTweetRequest(accessToken, tweetData);
            const tweetId = response.data.id;
            tweetIds.push(tweetId);
            replyToId = tweetId;
        }
        
        return {
            success: true,
            platformPostId: tweetIds[0], // Return the ID of the first tweet
            threadIds: tweetIds,
            publishedAt: new Date(),
            platform: 'twitter'
        };
    }
    
    static async makeTweetRequest(accessToken, tweetData) {
        const url = `${this.baseUrl}/${this.apiVersion}/tweets`;
        
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${accessToken}`,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(tweetData)
        });
        
        if (!response.ok) {
            const error = await response.json();
            throw new Error(`Twitter API error: ${error.detail || response.statusText}`);
        }
        
        return await response.json();
    }
    
    static async uploadMedia(accessToken, imageUrl) {
        try {
            // First, fetch the image
            const imageResponse = await fetch(imageUrl);
            if (!imageResponse.ok) return null;
            
            const imageBlob = await imageResponse.blob();
            const formData = new FormData();
            formData.append('media', imageBlob);
            
            const uploadResponse = await fetch('https://upload.twitter.com/1.1/media/upload.json', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                },
                body: formData
            });
            
            if (uploadResponse.ok) {
                const result = await uploadResponse.json();
                return result.media_id_string;
            }
            
            return null;
        } catch (error) {
            Logger.warn('Twitter media upload failed', error);
            return null;
        }
    }
    
    static async getAccessToken(userId) {
        try {
            const doc = await firebase.firestore()
                .collection('accounts')
                .doc(`${userId}_twitter`)
                .get();
                
            return doc.exists ? doc.data().accessToken : null;
        } catch (error) {
            Logger.error('Failed to get Twitter access token', error);
            return null;
        }
    }
}

// LinkedIn Service
class LinkedInService {
    static apiVersion = ConfigManager.get('platforms.linkedin.apiVersion');
    static baseUrl = ConfigManager.get('platforms.linkedin.baseUrl');
    
    static async publish(post) {
        try {
            const accessToken = await this.getAccessToken(post.userId);
            if (!accessToken) throw new Error('LinkedIn access token not available');
            
            const personId = await this.getPersonId(post.userId);
            const content = this.formatContent(post);
            
            const postData = {
                author: `urn:li:person:${personId}`,
                lifecycleState: 'PUBLISHED',
                specificContent: {
                    'com.linkedin.ugc.ShareContent': {
                        shareCommentary: {
                            text: content.text
                        },
                        shareMediaCategory: post.socialImageurl || post.shortUrl ? 'ARTICLE' : 'NONE'
                    }
                },
                visibility: {
                    'com.linkedin.ugc.MemberNetworkVisibility': 'PUBLIC'
                }
            };
            
            // Add article/link content
            if (post.shortUrl) {
                postData.specificContent['com.linkedin.ugc.ShareContent'].media = [{
                    status: 'READY',
                    originalUrl: post.shortUrl,
                    title: {
                        text: post.socialTitle
                    },
                    description: {
                        text: post.socialDescription
                    }
                }];
                
                if (post.socialImageurl) {
                    postData.specificContent['com.linkedin.ugc.ShareContent'].media[0].thumbnails = [{
                        url: post.socialImageurl
                    }];
                }
            }
            
            const response = await fetch(`${this.baseUrl}/${this.apiVersion}/ugcPosts`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'Content-Type': 'application/json',
                    'X-Restli-Protocol-Version': '2.0.0'
                },
                body: JSON.stringify(postData)
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(`LinkedIn API error: ${error.message || response.statusText}`);
            }
            
            const result = await response.json();
            
            Logger.info('LinkedIn post published', { postId: result.id });
            
            return {
                success: true,
                platformPostId: result.id,
                publishedAt: new Date(),
                platform: 'linkedin'
            };
            
        } catch (error) {
            Logger.error('LinkedIn publishing failed', error);
            throw error;
        }
    }
    
    static formatContent(post) {
        let text = `${post.socialTitle}\n\n${post.socialDescription}`;
        
        // Add hashtags
        if (post.socialhachtags) {
            text += `\n\n${post.socialhachtags}`;
        }
        
        // Check content limit
        const limit = ConfigManager.get('platforms.linkedin.contentLimit');
        if (text.length > limit) {
            text = text.substring(0, limit - 3) + '...';
        }
        
        return { text };
    }
    
    static async getAccessToken(userId) {
        try {
            const doc = await firebase.firestore()
                .collection('accounts')
                .doc(`${userId}_linkedin`)
                .get();
                
            return doc.exists ? doc.data().accessToken : null;
        } catch (error) {
            Logger.error('Failed to get LinkedIn access token', error);
            return null;
        }
    }
    
    static async getPersonId(userId) {
        try {
            const doc = await firebase.firestore()
                .collection('accounts')
                .doc(`${userId}_linkedin`)
                .get();
                
            return doc.exists ? doc.data().personId : null;
        } catch (error) {
            Logger.error('Failed to get LinkedIn person ID', error);
            throw new Error('LinkedIn account not configured');
        }
    }
}

// TikTok Service
class TikTokService {
    static apiVersion = ConfigManager.get('platforms.tiktok.apiVersion');
    static baseUrl = ConfigManager.get('platforms.tiktok.baseUrl');
    
    static async publish(post) {
        try {
            // Note: TikTok primarily requires video content
            // This implementation assumes text-based posts for business accounts
            
            const accessToken = await this.getAccessToken(post.userId);
            if (!accessToken) throw new Error('TikTok access token not available');
            
            const content = this.formatContent(post);
            
            // TikTok Business API for text posts (limited availability)
            const postData = {
                text: content.text,
                privacy_level: 'MUTUAL_FOLLOW_FRIENDS', // or 'PUBLIC_TO_EVERYONE'
                disable_duet: false,
                disable_comment: false,
                disable_stitch: false,
                brand_content_toggle: false
            };
            
            // Add video URL if available (TikTok prefers video content)
            if (post.videoUrl) {
                postData.video_url = post.videoUrl;
            }
            
            const response = await fetch(`${this.baseUrl}/${this.apiVersion}/post/publish/`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(postData)
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(`TikTok API error: ${error.message || response.statusText}`);
            }
            
            const result = await response.json();
            
            Logger.info('TikTok post published', { postId: result.publish_id });
            
            return {
                success: true,
                platformPostId: result.publish_id,
                publishedAt: new Date(),
                platform: 'tiktok'
            };
            
        } catch (error) {
            Logger.error('TikTok publishing failed', error);
            throw error;
        }
    }
    
    static formatContent(post) {
        let text = `${post.socialTitle}\n\n${post.socialDescription}`;
        
        // Add hashtags (very important for TikTok)
        if (post.socialhachtags) {
            text += `\n\n${post.socialhachtags}`;
        }
        
        // Check content limit
        const limit = ConfigManager.get('platforms.tiktok.contentLimit');
        if (text.length > limit) {
            text = text.substring(0, limit - 3) + '...';
        }
        
        return { text };
    }
    
    static async getAccessToken(userId) {
        try {
            const doc = await firebase.firestore()
                .collection('accounts')
                .doc(`${userId}_tiktok`)
                .get();
                
            return doc.exists ? doc.data().accessToken : null;
        } catch (error) {
            Logger.error('Failed to get TikTok access token', error);
            return null;
        }
    }
}

/* ------------------------------------------------------------------ 
 * 8. POST SERVICE (مبسط للجدولة فقط)
 * ------------------------------------------------------------------*/

class PostService {
    static subscribers = new Map();
    
    static async create(postData) {
        try {
            const uid = AuthService.getCurrentUser()?.uid;
            if (!uid) throw new Error('User not authenticated');
            
            const postId = this.generatePostId();
            const post = {
                id: postId,
                userId: uid,
                ...SecurityManager.sanitizeObject(postData),
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            await firebase.firestore()
                .collection('posts')
                .doc(postId)
                .set(post);
            
            Logger.info('Post created', { postId });
            return postId;
            
        } catch (error) {
            Logger.error('Failed to create post', error);
            throw error;
        }
    }
    
    static async update(postId, data) {
        try {
            const uid = AuthService.getCurrentUser()?.uid;
            if (!uid) throw new Error('User not authenticated');
            
            const updateData = {
                ...SecurityManager.sanitizeObject(data),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            await firebase.firestore()
                .collection('posts')
                .doc(postId)
                .update(updateData);
            
            Logger.info('Post updated', { postId });
            
        } catch (error) {
            Logger.error('Failed to update post', error);
            throw error;
        }
    }
    
    static async delete(postId) {
        try {
            const uid = AuthService.getCurrentUser()?.uid;
            if (!uid) throw new Error('User not authenticated');
            
            // Verify ownership
            const doc = await firebase.firestore()
                .collection('posts')
                .doc(postId)
                .get();
            
            if (!doc.exists || doc.data().userId !== uid) {
                throw new Error('Post not found or access denied');
            }
            
            await firebase.firestore()
                .collection('posts')
                .doc(postId)
                .delete();
            
            Logger.info('Post deleted', { postId });
            
        } catch (error) {
            Logger.error('Failed to delete post', error);
            throw error;
        }
    }
    
    static async list(uid, options = {}) {
        try {
            uid = uid || AuthService.getCurrentUser()?.uid;
            if (!uid) throw new Error('User not authenticated');
            
            let query = firebase.firestore()
                .collection('posts')
                .where('userId', '==', uid)
                .orderBy('createdAt', 'desc');
            
            if (options.status) {
                query = query.where('status', '==', options.status);
            }
            
            if (options.limit) {
                query = query.limit(options.limit);
            }
            
            const snapshot = await query.get();
            
            return snapshot.docs.map(doc => ({
                id: doc.id,
                ...doc.data(),
                createdAt: doc.data().createdAt?.toDate(),
                updatedAt: doc.data().updatedAt?.toDate(),
                scheduledAt: doc.data().scheduledAt?.toDate()
            }));
            
        } catch (error) {
            Logger.error('Failed to list posts', error);
            throw error;
        }
    }
    
    static subscribe(uid, callback, options = {}) {
        try {
            uid = uid || AuthService.getCurrentUser()?.uid;
            if (!uid) throw new Error('User not authenticated');
            
            let query = firebase.firestore()
                .collection('posts')
                .where('userId', '==', uid)
                .orderBy('createdAt', 'desc');
            
            if (options.status) {
                query = query.where('status', '==', options.status);
            }
            
            if (options.limit) {
                query = query.limit(options.limit);
            }
            
            const unsubscribe = query.onSnapshot((snapshot) => {
                const posts = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data(),
                    createdAt: doc.data().createdAt?.toDate(),
                    updatedAt: doc.data().updatedAt?.toDate(),
                    scheduledAt: doc.data().scheduledAt?.toDate()
                }));
                
                callback(posts);
            }, (error) => {
                Logger.error('Post subscription error', error);
                callback([]);
            });
            
            // Store subscription
            const subscriptionId = 'sub_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            this.subscribers.set(subscriptionId, { unsubscribe, callback });
            
            // Return unsubscribe function
            return () => {
                unsubscribe();
                this.subscribers.delete(subscriptionId);
            };
            
        } catch (error) {
            Logger.error('Failed to subscribe to posts', error);
            return () => {};
        }
    }
    
    static async getById(postId) {
        try {
            const doc = await firebase.firestore()
                .collection('posts')
                .doc(postId)
                .get();
            
            if (!doc.exists) {
                throw new Error('Post not found');
            }
            
            const data = doc.data();
            return {
                id: doc.id,
                ...data,
                createdAt: data.createdAt?.toDate(),
                updatedAt: data.updatedAt?.toDate(),
                scheduledAt: data.scheduledAt?.toDate()
            };
            
        } catch (error) {
            Logger.error('Failed to get post by ID', error);
            throw error;
        }
    }
    
    static async markAsPublished(postId, platformResults) {
        try {
            await this.update(postId, {
                status: 'published',
                platformResults,
                publishedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            Logger.info('Post marked as published', { postId });
            
        } catch (error) {
            Logger.error('Failed to mark post as published', error);
            throw error;
        }
    }
    
    static generatePostId() {
        return 'post_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }
    
    static cleanup() {
        // Unsubscribe all active subscriptions
        this.subscribers.forEach(({ unsubscribe }) => {
            try {
                unsubscribe();
            } catch (error) {
                Logger.error('Error cleaning up post subscription', error);
            }
        });
        
        this.subscribers.clear();
    }
}

/* ------------------------------------------------------------------ 
 * 9. DASHBOARD CONTROLLER
 * ------------------------------------------------------------------*/

class DashboardController {
    static isInitialized = false;
    static subscriptions = [];
    static refreshInterval = null;
    
    static async init() {
        if (this.isInitialized) return;
        
        try {
            Logger.info('Initializing Dashboard Controller');
            
            // Wait for authentication
            if (!AuthService.isAuthenticated()) {
                Logger.warn('Dashboard init: User not authenticated');
                return;
            }
            
            // Setup real-time subscriptions
            this.setupSubscriptions();
            
            // Load initial data
            await this.loadInitialData();
            
            // Setup refresh intervals
            this.setupRefreshIntervals();
            
            // Setup UI event listeners
            this.setupUIEventListeners();
            
            this.isInitialized = true;
            Logger.info('Dashboard Controller initialized');
            
        } catch (error) {
            Logger.error('Dashboard Controller initialization failed', error);
            await ErrorHandler.handle(error, {
                component: 'DashboardController',
                action: 'init'
            });
        }
    }
    
    static setupSubscriptions() {
        const uid = AuthService.getCurrentUser()?.uid;
        if (!uid) return;
        
        // Subscribe to bulk imports
        const importUnsubscribe = firebase.firestore()
            .collection('bulk_imports')
            .where('userId', '==', uid)
            .orderBy('createdAt', 'desc')
            .limit(10)
            .onSnapshot((snapshot) => {
                const imports = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                this.updateImportsDisplay(imports);
            });
        
        this.subscriptions.push(importUnsubscribe);
        
        // Subscribe to scheduled posts
        const scheduledUnsubscribe = firebase.firestore()
            .collection('scheduled_posts')
            .where('userId', '==', uid)
            .where('status', 'in', ['scheduled', 'publishing'])
            .orderBy('scheduledAt', 'asc')
            .limit(20)
            .onSnapshot((snapshot) => {
                const posts = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data(),
                    scheduledAt: doc.data().scheduledAt?.toDate()
                }));
                this.updateScheduledPostsDisplay(posts);
            });
        
        this.subscriptions.push(scheduledUnsubscribe);
    }
    
    static async loadInitialData() {
        try {
            const uid = AuthService.getCurrentUser()?.uid;
            if (!uid) return;
            
            // Load dashboard statistics
            const stats = await this.getDashboardStats(uid);
            this.updateStatsDisplay(stats);
            
            // Load storage usage
            const storageUsage = await FileCleanupService.getStorageUsage(uid);
            this.updateStorageDisplay(storageUsage);
            
        } catch (error) {
            Logger.error('Failed to load dashboard data', error);
        }
    }
    
    static async getDashboardStats(uid) {
        try {
            const [importsSnapshot, scheduledSnapshot, publishedSnapshot] = await Promise.all([
                firebase.firestore().collection('bulk_imports').where('userId', '==', uid).get(),
                firebase.firestore().collection('scheduled_posts').where('userId', '==', uid).where('status', '==', 'scheduled').get(),
                firebase.firestore().collection('scheduled_posts').where('userId', '==', uid).where('status', '==', 'published').get()
            ]);
            
            return {
                totalImports: importsSnapshot.size,
                scheduledPosts: scheduledSnapshot.size,
                publishedPosts: publishedSnapshot.size,
                successRate: publishedSnapshot.size > 0 ? 
                    Math.round((publishedSnapshot.size / (publishedSnapshot.size + scheduledSnapshot.size)) * 100) : 0
            };
            
        } catch (error) {
            Logger.error('Failed to get dashboard stats', error);
            return {
                totalImports: 0,
                scheduledPosts: 0,
                publishedPosts: 0,
                successRate: 0
            };
        }
    }
    
    static updateStatsDisplay(stats) {
        this.updateElement('totalImports', stats.totalImports);
        this.updateElement('scheduledPosts', stats.scheduledPosts);
        this.updateElement('publishedPosts', stats.publishedPosts);
        this.updateElement('successRate', stats.successRate + '%');
    }
    
    static updateImportsDisplay(imports) {
        const container = document.getElementById('recentImports');
        if (!container) return;
        
        const html = imports.map(importRecord => `
            <div class="import-item" data-import-id="${importRecord.id}">
                <div class="import-info">
                    <div class="import-name">${importRecord.fileName}</div>
                    <div class="import-stats">
                        ${importRecord.validPosts || 0} منشور صالح من ${importRecord.totalPosts || 0}
                    </div>
                    <div class="import-date">
                        ${this.formatDate(importRecord.createdAt)}
                    </div>
                </div>
                <div class="import-status status-${importRecord.status}">
                    ${this.getStatusText(importRecord.status)}
                </div>
                <div class="import-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${importRecord.progress || 0}%"></div>
                    </div>
                </div>
            </div>
        `).join('');
        
        container.innerHTML = html || '<div class="empty-state">لا توجد عمليات استيراد حديثة</div>';
    }
    
    static updateScheduledPostsDisplay(posts) {
        const container = document.getElementById('scheduledPosts');
        if (!container) return;
        
        const html = posts.map(post => `
            <div class="scheduled-post-item">
                <div class="post-content">
                    <div class="post-title">${post.socialTitle}</div>
                    <div class="post-platforms">${post.platform}</div>
                </div>
                <div class="post-schedule">
                    <div class="schedule-date">${this.formatDate(post.scheduledAt)}</div>
                    <div class="schedule-time">${this.formatTime(post.scheduledAt)}</div>
                </div>
                <div class="post-status status-${post.status}">
                    ${this.getStatusText(post.status)}
                </div>
            </div>
        `).join('');
        
        container.innerHTML = html || '<div class="empty-state">لا توجد منشورات مجدولة</div>';
    }
    
    static updateStorageDisplay(usage) {
        const container = document.getElementById('storageUsage');
        if (!container) return;
        
        container.innerHTML = `
            <div class="storage-info">
                <div class="storage-used">${usage.formattedSize}</div>
                <div class="storage-label">المساحة المستخدمة</div>
            </div>
            <div class="storage-files">
                <div class="files-count">${usage.activeImports}</div>
                <div class="files-label">ملفات نشطة</div>
            </div>
        `;
    }
    
    static setupRefreshIntervals() {
        // Refresh dashboard every 30 seconds
        this.refreshInterval = setInterval(async () => {
            try {
                const uid = AuthService.getCurrentUser()?.uid;
                if (uid) {
                    const stats = await this.getDashboardStats(uid);
                    this.updateStatsDisplay(stats);
                }
            } catch (error) {
            }
        }, 30000);
    }
    
    static setupUIEventListeners() {
        // Refresh button
        const refreshBtn = document.getElementById('refreshDashboard');
        if (refreshBtn) {
            refreshBtn.addEventListener('click', () => this.loadInitialData());
        }
        
        // Import history toggle
        const historyToggle = document.getElementById('toggleImportHistory');
        if (historyToggle) {
            historyToggle.addEventListener('click', () => this.toggleImportHistory());
        }
    }
    
    static async toggleImportHistory() {
        const container = document.getElementById('importHistoryContainer');
        if (!container) return;
        
        if (container.style.display === 'none' || !container.style.display) {
            // Load and show history
            const uid = AuthService.getCurrentUser()?.uid;
            if (uid) {
                const history = await BulkImportService.getImportHistory(uid);
                this.displayImportHistory(history);
                container.style.display = 'block';
            }
        } else {
            container.style.display = 'none';
        }
    }
    
    static displayImportHistory(history) {
        const container = document.getElementById('importHistory');
        if (!container) return;
        
        const html = history.map(record => `
            <div class="history-item">
                <div class="history-info">
                    <div class="history-filename">${record.fileName}</div>
                    <div class="history-date">${this.formatDate(record.createdAt)}</div>
                </div>
                <div class="history-stats">
                    <span class="stat-item">${record.totalPosts || 0} منشور</span>
                    <span class="stat-item">${record.validPosts || 0} صالح</span>
                </div>
                <div class="history-status status-${record.status}">
                    ${this.getStatusText(record.status)}
                </div>
            </div>
        `).join('');
        
        container.innerHTML = html || '<div class="empty-state">لا يوجد تاريخ استيراد</div>';
    }
    
    static updateElement(elementId, value) {
        const element = document.getElementById(elementId);
        if (element) {
            if (typeof value === 'number') {
                this.animateNumber(element, parseInt(element.textContent) || 0, value);
            } else {
                element.textContent = value;
            }
        }
    }
    
    static animateNumber(element, from, to) {
        const duration = 1000;
        const steps = 30;
        const stepValue = (to - from) / steps;
        let current = from;
        let step = 0;
        
        const timer = setInterval(() => {
            current += stepValue;
            element.textContent = Math.round(current);
            step++;
            
            if (step >= steps) {
                clearInterval(timer);
                element.textContent = to;
            }
        }, duration / steps);
    }
    
    static formatDate(date) {
        if (!date) return '';
        const d = date instanceof Date ? date : new Date(date);
        return d.toLocaleDateString('ar-AE', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
    }
    
    static formatTime(date) {
        if (!date) return '';
        const d = date instanceof Date ? date : new Date(date);
        return d.toLocaleTimeString('ar-AE', {
            hour: '2-digit',
            minute: '2-digit'
        });
    }
    
    static getStatusText(status) {
        const statusTexts = {
            uploading: 'جاري الرفع',
            processing: 'جاري المعالجة',
            completed: 'مكتمل',
            failed: 'فشل',
            cancelled: 'ملغى',
            scheduled: 'مجدول',
            publishing: 'جاري النشر',
            published: 'منشور'
        };
        
        return statusTexts[status] || status;
    }
    
    static reset() {
        // Clear subscriptions
        this.subscriptions.forEach(unsubscribe => {
            try {
                unsubscribe();
            } catch (error) {
            }
        });
        
        this.subscriptions = [];
        
        // Clear intervals
        if (this.refreshInterval) {
            clearInterval(this.refreshInterval);
            this.refreshInterval = null;
        }
        
        this.isInitialized = false;
        Logger.info('Dashboard Controller reset');
    }
}

/* ------------------------------------------------------------------ 
 * 10. BULK IMPORT CONTROLLER
 * ------------------------------------------------------------------*/

class BulkImportController {
    static isInitialized = false;
    static currentImport = null;
    static progressInterval = null;
    
    static init() {
        if (this.isInitialized) return;
        
        try {
            Logger.info('Initializing Bulk Import Controller');
            
            // Setup UI event listeners
            this.setupEventListeners();
            
            // Setup progress tracking
            this.setupProgressTracking();
            
            // Initialize file templates
            this.setupFileTemplates();
            
            this.isInitialized = true;
            Logger.info('Bulk Import Controller initialized');
            
        } catch (error) {
            Logger.error('Bulk Import Controller initialization failed', error);
            ErrorHandler.handle(error, {
                component: 'BulkImportController',
                action: 'init'
            });
        }
    }
    
    static setupEventListeners() {
        // File upload input
        const fileInput = document.getElementById('bulkImportFile');
        if (fileInput) {
            fileInput.addEventListener('change', (e) => this.handleFileSelection(e));
        }
        
        // Upload button
        const uploadBtn = document.getElementById('uploadBulkFile');
        if (uploadBtn) {
            uploadBtn.addEventListener('click', () => this.handleUploadClick());
        }
        
        // Cancel button
        const cancelBtn = document.getElementById('cancelImport');
        if (cancelBtn) {
            cancelBtn.addEventListener('click', () => this.handleCancelImport());
        }
        
        // Template download buttons
        const csvTemplateBtn = document.getElementById('downloadCsvTemplate');
        const jsonTemplateBtn = document.getElementById('downloadJsonTemplate');
        
        if (csvTemplateBtn) {
            csvTemplateBtn.addEventListener('click', () => this.downloadTemplate('csv'));
        }
        
        if (jsonTemplateBtn) {
            jsonTemplateBtn.addEventListener('click', () => this.downloadTemplate('json'));
        }
        
        // Drag and drop
        const dropZone = document.getElementById('fileDropZone');
        if (dropZone) {
            this.setupDragAndDrop(dropZone);
        }
    }
    
    static setupDragAndDrop(dropZone) {
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        });
        
        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                this.handleFileSelection({ target: { files: [files[0]] } });
            }
        });
    }
    
    static setupProgressTracking() {
        // Listen for bulk import progress events
        document.addEventListener('bulkImportProgress', (e) => {
            this.updateProgressDisplay(e.detail);
        });
    }
    
    static handleFileSelection(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        try {
            // Validate file
            SecurityManager.validateFileUpload(file);
            
            // Show file info
            this.displayFileInfo(file);
            
            // Enable upload button
            const uploadBtn = document.getElementById('uploadBulkFile');
            if (uploadBtn) {
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'رفع وبدء المعالجة';
            }
            
        } catch (error) {
            this.showError(error.message);
            this.clearFileSelection();
        }
    }
    
    static displayFileInfo(file) {
        const container = document.getElementById('fileInfo');
        if (!container) return;
        
        const fileSize = FileHelper.formatFileSize(file.size);
        const fileType = file.name.split('.').pop().toUpperCase();
        
        container.innerHTML = `
            <div class="file-info-card">
                <div class="file-icon ${fileType.toLowerCase()}"></div>
                <div class="file-details">
                    <div class="file-name">${file.name}</div>
                    <div class="file-meta">
                        <span class="file-size">${fileSize}</span>
                        <span class="file-type">${fileType}</span>
                    </div>
                </div>
                <div class="file-actions">
                    <button class="clear-file-btn" onclick="BulkImportController.clearFileSelection()">
                        إزالة
                    </button>
                </div>
            </div>
        `;
        
        container.style.display = 'block';
    }
    
    static clearFileSelection() {
        const fileInput = document.getElementById('bulkImportFile');
        const uploadBtn = document.getElementById('uploadBulkFile');
        const fileInfo = document.getElementById('fileInfo');
        
        if (fileInput) fileInput.value = '';
        if (uploadBtn) {
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'اختر ملف أولاً';
        }
        if (fileInfo) {
            fileInfo.style.display = 'none';
        }
        
        this.hideProgressDisplay();
    }
    
    static async handleUploadClick() {
        try {
            const fileInput = document.getElementById('bulkImportFile');
            const file = fileInput?.files[0];
            
            if (!file) {
                throw new Error('لم يتم اختيار ملف');
            }
            
            // Show progress display
            this.showProgressDisplay();
            
            // Start upload
            const importId = await BulkImportService.upload(file);
            this.currentImport = importId;
            
            Logger.info('Bulk import started', { importId });
            
        } catch (error) {
            Logger.error('Upload failed', error);
            this.showError(error.message);
            this.hideProgressDisplay();
        }
    }
    
    static async handleCancelImport() {
        if (!this.currentImport) return;
        
        try {
            await BulkImportService.cancelImport(this.currentImport);
            this.showMessage('تم إلغاء عملية الاستيراد بنجاح', 'success');
            this.hideProgressDisplay();
            this.clearFileSelection();
            this.currentImport = null;
            
        } catch (error) {
            Logger.error('Cancel import failed', error);
            this.showError('فشل في إلغاء عملية الاستيراد');
        }
    }
    
    static showProgressDisplay() {
        const container = document.getElementById('importProgressContainer');
        if (container) {
            container.style.display = 'block';
        }
        
        // Disable upload controls
        const uploadBtn = document.getElementById('uploadBulkFile');
        const fileInput = document.getElementById('bulkImportFile');
        
        if (uploadBtn) {
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'جاري المعالجة...';
        }
        
        if (fileInput) fileInput.disabled = true;
    }
    
    static hideProgressDisplay() {
        const container = document.getElementById('importProgressContainer');
        if (container) {
            container.style.display = 'none';
        }
        
        // Re-enable upload controls
        const uploadBtn = document.getElementById('uploadBulkFile');
        const fileInput = document.getElementById('bulkImportFile');
        
        if (uploadBtn) {
            uploadBtn.disabled = false;
            uploadBtn.textContent = 'رفع ملف جديد';
        }
        
        if (fileInput) fileInput.disabled = false;
    }
    
    static updateProgressDisplay(progress) {
        // Update progress bar
        const progressBar = document.getElementById('importProgressBar');
        const progressText = document.getElementById('importProgressText');
        const progressPercent = document.getElementById('importProgressPercent');
        
        if (progressBar) {
            progressBar.style.width = `${progress.progress}%`;
        }
        
        if (progressPercent) {
            progressPercent.textContent = `${progress.progress}%`;
        }
        
        if (progressText) {
            progressText.textContent = this.getProgressMessage(progress);
        }
        
        // Update status
        const statusElement = document.getElementById('importStatus');
        if (statusElement) {
            statusElement.textContent = this.getStatusText(progress.status);
            statusElement.className = `import-status status-${progress.status}`;
        }
        
        // Show results when completed
        if (progress.status === 'completed' || progress.status === 'failed') {
            setTimeout(() => {
                this.showImportResults(progress);
            }, 1000);
        }
    }
    
    static getProgressMessage(progress) {
        const messages = {
            uploading: 'جاري رفع الملف...',
            processing: 'جاري معالجة البيانات...',
            validating: 'جاري التحقق من صحة البيانات...',
            scheduling: 'جاري جدولة المنشورات...',
            completed: 'تمت العملية بنجاح!',
            failed: 'فشلت العملية',
            cancelled: 'تم إلغاء العملية'
        };
        
        return messages[progress.status] || 'جاري المعالجة...';
    }
    
    static getStatusText(status) {
        const statusTexts = {
            uploading: 'جاري الرفع',
            processing: 'جاري المعالجة',
            validating: 'جاري التحقق',
            scheduling: 'جاري الجدولة',
            completed: 'مكتملة',
            failed: 'فشل',
            cancelled: 'ملغاة'
        };
        
        return statusTexts[status] || status;
    }
    
    static showImportResults(results) {
        const container = document.getElementById('importResults');
        if (!container) return;
        
        let html = '';
        
        if (results.status === 'completed') {
            html = `
                <div class="import-success">
                    <div class="success-icon">✅</div>
                    <div class="success-message">
                        <h3>تم الاستيراد بنجاح!</h3>
                        <div class="import-stats">
                            <div class="stat-item">
                                <span class="stat-number">${results.totalPosts}</span>
                                <span class="stat-label">إجمالي المنشورات</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">${results.validPosts}</span>
                                <span class="stat-label">منشورات صالحة</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">${results.invalidPosts || 0}</span>
                                                                <span class="stat-label">منشورات غير صالحة</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        } else if (results.status === 'failed') {
            html = `
                <div class="import-error">
                    <div class="error-icon">❌</div>
                    <div class="error-message">
                        <h3>فشل في الاستيراد</h3>
                        <div class="error-details">
                            ${results.errors?.map(error => `<div class="error-item">${error}</div>`).join('') || ''}
                        </div>
                    </div>
                </div>
            `;
        }
        
        container.innerHTML = html;
        container.style.display = 'block';
        
        // Auto-hide after success
        if (results.status === 'completed') {
            setTimeout(() => {
                this.hideProgressDisplay();
                this.clearFileSelection();
                this.currentImport = null;
                
                // Refresh dashboard
                if (DashboardController.isInitialized) {
                    DashboardController.loadInitialData();
                }
            }, 5000);
        }
    }
    
    static setupFileTemplates() {
        // This will be called during initialization
        Logger.debug('File templates setup completed');
    }
    
    static downloadTemplate(format) {
        try {
            const templates = this.getTemplateData();
            
            if (format === 'csv') {
                const csvContent = this.generateCSVTemplate(templates.headers, templates.sampleData);
                this.downloadFile(csvContent, 'socialhub-import-template.csv', 'text/csv');
            } else if (format === 'json') {
                const jsonContent = this.generateJSONTemplate(templates.sampleData);
                this.downloadFile(jsonContent, 'socialhub-import-template.json', 'application/json');
            }
            
            Logger.info(`Template downloaded: ${format}`);
            
        } catch (error) {
            Logger.error('Template download failed', error);
            this.showError('فشل في تحميل النموذج');
        }
    }
    
    static getTemplateData() {
        const headers = ConfigManager.get('bulkImport.requiredColumns');
        const sampleData = [
            {
                socialTitle: 'عنوان المنشور الأول',
                socialDescription: 'وصف تفصيلي للمنشور الأول يشرح المحتوى',
                shortUrl: 'https://example.com/post1',
                linkType: 'article',
                socialImageurl: 'https://example.com/image1.jpg',
                socialhachtags: '#تسويق,#وسائل_التواصل,#محتوى',
                day: '2024-12-01',
                hour: '09:00',
                platform: 'facebook,instagram'
            },
            {
                socialTitle: 'عنوان المنشور الثاني',
                socialDescription: 'وصف تفصيلي للمنشور الثاني',
                shortUrl: 'https://example.com/post2',
                linkType: 'video',
                socialImageurl: 'https://example.com/image2.jpg',
                socialhachtags: '#فيديو,#تعليم,#نصائح',
                day: '2024-12-01',
                hour: '14:30',
                platform: 'twitter,linkedin'
            }
        ];
        
        return { headers, sampleData };
    }
    
    static generateCSVTemplate(headers, sampleData) {
        let csv = headers.join(',') + '\n';
        
        sampleData.forEach(row => {
            const values = headers.map(header => {
                const value = row[header] || '';
                // Escape commas and quotes
                return `"${String(value).replace(/"/g, '""')}"`;
            });
            csv += values.join(',') + '\n';
        });
        
        return csv;
    }
    
    static generateJSONTemplate(sampleData) {
        return JSON.stringify(sampleData, null, 2);
    }
    
    static downloadFile(content, filename, mimeType) {
        const blob = new Blob([content], { type: mimeType });
        const url = window.URL.createObjectURL(blob);
        const link = document.createElement('a');
        
        link.href = url;
        link.download = filename;
        link.style.display = 'none';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        window.URL.revokeObjectURL(url);
    }
    
    static showError(message) {
        if (typeof showToast === 'function') {
            showToast(message, 'error');
        } else {
            alert(message);
        }
    }
    
    static showMessage(message, type = 'info') {
        if (typeof showToast === 'function') {
            showToast(message, type);
        } else {
            alert(message);
        }
    }
    
    static reset() {
        if (this.progressInterval) {
            clearInterval(this.progressInterval);
            this.progressInterval = null;
        }
        
        this.currentImport = null;
        this.isInitialized = false;
        
        Logger.info('Bulk Import Controller reset');
    }
}

/* ------------------------------------------------------------------ 
 * 11. UTILITIES
 * ------------------------------------------------------------------*/

// Updated File Helper for JSON/CSV Focus
class FileHelper {
    static maxSizes = {
        document: ConfigManager.get('bulkImport.maxFileSize', 50 * 1024 * 1024)
    };
    
    static allowedTypes = {
        document: ['text/csv', 'application/json', 'text/plain']
    };
    
    static validateFile(file, type = 'document') {
        const errors = [];
        
        // Check file size
        const maxSize = this.maxSizes[type];
        if (file.size > maxSize) {
            errors.push(`حجم الملف كبير جداً. الحد الأقصى: ${this.formatFileSize(maxSize)}`);
        }
        
        // Check file extension
        const extension = file.name.split('.').pop().toLowerCase();
        const supportedFormats = ConfigManager.get('bulkImport.supportedFormats');
        
        if (!supportedFormats.includes(extension)) {
            errors.push(`صيغة الملف غير مدعومة. المسموح: ${supportedFormats.join(', ')}`);
        }
        
        // Check MIME type (if available)
        const allowedTypes = this.allowedTypes[type];
        if (file.type && !allowedTypes.some(mimeType => file.type.includes(mimeType))) {
            console.warn('MIME type mismatch, but proceeding based on extension');
        }
        
        return {
            valid: errors.length === 0,
            errors
        };
    }
    
    static formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    static async readAsText(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            
            reader.onload = () => resolve(reader.result);
            reader.onerror = () => reject(new Error('فشل في قراءة الملف'));
            
            // Detect encoding
            reader.readAsText(file, 'UTF-8');
        });
    }
    
    static detectEncoding(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            
            reader.onload = () => {
                const bytes = new Uint8Array(reader.result);
                
                // Simple UTF-8 detection
                let isUTF8 = true;
                for (let i = 0; i < Math.min(bytes.length, 1000); i++) {
                    if (bytes[i] > 127) {
                        isUTF8 = false;
                        break;
                    }
                }
                
                resolve(isUTF8 ? 'UTF-8' : 'Windows-1256');
            };
            
            reader.readAsArrayBuffer(file.slice(0, 1000));
        });
    }
    
    static async readAsDataURL(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            
            reader.onload = () => resolve(reader.result);
            reader.onerror = () => reject(new Error('فشل في قراءة الملف'));
            
            reader.readAsDataURL(file);
        });
    }
    
    static generateSampleFile(format) {
        const sampleData = BulkImportController.getTemplateData();
        
        if (format === 'csv') {
            return BulkImportController.generateCSVTemplate(sampleData.headers, sampleData.sampleData);
        } else if (format === 'json') {
            return BulkImportController.generateJSONTemplate(sampleData.sampleData);
        }
        
        return '';
    }
}

// Enhanced Date Time Helper
class DateTimeHelper {
    static timezone = ConfigManager.get('system.timezone', 'Asia/Dubai');
    static locale = ConfigManager.get('system.language', 'ar-AE');
    
    static formatDate(date, format = 'full') {
        if (!date) return '';
        
        try {
            const d = date instanceof Date ? date : new Date(date);
            
            const options = {
                full: {
                    year: 'numeric',
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    timeZone: this.timezone
                },
                short: {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    timeZone: this.timezone
                },
                date: {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    timeZone: this.timezone
                },
                time: {
                    hour: '2-digit',
                    minute: '2-digit',
                    timeZone: this.timezone
                }
            };
            
            return new Intl.DateTimeFormat(this.locale, options[format] || options.full).format(d);
        } catch (error) {
            Logger.error('Date formatting failed', error);
            return String(date);
        }
    }
    
    static parseScheduledTime(day, hour) {
        try {
            // Validate day format (YYYY-MM-DD)
            if (!/^\d{4}-\d{2}-\d{2}$/.test(day)) {
                throw new Error('تنسيق التاريخ غير صحيح. استخدم YYYY-MM-DD');
            }
            
            // Validate hour format (HH:MM)
            if (!/^([01]\d|2[0-3]):[0-5]\d$/.test(hour)) {
                throw new Error('تنسيق الوقت غير صحيح. استخدم HH:MM');
            }
            
            const dateTime = new Date(`${day}T${hour}:00`);
            
            if (isNaN(dateTime.getTime())) {
                throw new Error('تاريخ أو وقت غير صحيح');
            }
            
            // Check if date is in the past
            if (dateTime < new Date()) {
                throw new Error('لا يمكن جدولة منشور في الماضي');
            }
            
            return dateTime;
        } catch (error) {
            throw new Error(`خطأ في تحليل الوقت المجدول: ${error.message}`);
        }
    }
    
    static getRelativeTime(date) {
        try {
            const rtf = new Intl.RelativeTimeFormat(this.locale, { numeric: 'auto' });
            const now = new Date();
            const diffInSeconds = (date - now) / 1000;
            
            const units = [
                { unit: 'year', seconds: 31536000 },
                { unit: 'month', seconds: 2592000 },
                { unit: 'day', seconds: 86400 },
                { unit: 'hour', seconds: 3600 },
                { unit: 'minute', seconds: 60 },
                { unit: 'second', seconds: 1 }
            ];
            
            for (const { unit, seconds } of units) {
                const interval = Math.floor(diffInSeconds / seconds);
                if (Math.abs(interval) >= 1) {
                    return rtf.format(interval, unit);
                }
            }
            
            return rtf.format(0, 'second');
        } catch (error) {
            Logger.error('Relative time formatting failed', error);
            return this.formatDate(date, 'short');
        }
    }
    
    static isValidScheduleTime(dateTime) {
        const now = new Date();
        const maxFuture = new Date();
        maxFuture.setFullYear(maxFuture.getFullYear() + 1); // Max 1 year in future
        
        return dateTime > now && dateTime < maxFuture;
    }
    
    static getOptimalPostingTimes() {
        // Optimal posting times for Dubai timezone
        return {
            facebook: ['09:00', '13:00', '20:00'],
            instagram: ['11:00', '14:00', '19:00'],
            twitter: ['08:00', '12:00', '17:00'],
            linkedin: ['08:00', '12:00', '17:00'],
            tiktok: ['18:00', '20:00', '22:00']
        };
    }
}

// Network Helper
class NetworkHelper {
    static connectionStatus = 'unknown';
    static listeners = [];
    
    static async checkConnection() {
        try {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 5000);
            
            const response = await fetch('https://www.google.com/generate_204', {
                method: 'GET',
                cache: 'no-store',
                signal: controller.signal
            });
            
            clearTimeout(timeoutId);
            return response.status === 204;
        } catch {
            return false;
        }
    }
    
    static isOnline() {
        return typeof navigator !== 'undefined' ? navigator.onLine : true;
    }
    
    static onConnectionChange(callback) {
        this.listeners.push(callback);
        
        if (typeof window !== 'undefined') {
            const onOnline = () => {
                this.connectionStatus = 'online';
                this.notifyListeners(true);
            };
            
            const onOffline = () => {
                this.connectionStatus = 'offline';
                this.notifyListeners(false);
            };
            
            window.addEventListener('online', onOnline);
            window.addEventListener('offline', onOffline);
            
            // Return cleanup function
            return () => {
                window.removeEventListener('online', onOnline);
                window.removeEventListener('offline', onOffline);
                this.removeListener(callback);
            };
        }
        
        return () => this.removeListener(callback);
    }
    
    static removeListener(callback) {
        const index = this.listeners.indexOf(callback);
        if (index > -1) {
            this.listeners.splice(index, 1);
        }
    }
    
    static notifyListeners(isOnline) {
        this.listeners.forEach(callback => {
            try {
                callback(isOnline);
            } catch (error) {
                Logger.error('Network listener error', error);
            }
        });
    }
    
    static async waitForConnection(timeout = 30000) {
        return new Promise((resolve, reject) => {
            if (this.isOnline()) {
                resolve(true);
                return;
            }
            
            const timer = setTimeout(() => {
                cleanup();
                reject(new Error('انتهت مهلة انتظار الاتصال بالإنترنت'));
            }, timeout);
            
            const cleanup = this.onConnectionChange((isOnline) => {
                if (isOnline) {
                    clearTimeout(timer);
                    cleanup();
                    resolve(true);
                }
            });
        });
    }
    
    static getConnectionInfo() {
        const connection = navigator.connection || 
                          navigator.mozConnection || 
                          navigator.webkitConnection;
        
        if (connection) {
            return {
                effectiveType: connection.effectiveType,
                downlink: connection.downlink,
                rtt: connection.rtt,
                saveData: connection.saveData
            };
        }
        
        return null;
    }
}

/* ------------------------------------------------------------------ 
 * 12. INITIALIZATION SYSTEM
 * ------------------------------------------------------------------*/

// Toast Notifications (Updated)
function showToast(message, type = 'info', duration = 5000) {
    const toastContainer = document.getElementById('toastContainer') || createToastContainer();
    const toastId = 'toast_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5);
    
    const toast = document.createElement('div');
    toast.id = toastId;
    toast.className = `toast toast-${type}`;
    
    const icon = getToastIcon(type);
    toast.innerHTML = `
        <div class="toast-content">
            <div class="toast-icon">${icon}</div>
            <div class="toast-message">${message}</div>
            <button class="toast-close" onclick="closeToast('${toastId}')">×</button>
        </div>
    `;
    
    toastContainer.appendChild(toast);
    
    // Animate in
    setTimeout(() => toast.classList.add('show'), 100);
    
    // Auto remove
    setTimeout(() => {
        closeToast(toastId);
    }, duration);
}

function createToastContainer() {
    const container = document.createElement('div');
    container.id = 'toastContainer';
    container.className = 'toast-container';
    document.body.appendChild(container);
    return container;
}

function closeToast(toastId) {
    const toast = document.getElementById(toastId);
    if (toast) {
        toast.classList.add('hide');
        setTimeout(() => {
            if (toast.parentElement) {
                toast.parentElement.removeChild(toast);
            }
        }, 300);
    }
}

function getToastIcon(type) {
    const icons = {
        success: '✅',
        error: '❌',
        warning: '⚠️',
        info: 'ℹ️'
    };
    return icons[type] || icons.info;
}

// Cache Manager
class CacheManager {
    static cache = new Map();
    static maxSize = 1000;
    static ttl = 5 * 60 * 1000; // 5 minutes
    
    static set(key, value, customTTL = null) {
        const expiry = Date.now() + (customTTL || this.ttl);
        
        this.cache.set(key, {
            value,
            expiry
        });
        
        // Clean up if cache is too large
        if (this.cache.size > this.maxSize) {
            this.cleanup();
        }
    }
    
    static get(key) {
        const item = this.cache.get(key);
        
        if (!item) return null;
        
        if (Date.now() > item.expiry) {
            this.cache.delete(key);
            return null;
        }
        
        return item.value;
    }
    
    static delete(key) {
        return this.cache.delete(key);
    }
    
    static clear() {
        this.cache.clear();
    }
    
    static cleanup() {
        const now = Date.now();
        const toDelete = [];
        
        for (const [key, item] of this.cache) {
            if (now > item.expiry) {
                toDelete.push(key);
            }
        }
        
        toDelete.forEach(key => this.cache.delete(key));
        
        // If still too large, remove oldest entries
        if (this.cache.size > this.maxSize) {
            const entries = Array.from(this.cache.entries());
            const toRemove = entries.slice(0, this.cache.size - this.maxSize);
            toRemove.forEach(([key]) => this.cache.delete(key));
        }
    }
    
    static startCleanupInterval() {
        setInterval(() => {
            this.cleanup();
        }, 60000); // Cleanup every minute
    }
    
    static clearUserCache() {
        const userPrefix = AuthService.getCurrentUser()?.uid;
        if (!userPrefix) return;
        
        const toDelete = [];
        for (const key of this.cache.keys()) {
            if (key.startsWith(userPrefix)) {
                toDelete.push(key);
            }
        }
        
        toDelete.forEach(key => this.cache.delete(key));
    }
}

// Main Application Initialization
window.SocialHubPro = {
    // Core Systems
    ConfigManager,
    Logger,
    ErrorHandler,
    SecurityManager,
    ValidationEngine,
    CacheManager,
    
    // Services  
    AuthService,
    BulkImportService,
    ScheduledPublishService,
    FileCleanupService,
    PostService,
    
    // Platform Services
    FacebookGraphService,
    InstagramGraphService,
    TwitterService,
    LinkedInService,
    TikTokService,
    
    // Controllers
    DashboardController,
    BulkImportController,
    
    // Utilities
    DateTimeHelper,
    FileHelper,
    NetworkHelper,
    
    // Global Functions
    showToast,
    closeToast,
    
    // Initialize the entire application
    async init() {
        try {
            Logger.info('🚀 Initializing SocialHub Pro v11.0 - Production Ready');
            
            // Validate environment
            ConfigManager.validate();
            
            // Initialize core systems
            Logger.info('📊 Initializing core systems...');
            ErrorHandler.init();
            SecurityManager.init();
            CacheManager.startCleanupInterval();
            
            // Initialize Firebase
            Logger.info('🔥 Initializing Firebase...');
            if (typeof firebase !== 'undefined') {
                if (!firebase.apps.length) {
                    firebase.initializeApp(ConfigManager.get('firebase'));
                }
                Logger.info('Firebase initialized successfully');
            } else {
                throw new Error('Firebase SDK not loaded');
            }
            
            // Initialize services
            Logger.info('🔐 Initializing authentication...');
            await AuthService.init();
            
            Logger.info('📅 Initializing scheduled publishing...');
            ScheduledPublishService.init();
            
            // Setup logger outputs
            if (ConfigManager.isProduction()) {
                Logger.addOutput(new FirebaseLoggerOutput());
            }
            
            // Initialize UI when user is authenticated
            AuthService.subscribe((user) => {
                if (user) {
                    Logger.info('👤 User authenticated, initializing UI...');
                    
                    // Initialize controllers
                    DashboardController.init();
                    BulkImportController.init();
                    
                } else {
                    Logger.info('🚪 User logged out, cleaning up...');
                    
                    // Reset controllers
                    DashboardController.reset();
                    BulkImportController.reset();
                    
                    // Clear user-specific caches
                    CacheManager.clearUserCache();
                }
            });
            
            // Setup network monitoring
            NetworkHelper.onConnectionChange((isOnline) => {
                if (isOnline) {
                    showToast('تم استعادة الاتصال بالإنترنت', 'success');
                } else {
                    showToast('فقد الاتصال بالإنترنت', 'warning');
                }
            });
            
            Logger.info('✅ SocialHub Pro v11.0 initialized successfully');
            showToast('تم تحميل التطبيق بنجاح', 'success');
            
            return true;
            
        } catch (error) {
            Logger.error('❌ Failed to initialize SocialHub Pro', error);
            showToast('فشل في تحميل التطبيق. يرجى إعادة تحميل الصفحة.', 'error');
            throw error;
        }
    },
    
    // Cleanup and destroy
    async destroy() {
        try {
            Logger.info('🧹 Destroying SocialHub Pro...');
            
            // Flush logs
            await Logger.flush();
            
            // Clear cache
            CacheManager.clear();
            
            // Cleanup services
            PostService.cleanup();
            
            // Reset controllers
            DashboardController.reset();
            BulkImportController.reset();
            
            Logger.info('✅ SocialHub Pro destroyed successfully');
            
        } catch (error) {
            Logger.error('❌ Failed to destroy SocialHub Pro', error);
        }
    }
};

// Auto-initialize when DOM is ready
if (typeof document !== 'undefined') {
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            window.SocialHubPro.init().catch(console.error);
        });
    } else {
        window.SocialHubPro.init().catch(console.error);
    }
}

// Handle page unload
if (typeof window !== 'undefined') {
    window.addEventListener('beforeunload', () => {
        window.SocialHubPro.destroy();
    });
}

// Remove the problematic await statement at the end of the file
// and replace it with a proper initialization call
Logger.info('🎉 SocialHub Pro v11.0 System Ready!');

        // تحسينات إضافية للكود الموجود

        // تحسين معالجة أخطاء Firebase
        if (typeof firebase !== 'undefined') {
            // معالج أخطاء Firebase العامة
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    enhancedLogger.info('✅ تسجيل دخول Firebase بنجاح', { uid: user.uid });
                } else {
                    enhancedLogger.info('🔓 تسجيل خروج Firebase');
                }
            });
        }

        // تحسين تحميل الصفحة
        document.addEventListener('DOMContentLoaded', () => {
            enhancedLogger.info('📄 DOM تم تحميله بالكامل');

            // فحص سلامة العناصر الأساسية
            const criticalElements = ['#loadingScreen', '#authScreen', '#mainApp'];
            criticalElements.forEach(selector => {
                const element = document.querySelector(selector);
                if (!element) {
                    enhancedLogger.warn(`⚠️ عنصر مهم مفقود: ${selector}`);
                }
            });
        });

        window.addEventListener('load', () => {
            const loadTime = performance.now();
            enhancedLogger.info(`⚡ تحميل الصفحة مكتمل في ${loadTime.toFixed(2)}ms`);
        });

        // مراقبة حالة الاتصال
        window.addEventListener('online', () => {
            enhancedLogger.info('🌐 الاتصال بالإنترنت متاح');
        });

        window.addEventListener('offline', () => {
            enhancedLogger.warn('📵 انقطع الاتصال بالإنترنت');
        });

    </script>
</body>
</html>